"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[64717],{26514:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"iaas/guides/developer-guide/releases","title":"Releases","description":"How we handle releases","source":"@site/docs/02-iaas/guides/developer-guide/releases.md","sourceDirName":"02-iaas/guides/developer-guide","slug":"/iaas/guides/developer-guide/releases","permalink":"/docs/iaas/guides/developer-guide/releases","draft":false,"unlisted":false,"editUrl":"https://github.com/SovereignCloudStack/docs/tree/main/docs/02-iaas/guides/developer-guide/releases.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_label":"Releases","sidebar_position":10},"sidebar":"docs","previous":{"title":"Developer Guide","permalink":"/docs/iaas/guides/developer-guide/"},"next":{"title":"Scripts","permalink":"/docs/iaas/guides/developer-guide/scripts"}}');var i=n(74848),a=n(28453);const r={sidebar_label:"Releases",sidebar_position:10},o="Releases",l={},d=[{value:"How we handle releases",id:"how-we-handle-releases",level:2},{value:"How to make a release",id:"how-to-make-a-release",level:2},{value:"Stable release",id:"stable-release",level:3},{value:"How we write release notes",id:"how-we-write-release-notes",level:2},{value:"Installation",id:"installation",level:3},{value:"Usage",id:"usage",level:3},{value:"Example",id:"example",level:3},{value:"Repositories without release notes",id:"repositories-without-release-notes",level:3}];function h(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"releases",children:"Releases"})}),"\n",(0,i.jsx)(s.h2,{id:"how-we-handle-releases",children:"How we handle releases"}),"\n",(0,i.jsx)(s.p,{children:"Currently we do a major release every 6 months. Minor releases we do when\nneeded and about every 2 weeks."}),"\n",(0,i.jsx)(s.p,{children:"In a minor release, only updates, bug fixes, etc. take place. There are also\nno major upgrades of included components such as OpenStack, Keycloak or Ceph\nin a minor release."}),"\n",(0,i.jsx)(s.p,{children:"It is possible to jump from any minor version within a major version to higher\nminor versions without any intervention."}),"\n",(0,i.jsx)(s.p,{children:"Deprecations, removals, etc. take place in a major release. New mandatory\nfeatures are also added in a major release. Upgrades of the included components\ncan also take place during a major release (e.g. OpenStack Xena -> OpenStack Yoga)."}),"\n",(0,i.jsx)(s.p,{children:"It is possible to jump from the previous major version to the next major version.\nIt may be that manual intervention is necessary. For example, configuration\nparameters may need to be added or services that no longer exist may need to be\nremoved."}),"\n",(0,i.jsx)(s.h2,{id:"how-to-make-a-release",children:"How to make a release"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["On all repositories that are used, check that the versions to be used have an\nappropriate version tag (e.g. ",(0,i.jsx)(s.code,{children:"v0.20230308.0"}),")."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"osism/ansible-collection-commons\nosism/ansible-collection-services\nosism/ansible-collection-validations\nosism/ansible-defaults\nosism/ansible-playbooks\nosism/ansible-playbooks-manager\nosism/cf-generics\nosism/kolla-operations\nosism/python-osism\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Copy the ",(0,i.jsx)(s.code,{children:"latest"})," directory. The release to be created is used as the new name."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"latest -> 6.0.0b\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Remove all ",(0,i.jsx)(s.code,{children:"# renovate"})," lines from the ",(0,i.jsx)(s.code,{children:"base.yml"})," file."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Remove all Ceph and OpenStack releases that should not be part of the pre-release.\nThere is only one OpenStack version and one Ceph version per (pre-)release."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Ensure that the symlinks ",(0,i.jsx)(s.code,{children:"openstack.yml"})," and ",(0,i.jsx)(s.code,{children:"ceph.yml"})," point to the releases\nto be used in this pre-release."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"base.yml\nceph-pacific.yml\nceph.yml -> ceph-pacific.yml\nopenstack-zed.yml\nopenstack.yml -> openstack-zed.yml\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Run ",(0,i.jsx)(s.code,{children:"src/prepare-release.py"}),"."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"RELEASE=6.0.0b python3 src/prepare-release.py\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Do the steps from the ",(0,i.jsx)(s.code,{children:"Stable release"})," starting from the 4th step."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"stable-release",children:"Stable release"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Copy the directory of the last pre-release or the previous stable release.\nThe release to be created is used as the new name."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"5.0.0a -> 5.0.0b\n5.0.0b -> 5.0.0\n5.0.0  -> 5.1.0\n5.1.0  -> 5.2.0\n5.2.0  -> 5.3.0\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Change all necessary versions in the YAML files within the new directory.\nIn any case, the version of the pre-release or the version of the stable\nrelease must be replaced by the release to be created."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"The release to be created is submitted as a pull request as usual and then\nmerged."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Add a tag with the name of the new release to the listed repositories."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"osism/container-image-ceph-ansible\nosism/container-image-inventory-reconciler\nosism/container-image-osism-ansible\nosism/container-images-kolla\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["After completing the creation of the images in repository ",(0,i.jsx)(s.code,{children:"container-images-kolla"}),",\nthe file ",(0,i.jsx)(s.code,{children:"images.yml"})," must be added to repository ",(0,i.jsx)(s.code,{children:"osism/sbom"})," as\n",(0,i.jsx)(s.code,{children:"5.0.0/openstack.yml"})," (instead of ",(0,i.jsx)(s.code,{children:"5.0.0"}),", the corresponding release is used).\nThe file is available as a build artifact of the ",(0,i.jsx)(s.code,{children:"Release container images"})," action\non the created tag."]}),"\n",(0,i.jsxs)(s.p,{children:["Before the file is added, it is enhanced with the checksums of the images. The script\nis available in the ",(0,i.jsx)(s.code,{children:"osism/sbom"})," repository."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"VERSION=5.0.0 python3 scripts/add-image-checksum.py\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["If ",(0,i.jsx)(s.code,{children:"5.0.0/openstack.yml"})," is present in ",(0,i.jsx)(s.code,{children:"osism/sbom"}),", repository\n",(0,i.jsx)(s.code,{children:"osism/container-image-kolla-ansible"})," can be tagged like the other\nrepositories before."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Add the created SPDX files from the listed repositories to the ",(0,i.jsx)(s.code,{children:"osism/sbom"})," repository.\nThe file are available as build artifacts of the ",(0,i.jsx)(s.code,{children:"Build container image"})," action\non the created tags."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"osism/container-image-ceph-ansible\nosism/container-image-kolla-ansible\nosism/container-image-osism-ansible\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Add and run temporary CI jobs in ",(0,i.jsx)(s.code,{children:"osism/testbed"})," that uses the pre-release."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-yaml",children:'- job:\n    name: testbed-deploy-stable-next\n    parent: testbed-deploy\n    vars:\n      manager_version: "5.0.0a"\n      refstack: true\n    nodeset: testbed-orchestrator\n\n- job:\n    name: testbed-upgrade-stable-next\n    parent: testbed-deploy\n    vars:\n      manager_version: "4.2.0"\n      manager_version_next: "5.0.0a"\n    nodeset: testbed-orchestrator\n'})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Test. Test. Test."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Prepare a PR to change the stable version to the new stable version in the following Zuul jobs\nin the ",(0,i.jsx)(s.code,{children:"osism/testbed"})," repository. All tests there must pass successfully before the tag is\nset on this repository in the next step. The temporary CI jobs (step 8)  are removed again with\nthis PR."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"testbed-deploy-stable\ntestbed-update-stable\ntestbed-update-stable\ntestbed-upgrade-stable\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Add a new release notes file to ",(0,i.jsx)(s.code,{children:"doc/source/notes"}),". Generate the versions table with the\nhelp of the ",(0,i.jsx)(s.code,{children:"release-table.py"})," script in the ",(0,i.jsx)(s.code,{children:"osism/sbom"})," repository."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["After all known issues are documented, a corresponding tag, e.g. ",(0,i.jsx)(s.code,{children:"5.0.0"}),", is set on the\n",(0,i.jsx)(s.a,{href:"https://github.com/osism/release/releases",children:"osism/release"})," repository."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Create a ",(0,i.jsx)(s.a,{href:"https://docs.github.com/en/repositories/releasing-projects-on-github/managing-releases-in-a-repository",children:"GitHub release"})," with the new tag on the\n",(0,i.jsx)(s.a,{href:"https://github.com/osism/release/releases",children:"osism/release"})," repository. The release is\nnow public available."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["As the last of the release process, the previously prepared PR is merged on the\n",(0,i.jsx)(s.code,{children:"osism/testbed"})," repository to change the stable version."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"how-we-write-release-notes",children:"How we write release notes"}),"\n",(0,i.jsxs)(s.p,{children:["We use ",(0,i.jsx)(s.a,{href:"https://docs.openstack.org/reno/latest/",children:"Reno"})," to manage the release notes."]}),"\n",(0,i.jsx)(s.h3,{id:"installation",children:"Installation"}),"\n",(0,i.jsxs)(s.p,{children:["Reno is provided as a ",(0,i.jsx)(s.a,{href:"https://pypi.org/project/reno/",children:"Python package"})," and can be installed with pip."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"pip3 install reno\n"})}),"\n",(0,i.jsx)(s.h3,{id:"usage",children:"Usage"}),"\n",(0,i.jsxs)(s.p,{children:["For each change in a repository, a release note is created with Reno.\nSomething meaningful is used as the name for the note. For example, if the\nrequirements file for Ansible is removed, ",(0,i.jsx)(s.code,{children:"remove-ansible-requirements"})," is a good name."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-console",children:"$ reno new remove-ansible-requirements\nno configuration file in: ./releasenotes/config.yaml, ./reno.yaml\nCreated new notes file in releasenotes/notes/remove-ansible-requirements-6c6eba43f616bc6b.yaml\n"})}),"\n",(0,i.jsx)(s.p,{children:"The created file contains prepared entries for several categories. It is described briefly\nin each instance which contents belong in which category. What is not needed is deleted."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-yaml",children:"prelude: >\n    Replace this text with content to appear at the top of the section for this\n    release. All of the prelude content is merged together and then rendered\n    separately from the items listed in other parts of the file, so the text\n    needs to be worded so that both the prelude and the other items make sense\n    when read independently. This may mean repeating some details. Not every\n    release note requires a prelude. Usually only notes describing major\n    features or adding release theme details should have a prelude.\nfeatures:\n  - |\n    List new features here, or remove this section.  All of the list items in\n    this section are combined when the release notes are rendered, so the text\n    needs to be worded so that it does not depend on any information only\n    available in another section, such as the prelude. This may mean repeating\n    some details.\nissues:\n  - |\n    List known issues here, or remove this section.  All of the list items in\n    this section are combined when the release notes are rendered, so the text\n    needs to be worded so that it does not depend on any information only\n    available in another section, such as the prelude. This may mean repeating\n    some details.\nupgrade:\n  - |\n    List upgrade notes here, or remove this section.  All of the list items in\n    this section are combined when the release notes are rendered, so the text\n    needs to be worded so that it does not depend on any information only\n    available in another section, such as the prelude. This may mean repeating\n    some details.\ndeprecations:\n  - |\n    List deprecations notes here, or remove this section.  All of the list\n    items in this section are combined when the release notes are rendered, so\n    the text needs to be worded so that it does not depend on any information\n    only available in another section, such as the prelude. This may mean\n    repeating some details.\ncritical:\n  - |\n    Add critical notes here, or remove this section.  All of the list items in\n    this section are combined when the release notes are rendered, so the text\n    needs to be worded so that it does not depend on any information only\n    available in another section, such as the prelude. This may mean repeating\n    some details.\nsecurity:\n  - |\n    Add security notes here, or remove this section.  All of the list items in\n    this section are combined when the release notes are rendered, so the text\n    needs to be worded so that it does not depend on any information only\n    available in another section, such as the prelude. This may mean repeating\n    some details.\nfixes:\n  - |\n    Add normal bug fixes here, or remove this section.  All of the list items\n    in this section are combined when the release notes are rendered, so the\n    text needs to be worded so that it does not depend on any information only\n    available in another section, such as the prelude. This may mean repeating\n    some details.\nother:\n  - |\n    Add other notes here, or remove this section.  All of the list items in\n    this section are combined when the release notes are rendered, so the text\n    needs to be worded so that it does not depend on any information only\n    available in another section, such as the prelude. This may mean repeating\n    some details.\n"})}),"\n",(0,i.jsx)(s.h3,{id:"example",children:"Example"}),"\n",(0,i.jsxs)(s.p,{children:["Here is an example of a ",(0,i.jsx)(s.a,{href:"https://github.com/osism/cfg-generics/commit/e2f04a9f4a51eb058446d7a8ab6835df53989099",children:"commit from the osism/cfg-generics repository"}),"."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-yaml",children:"---\nfeatures:\n  - |\n    The `requirements.yml` has been removed. The version will be set in the `run.sh`\n    script for the seed process in the future exactly as later in the update process\n    via the parameters `ANSIBLE_COLLECTION_SERVICES_VERSION` and\n    `ANSIBLE_PLAYBOOKS_MANAGER_VERSION`.\nupgrade:\n  - |\n    In existing configuration repositories, the `environments/manager/requirements.yml`\n    file can be removed after the generics have been synced.\n"})}),"\n",(0,i.jsx)(s.h3,{id:"repositories-without-release-notes",children:"Repositories without release notes"}),"\n",(0,i.jsx)(s.p,{children:"We do not create release notes in the following repositories:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"osism/github-manager"}),"\n",(0,i.jsx)(s.li,{children:"osism/osism.github.io"}),"\n",(0,i.jsx)(s.li,{children:"osism/release"}),"\n"]})]})}function c(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>o});var t=n(96540);const i={},a=t.createContext(i);function r(e){const s=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(a.Provider,{value:s},e.children)}}}]);