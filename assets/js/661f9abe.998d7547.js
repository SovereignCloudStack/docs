"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[33903],{85894:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>d,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"iaas/deployment-examples/testbed/usage","title":"Usage","description":"Deployment must be completed at this point.","source":"@site/docs/02-iaas/deployment-examples/testbed/usage.mdx","sourceDirName":"02-iaas/deployment-examples/testbed","slug":"/iaas/deployment-examples/testbed/usage","permalink":"/docs/iaas/deployment-examples/testbed/usage","draft":false,"unlisted":false,"editUrl":"https://github.com/SovereignCloudStack/docs/tree/main/docs/02-iaas/deployment-examples/testbed/usage.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_label":"Usage","sidebar_position":3},"sidebar":"docs","previous":{"title":"Deployment","permalink":"/docs/iaas/deployment-examples/testbed/deployment"},"next":{"title":"Troubleshooting","permalink":"/docs/iaas/deployment-examples/testbed/troubleshooting"}}');var l=s(74848),i=s(28453);const d={sidebar_label:"Usage",sidebar_position:3},r="Usage",o={},c=[{value:"Custom CA",id:"custom-ca",level:2},{value:"VPN access",id:"vpn-access",level:2},{value:"Wireguard",id:"wireguard",level:3},{value:"sshuttle",id:"sshuttle",level:3},{value:"Web interfaces",id:"web-interfaces",level:2},{value:"Usage of the OpenStack CLI",id:"usage-of-the-openstack-cli",level:3},{value:"Advanced Usage",id:"advanced-usage",level:2},{value:"External API",id:"external-api",level:3},{value:"Change versions",id:"change-versions",level:3},{value:"Deploy services",id:"deploy-services",level:3},{value:"Upgrade services",id:"upgrade-services",level:3},{value:"Add new OSD in Ceph",id:"add-new-osd-in-ceph",level:3},{value:"Ceph via Rook (technical preview)",id:"ceph-via-rook-technical-preview",level:3},{value:"Using testbed for OpenStack development",id:"using-testbed-for-openstack-development",level:2},{value:"Example workflow",id:"example-workflow",level:3}];function a(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.header,{children:(0,l.jsx)(t.h1,{id:"usage",children:"Usage"})}),"\n",(0,l.jsx)(t.p,{children:"Deployment must be completed at this point."}),"\n",(0,l.jsx)(t.h2,{id:"custom-ca",children:"Custom CA"}),"\n",(0,l.jsxs)(t.p,{children:["The OSISM Testbed deployment currently uses hostnames in the domain ",(0,l.jsx)(t.code,{children:"testbed.osism.xyz"}),". This is a real domain, and we provide the DNS records matching the addresses used in the OSISM Testbed, so that once you connect to your testbed via a direct link or Wireguard, you can access hosts and servers by their hostname (e.g. ",(0,l.jsx)(t.code,{children:"ssh testbed-manager.testbed.osism.xyz"}),")."]}),"\n",(0,l.jsxs)(t.p,{children:["We also provide a wildcard TLS certificate signed by a custom CA for ",(0,l.jsx)(t.code,{children:"testbed.osism.xyz"})," and ",(0,l.jsx)(t.code,{children:"*.testbed.osism.xyz"}),".\nThis CA is always used for each testbed. The CA is not regenerated, and it is not planned to change this for the next 10 years."]}),"\n",(0,l.jsxs)(t.p,{children:["In order for these certificates to be recognized locally as valid, the CA\n",(0,l.jsx)(t.a,{href:"https://raw.githubusercontent.com/osism/testbed/main/environments/kolla/certificates/ca/testbed.crt",children:"environments/kolla/certificates/ca/testbed.crt"}),"\nmust be imported locally."]}),"\n",(0,l.jsx)(t.h2,{id:"vpn-access",children:"VPN access"}),"\n",(0,l.jsxs)(t.p,{children:["You can connect to ",(0,l.jsx)(t.a,{href:"https://regio.digital",children:"REGIO.cloud"})," either by using Wireguard, or sshuttle."]}),"\n",(0,l.jsx)(t.h3,{id:"wireguard",children:"Wireguard"}),"\n",(0,l.jsxs)(t.p,{children:["Install ",(0,l.jsx)(t.a,{href:"https://www.wireguard.com",children:"Wireguard"})," on your workstation. For instructions on how to do\nit on your workstation, please have a look at the documentation of your used distribution."]}),"\n",(0,l.jsxs)(t.p,{children:["Start the wireguard tunnel. (Press ",(0,l.jsx)(t.code,{children:"CTRL+C"})," to keep the tunnel running forever. The ",(0,l.jsx)(t.code,{children:"make target"})," also launches a browser tab with references to all services.)"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"make vpn-wireguard ENVIRONMENT=regiocloud\n"})}),"\n",(0,l.jsx)(t.p,{children:"If you want to connect to the OSISM Testbed from multiple clients, change the client IP\naddress in the downloaded configuration file to be different on each client."}),"\n",(0,l.jsxs)(t.p,{children:["If you only want to download the Wireguard configuration, you can use the ",(0,l.jsx)(t.code,{children:"vpn-wireguard-config"}),"\ntarget. The configuration is then available in the file ",(0,l.jsx)(t.code,{children:"wg-testbed-regiocloud.conf"}),", for example."]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"make vpn-wireguard-config ENVIRONMENT=regiocloud\n"})}),"\n",(0,l.jsx)(t.h3,{id:"sshuttle",children:"sshuttle"}),"\n",(0,l.jsxs)(t.p,{children:["Install ",(0,l.jsx)(t.a,{href:"https://github.com/sshuttle/sshuttle",children:"sshuttle"})," on your workstation, then start the sshuttle tunnel."]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"make vpn-sshuttle ENVIRONMENT=regiocloud\nkillall sshuttle\n"})}),"\n",(0,l.jsx)(t.h2,{id:"web-interfaces",children:"Web interfaces"}),"\n",(0,l.jsxs)(t.p,{children:["All SSL-enabled services within the OSISM Testbed use certs which are signed by the self-signed\n",(0,l.jsx)(t.a,{href:"https://raw.githubusercontent.com/osism/testbed/main/environments/kolla/certificates/ca/testbed.crt",children:"OSISM Testbed CA"}),"\n(Download the file and import it as certification authority to your browser)."]}),"\n",(0,l.jsx)(t.p,{children:"If you want to access the services, please choose the URL from the following table:"}),"\n",(0,l.jsxs)(t.table,{children:[(0,l.jsx)(t.thead,{children:(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Name"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"URL"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Username"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Password"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Note"})]})}),(0,l.jsxs)(t.tbody,{children:[(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"ARA"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.a,{href:"https://ara.testbed.osism.xyz",children:"https://ara.testbed.osism.xyz"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"ara"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"password"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Ceph"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.a,{href:"https://api-int.testbed.osism.xyz:8140",children:"https://api-int.testbed.osism.xyz:8140"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"admin"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"password"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Flower"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.a,{href:"https://flower.testbed.osism.xyz",children:"https://flower.testbed.osism.xyz"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Grafana"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.a,{href:"https://api-int.testbed.osism.xyz:3000",children:"https://api-int.testbed.osism.xyz:3000"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"admin"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"password"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"HAProxy (testbed-node-0)"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.a,{href:"http://testbed-node-0.testbed.osism.xyz:1984",children:"http://testbed-node-0.testbed.osism.xyz:1984"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"openstack"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"password"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"HAProxy (testbed-node-1)"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.a,{href:"http://testbed-node-1.testbed.osism.xyz:1984",children:"http://testbed-node-1.testbed.osism.xyz:1984"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"openstack"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"password"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"HAProxy (testbed-node-2)"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.a,{href:"http://testbed-node-2.testbed.osism.xyz:1984",children:"http://testbed-node-2.testbed.osism.xyz:1984"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"openstack"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"password"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Homer"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.a,{href:"https://homer.testbed.osism.xyz",children:"https://homer.testbed.osism.xyz"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Horizon (via Keystone)"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.a,{href:"https://api.testbed.osism.xyz",children:"https://api.testbed.osism.xyz"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"admin"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"password"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"domain: default"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Horizon (via Keystone)"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.a,{href:"https://api.testbed.osism.xyz",children:"https://api.testbed.osism.xyz"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"test"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"test"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"domain: test"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Netbox"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.a,{href:"https://netbox.testbed.osism.xyz",children:"https://netbox.testbed.osism.xyz"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"admin"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"password"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Netdata"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.a,{href:"http://testbed-manager.testbed.osism.xyz:19999",children:"http://testbed-manager.testbed.osism.xyz:19999"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Nexus"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.a,{href:"https://nexus.testbed.osism.xyz",children:"https://nexus.testbed.osism.xyz"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"admin"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"password"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"OpenSearch Dashboards"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.a,{href:"https://api.testbed.osism.xyz:5601",children:"https://api.testbed.osism.xyz:5601"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"opensearch"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"password"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Prometheus"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.a,{href:"https://api-int.testbed.osism.xyz:9091",children:"https://api-int.testbed.osism.xyz:9091"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"admin"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"password"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"RabbitMQ"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.a,{href:"https://api-int.testbed.osism.xyz:15672",children:"https://api-int.testbed.osism.xyz:15672"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"openstack"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"password"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"phpMyAdmin"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.a,{href:"https://phpmyadmin.testbed.osism.xyz",children:"https://phpmyadmin.testbed.osism.xyz"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"root"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"password"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]})]})]}),"\n",(0,l.jsx)(t.h3,{id:"usage-of-the-openstack-cli",children:"Usage of the OpenStack CLI"}),"\n",(0,l.jsxs)(t.p,{children:["The ",(0,l.jsx)(t.code,{children:"environments/openstack"})," folder contains the files needed for the ",(0,l.jsx)(t.code,{children:"openstack"})," client:"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"cd environments/openstack\nexport OS_CLOUD=<the cloud environment>  # i.e. admin\nopenstack floating ip list\n"})}),"\n",(0,l.jsx)(t.h2,{id:"advanced-usage",children:"Advanced Usage"}),"\n",(0,l.jsx)(t.h3,{id:"external-api",children:"External API"}),"\n",(0,l.jsxs)(t.p,{children:["It is possible to provide the OpenStack APIs and the OpenStack Dashboard via the manager's public IP address.\nThis is not enabled by default, except for the OTC profile. To provide the OpenStack APIs and the\nOpenStack dashboard via the public IP address of the manager, the following changes are necessary in the\n",(0,l.jsx)(t.code,{children:"terraform/environments/regiocloud.tfvars"})," file. If a cloud other than the REGIO.cloud is used, the profile\nof the other cloud is changed accordingly."]}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsxs)(t.p,{children:["Add the customization ",(0,l.jsx)(t.code,{children:"external_api"}),". This customization makes sure that the required security group rules\nare created to allow access to the various OpenStack APIs and the OpenStack dashboard."]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-text",children:"# customisation:external_api\n"})}),"\n"]}),"\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsxs)(t.p,{children:["Set parameter ",(0,l.jsx)(t.code,{children:"external_api"})," to ",(0,l.jsx)(t.code,{children:"true"}),". This makes sure that all necessary changes are made in the configuration repository when the manager service is deployed. It is correct that this is added as a comment."]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-text",children:"external_api = true\n"})}),"\n"]}),"\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsxs)(t.p,{children:["After the deployment of the manager service and the OpenStack services, the OpenStack APIs and the OpenStack dashboard can be reached via a DNS name. The service ",(0,l.jsx)(t.a,{href:"https://traefik.me",children:"traefik.me"})," is used for the DNS record. Run the following two commands on the manager node to get the DNS record."]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:'$ source /opt/manager-vars.sh\n$ echo "api-${MANAGER_PUBLIC_IP_ADDRESS//./-}.traefik.me"\napi-80-158-46-219.traefik.me\n'})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(t.h3,{id:"change-versions",children:"Change versions"}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsxs)(t.li,{children:["Go to ",(0,l.jsx)(t.code,{children:"/opt/configuration"})," on ",(0,l.jsx)(t.code,{children:"testbed-manager"})]}),"\n",(0,l.jsxs)(t.li,{children:["Run ",(0,l.jsx)(t.code,{children:"./scripts/set-openstack-version.sh 2024.2"})," to set the OpenStack version to ",(0,l.jsx)(t.code,{children:"2024.2"})]}),"\n",(0,l.jsxs)(t.li,{children:["Run ",(0,l.jsx)(t.code,{children:"./scripts/set-ceph-version.sh reef"})," to set the Ceph version to ",(0,l.jsx)(t.code,{children:"reef"})]}),"\n",(0,l.jsxs)(t.li,{children:["Run ",(0,l.jsx)(t.code,{children:"osism update manager"})," to update the manager service"]}),"\n"]}),"\n",(0,l.jsx)(t.h3,{id:"deploy-services",children:"Deploy services"}),"\n",(0,l.jsxs)(t.table,{children:[(0,l.jsx)(t.thead,{children:(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Script"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,l.jsxs)(t.tbody,{children:[(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"/opt/configuration/scripts/deploy/000-manager.sh"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"/opt/configuration/scripts/deploy/001-helpers.sh"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"/opt/configuration/scripts/deploy/100-ceph-with-ansible.sh"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Ceph with Ansible"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"/opt/configuration/scripts/deploy/100-ceph-with-rook.sh"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Ceph with Rook"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"/opt/configuration/scripts/deploy/200-infrastructure.sh"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"/opt/configuration/scripts/deploy/300-openstack.sh"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"/opt/configuration/scripts/deploy/310-openstack-extended.sh"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"/opt/configuration/scripts/deploy/400-monitoring.sh"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"/opt/configuration/scripts/deploy/500-kubernetes.sh"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"/opt/configuration/scripts/deploy/510-clusterapi.sh"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]})]})]}),"\n",(0,l.jsx)(t.h3,{id:"upgrade-services",children:"Upgrade services"}),"\n",(0,l.jsxs)(t.table,{children:[(0,l.jsx)(t.thead,{children:(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Script"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,l.jsxs)(t.tbody,{children:[(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"/opt/configuration/scripts/upgrade/100-ceph-with-ansible.sh"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Ceph with Ansible"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"/opt/configuration/scripts/upgrade/100-ceph-with-rook.sh"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Ceph with Rook"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"/opt/configuration/scripts/upgrade/200-infrastructure.sh"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"/opt/configuration/scripts/upgrade/300-openstack.sh"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"/opt/configuration/scripts/upgrade/310-openstack-extended.sh"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"/opt/configuration/scripts/upgrade/400-monitoring.sh"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"/opt/configuration/scripts/upgrade/500-kubernetes.sh"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"/opt/configuration/scripts/upgrade/510-clusterapi.sh"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]})]})]}),"\n",(0,l.jsx)(t.h3,{id:"add-new-osd-in-ceph",children:"Add new OSD in Ceph"}),"\n",(0,l.jsx)(t.p,{children:"In the testbed, three volumes per node are provided for use by Ceph by default. Two of\nthese devices are used as OSDs during the initial deployment. The third device is intended\nfor testing the addition of a further OSD to the Ceph cluster."}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsxs)(t.li,{children:["Add ",(0,l.jsx)(t.code,{children:"sdd"})," to ",(0,l.jsx)(t.code,{children:"ceph_osd_devices"})," in ",(0,l.jsx)(t.code,{children:"/opt/configuration/inventory/host_vars/testbed-node-0/ceph-lvm-configuration.yml"}),"."]}),"\n"]}),"\n",(0,l.jsx)(t.admonition,{type:"info",children:(0,l.jsxs)(t.p,{children:["The following content is an example, the IDs look different everywhere. Do not copy 1:1 but only add ",(0,l.jsx)(t.code,{children:"sdd"})," to the file."]})}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-yaml",children:"---\n#\n# This is Ceph LVM configuration for testbed-node-0\n# generated by ceph-configure-lvm-volumes playbook.\n#\nceph_osd_devices:\n  sdb:\n    osd_lvm_uuid: 95a9a2e0-b23f-55b2-a04f-e02ddfc0e82a\n  sdc:\n    osd_lvm_uuid: 29899765-42bf-557b-ae9c-5c7c984b2243\n  sdd:\nlvm_volumes:\n- data: osd-block-95a9a2e0-b23f-55b2-a04f-e02ddfc0e82a\n  data_vg: ceph-95a9a2e0-b23f-55b2-a04f-e02ddfc0e82a\n- data: osd-block-29899765-42bf-557b-ae9c-5c7c984b2243\n  data_vg: ceph-29899765-42bf-557b-ae9c-5c7c984b2243\n"})}),"\n",(0,l.jsxs)(t.ol,{start:"2",children:["\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsxs)(t.p,{children:["Run ",(0,l.jsx)(t.code,{children:"osism apply ceph-configure-lvm-volumes -l testbed-node-0"})]}),"\n"]}),"\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsxs)(t.p,{children:["Run ",(0,l.jsx)(t.code,{children:"cp /tmp/testbed-node-0-ceph-lvm-configuration.yml /opt/configuration/inventory/host_vars/testbed-node-0/ceph-lvm-configuration.yml"}),"."]}),"\n"]}),"\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsxs)(t.p,{children:["Run ",(0,l.jsx)(t.code,{children:"osism reconciler sync"})]}),"\n"]}),"\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsxs)(t.p,{children:["Run ",(0,l.jsx)(t.code,{children:"osism apply ceph-create-lvm-devices -l testbed-node-0"})]}),"\n"]}),"\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsxs)(t.p,{children:["Run ",(0,l.jsx)(t.code,{children:"osism apply ceph-osds -l testbed-node-0 -e ceph_handler_osds_restart=false"})]}),"\n"]}),"\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsx)(t.p,{children:"Check the OSD tree"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-console",children:"$ ceph osd tree\nID  CLASS  WEIGHT   TYPE NAME                STATUS  REWEIGHT  PRI-AFF\n-1         0.13640  root default\n-3         0.05846      host testbed-node-0\n 2    hdd  0.01949          osd.2                up   1.00000  1.00000\n 4    hdd  0.01949          osd.4                up   1.00000  1.00000\n 6    hdd  0.01949          osd.6                up   1.00000  1.00000\n-5         0.03897      host testbed-node-1\n 0    hdd  0.01949          osd.0                up   1.00000  1.00000\n 5    hdd  0.01949          osd.5                up   1.00000  1.00000\n-7         0.03897      host testbed-node-2\n 1    hdd  0.01949          osd.1                up   1.00000  1.00000\n 3    hdd  0.01949          osd.3                up   1.00000  1.00000\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(t.h3,{id:"ceph-via-rook-technical-preview",children:"Ceph via Rook (technical preview)"}),"\n",(0,l.jsxs)(t.p,{children:["Please have a look at ",(0,l.jsx)(t.a,{href:"../guides/deploy-guide/services/ceph/rook.md",children:"Deploy Guide - Services - Rook"})," and ",(0,l.jsx)(t.a,{href:"../guides/configuration-guide/ceph/rook.md",children:"Configuration Guide - Rook"})," for details on how to configure Rook."]}),"\n",(0,l.jsx)(t.p,{children:"To deploy this in the testbed, you can use an environment variable in your make target."}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"make CEPH_STACK=rook manager\nmake CEPH_STACK=rook ceph\n"})}),"\n",(0,l.jsxs)(t.p,{children:["This will make sure ",(0,l.jsx)(t.code,{children:"/opt/manager-vars.sh"})," gets ",(0,l.jsx)(t.code,{children:"CEPH_STACK=rook"})," set which is later being used by:"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"/opt/configuration/scripts/deploy-services.sh\n/opt/configuration/scripts/deploy-ceph.sh\n/opt/configuration/scripts/upgrade/100-ceph-with-rook.sh\n"})}),"\n",(0,l.jsx)(t.h2,{id:"using-testbed-for-openstack-development",children:"Using testbed for OpenStack development"}),"\n",(0,l.jsxs)(t.p,{children:["Testbed may be used for doing development on OpenStack services through ",(0,l.jsx)(t.a,{href:"https://docs.openstack.org/kolla-ansible/latest/contributor/kolla-for-openstack-development.html",children:(0,l.jsx)(t.code,{children:"kolla_dev_mode"})}),".\n",(0,l.jsx)(t.code,{children:"kolla_dev_mode"})," may be activated for all supported service by adding"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-yaml",children:"kolla_dev_mode: true\n"})}),"\n",(0,l.jsxs)(t.p,{children:["to ",(0,l.jsx)(t.code,{children:"environments/kolla/configuration.yml"}),". This will check out the ",(0,l.jsx)(t.code,{children:"git"})," repositories of all supported and enabled OpenStack services under ",(0,l.jsx)(t.code,{children:"/opt/stack"}),", and bind mount them into the appropriate containers.\nSince this will fetch a lot of repositories it is advisable to enable this only selectively for the services you are going to work on. You can do so by adding a boolean variable to ",(0,l.jsx)(t.code,{children:"environments/kolla/configuration.yml"})," consisting of the service name and the suffix ",(0,l.jsx)(t.code,{children:"_dev_mode"}),", e.g.:"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-yaml",children:"cinder_dev_mode: true\n"})}),"\n",(0,l.jsxs)(t.p,{children:["You may customize the used ",(0,l.jsx)(t.code,{children:"git"})," repository by adding ",(0,l.jsx)(t.code,{children:"kolla_repos_git"})," to ",(0,l.jsx)(t.code,{children:"environments/kolla/configuration.yml"})," to specify a common root for the repositories of all services, which will be completed by the service's name, e.g.:"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-yaml",children:'kolla_repos_git: "https://github.com/openstack"\n'})}),"\n",(0,l.jsxs)(t.p,{children:["This will pull services from their ",(0,l.jsx)(t.code,{children:"github"})," mirror. E.g. pull nova from ",(0,l.jsx)(t.a,{href:"https://github.com/openstack/nova",children:"https://github.com/openstack/nova"}),"\nThe complete repository of a single service may be changed by adding a variable consisting of the service name and the suffix ",(0,l.jsx)(t.code,{children:"_git_repository"}),", e.g.:"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-yaml",children:'cinder_git_repository: "https://github.com/myorg/my_custom_cinder_fork"\n'})}),"\n",(0,l.jsxs)(t.p,{children:["You may specify the ",(0,l.jsx)(t.code,{children:"git"})," reference globally by setting"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-yaml",children:"kolla_source_version: my_feature_branch\n"})}),"\n",(0,l.jsxs)(t.p,{children:["in ",(0,l.jsx)(t.code,{children:"environments/kolla/configuration.yml"}),", or for specific services, via service name and suffix ",(0,l.jsx)(t.code,{children:"_source_version"}),", e.g.:"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-yaml",children:"cinder_source_version: my_cinder_feature\n"})}),"\n",(0,l.jsxs)(t.p,{children:["In order to update the ",(0,l.jsx)(t.code,{children:"git"})," repositories on ",(0,l.jsx)(t.code,{children:"kolla-ansible"})," deployments set either"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-yaml",children:"kolla_dev_repos_pull: true\n"})}),"\n",(0,l.jsx)(t.p,{children:"or"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-yaml",children:"cinder_dev_repos_pull: true\n"})}),"\n",(0,l.jsxs)(t.p,{children:["in ",(0,l.jsx)(t.code,{children:"environments/kolla/configuration.yml"})," to set the setting for all repositories, or a service specific one."]}),"\n",(0,l.jsx)(t.h3,{id:"example-workflow",children:"Example workflow"}),"\n",(0,l.jsx)(t.p,{children:"Thus, as an example for a development workflow:"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:["Create a ",(0,l.jsx)(t.code,{children:"git"})," mirror of the OpenStack service you want to work on"]}),"\n",(0,l.jsxs)(t.li,{children:["In ",(0,l.jsx)(t.code,{children:"environments/kolla/configuration.yml"}),":","\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:["Set the corresponding ",(0,l.jsx)(t.code,{children:"<service name>_dev_mode"})," variable to ",(0,l.jsx)(t.code,{children:"true"})]}),"\n",(0,l.jsxs)(t.li,{children:["Set the corresponding ",(0,l.jsx)(t.code,{children:"<service name>_git_repository"})," variable to your development mirror created above"]}),"\n",(0,l.jsxs)(t.li,{children:["Set the corresponding ",(0,l.jsx)(t.code,{children:"<service name>_source_version"})," variable to a branch name you intend to push your changes to"]}),"\n",(0,l.jsxs)(t.li,{children:["Set the corresponding ",(0,l.jsx)(t.code,{children:"<service name>_dev_repos_pull"})," variable to ",(0,l.jsx)(t.code,{children:"true"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(t.li,{children:"Commit your changes and push them to the specified branch in the specified mirror"}),"\n",(0,l.jsxs)(t.li,{children:["Run ",(0,l.jsx)(t.code,{children:"osism apply <service name>"})," on the manager to checkout the code on every testbed node"]}),"\n",(0,l.jsx)(t.li,{children:"Restart the service containers to actually pick up the new code"}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,l.jsx)(t,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},28453:(e,t,s)=>{s.d(t,{R:()=>d,x:()=>r});var n=s(96540);const l={},i=n.createContext(l);function d(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);