"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[53910],{42472:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"iaas/guides/configuration-guide/ceph/index","title":"Ceph","description":"The official Ceph documentation is located on https://docs.ceph.com/en/latest/rados/configuration/","source":"@site/docs/02-iaas/guides/configuration-guide/ceph/index.mdx","sourceDirName":"02-iaas/guides/configuration-guide/ceph","slug":"/iaas/guides/configuration-guide/ceph/","permalink":"/docs/iaas/guides/configuration-guide/ceph/","draft":false,"unlisted":false,"editUrl":"https://github.com/SovereignCloudStack/docs/tree/main/docs/02-iaas/guides/configuration-guide/ceph/index.mdx","tags":[],"version":"current","sidebarPosition":30,"frontMatter":{"sidebar_label":"Ceph","sidebar_key":"configuration-guide-ceph","sidebar_position":30},"sidebar":"docs","previous":{"title":"Loadbalancer","permalink":"/docs/iaas/guides/configuration-guide/loadbalancer"},"next":{"title":"Configuration for Rook","permalink":"/docs/iaas/guides/configuration-guide/ceph/rook"}}');var d=s(74848),c=s(28453),a=s(11470),r=s(19365);const o={sidebar_label:"Ceph",sidebar_key:"configuration-guide-ceph",sidebar_position:30},t="Ceph",l={},h=[{value:"Unique Identifier",id:"unique-identifier",level:2},{value:"Client",id:"client",level:2},{value:"Swappiness",id:"swappiness",level:2},{value:"RGW service",id:"rgw-service",level:2},{value:"Pools and Keys",id:"pools-and-keys",level:2},{value:"Extra pools",id:"extra-pools",level:3},{value:"Extra keys",id:"extra-keys",level:3},{value:"OSD devices",id:"osd-devices",level:2},{value:"Full examples",id:"full-examples",level:3},{value:"Use of dedicated DB devices",id:"use-of-dedicated-db-devices",level:4},{value:"Use of partitions",id:"use-of-partitions",level:4},{value:"Add a new osd",id:"add-a-new-osd",level:3},{value:"Dashboard",id:"dashboard",level:2},{value:"Configuring the openstack loadbalancer to expose the ceph dashboard",id:"configuring-the-openstack-loadbalancer-to-expose-the-ceph-dashboard",level:3},{value:"Second Ceph cluster",id:"second-ceph-cluster",level:2},{value:"Resource limits",id:"resource-limits",level:2},{value:"CPU Pinning",id:"cpu-pinning",level:2},{value:"Use of RBDs for nodes",id:"use-of-rbds-for-nodes",level:2}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"ceph",children:"Ceph"})}),"\n",(0,d.jsxs)(n.p,{children:["The official Ceph documentation is located on ",(0,d.jsx)(n.a,{href:"https://docs.ceph.com/en/latest/rados/configuration/",children:"https://docs.ceph.com/en/latest/rados/configuration/"})]}),"\n",(0,d.jsxs)(n.p,{children:["It is ",(0,d.jsx)(n.strong,{children:"strongly advised"})," to use the documentation for the version being used."]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Pacific - ",(0,d.jsx)(n.a,{href:"https://docs.ceph.com/en/pacific/rados/configuration/",children:"https://docs.ceph.com/en/pacific/rados/configuration/"})]}),"\n",(0,d.jsxs)(n.li,{children:["Quincy - ",(0,d.jsx)(n.a,{href:"https://docs.ceph.com/en/quincy/rados/configuration/",children:"https://docs.ceph.com/en/quincy/rados/configuration/"})]}),"\n",(0,d.jsxs)(n.li,{children:["Reef - ",(0,d.jsx)(n.a,{href:"https://docs.ceph.com/en/reef/rados/configuration/",children:"https://docs.ceph.com/en/reef/rados/configuration/"})]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"unique-identifier",children:"Unique Identifier"}),"\n",(0,d.jsxs)(n.p,{children:["The File System ID is a unique identifier for the cluster.\nThe identifier is set via the parameter ",(0,d.jsx)(n.code,{children:"fsid"})," in ",(0,d.jsx)(n.code,{children:"environments/ceph/configuration.yml"}),"\nand must be unique. It can be generated with ",(0,d.jsx)(n.code,{children:"uuidgen"}),"."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",metastring:'title="environments/ceph/configuration.yml"',children:"fsid: c2120a4a-669c-4769-a32c-b7e9d7b848f4\n"})}),"\n",(0,d.jsx)(n.h2,{id:"client",children:"Client"}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"client.admin"})," keyring is placed in the file ",(0,d.jsx)(n.code,{children:"environments/infrastructure/files/ceph/ceph.client.admin.keyring"}),"."]}),"\n",(0,d.jsx)(n.h2,{id:"swappiness",children:"Swappiness"}),"\n",(0,d.jsxs)(n.p,{children:["The swappiness is set via the ",(0,d.jsx)(n.code,{children:"os_tuning_params"})," dictionary. The dictionary can\nonly be completely overwritten via an entry in the file ",(0,d.jsx)(n.code,{children:"environments/ceph/configuration.yml"}),"."]}),"\n",(0,d.jsxs)(n.p,{children:["By default, the dictionary looks like this. If the swappiness of ",(0,d.jsx)(n.code,{children:"10"})," is to be used, it is not\nnecessary to add the ",(0,d.jsx)(n.code,{children:"os_tuning_params"})," dictionary to the configuration repository. This is only\nnecessary if the swappiness is to be customized."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",metastring:'title="environments/ceph/configuration.yml"',children:'os_tuning_params:\n  - { name: fs.file-max, value: 26234859 }\n  - { name: vm.zone_reclaim_mode, value: 0 }\n  - { name: vm.swappiness, value: 10 }\n  - { name: vm.min_free_kbytes, value: "{{ vm_min_free_kbytes }}" }\n'})}),"\n",(0,d.jsxs)(n.p,{children:["The sysctl parameters are written to the file ",(0,d.jsx)(n.code,{children:"/etc/sysctl.d/ceph-tuning.conf"}),"\non the storage nodes."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-console",children:"# cat /etc/sysctl.d/ceph-tuning.conf\nfs.aio-max-nr=1048576\nfs.file-max=26234859\nvm.zone_reclaim_mode=0\nvm.swappiness=10\nvm.min_free_kbytes=4194303\n"})}),"\n",(0,d.jsx)(n.h2,{id:"rgw-service",children:"RGW service"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Add following configuration in ",(0,d.jsx)(n.code,{children:"environments/ceph/configuration.yml"})]}),"\n",(0,d.jsxs)(a.A,{children:[(0,d.jsx)(r.A,{value:"osism-9",label:"OSISM >= 9.0.0",children:(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",metastring:'title="environments/ceph/configuration.yml"',children:'ceph_conf_overrides:\n  "client.rgw.{{ rgw_zone }}.{{ hostvars[inventory_hostname][\'ansible_hostname\'] }}.rgw0":\n    "rgw content length compat": "true"\n    "rgw enable apis": "swift, s3, admin"\n    "rgw keystone accepted roles": "member, admin"\n    "rgw keystone accepted admin roles": "admin"\n    "rgw keystone admin domain": "default"\n    "rgw keystone admin password": "{{ ceph_rgw_keystone_password }}"\n    "rgw keystone admin project": "service"\n    "rgw keystone admin tenant": "service"\n    "rgw keystone admin user": "ceph_rgw"\n    "rgw keystone api version": "3"\n    "rgw keystone url": "https://api-int.testbed.osism.xyz:5000"\n    "rgw keystone verify ssl": "false"\n    "rgw keystone implicit tenants": "true"\n    "rgw s3 auth use keystone": "true"\n    "rgw swift account in url": "true"\n    "rgw swift versioning enabled": "true"\n'})})}),(0,d.jsx)(r.A,{value:"osism-8",label:"OSISM < 9.0.0",children:(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",metastring:'title="environments/ceph/configuration.yml"',children:'ceph_conf_overrides:\n  "client.rgw.{{ hostvars[inventory_hostname][\'ansible_hostname\'] }}.rgw0":\n    "rgw content length compat": "true"\n    "rgw enable apis": "swift, s3, admin"\n    "rgw keystone accepted roles": "member, admin"\n    "rgw keystone accepted admin roles": "admin"\n    "rgw keystone admin domain": "default"\n    "rgw keystone admin password": "{{ ceph_rgw_keystone_password }}"\n    "rgw keystone admin project": "service"\n    "rgw keystone admin tenant": "service"\n    "rgw keystone admin user": "ceph_rgw"\n    "rgw keystone api version": "3"\n    "rgw keystone url": "https://api-int.testbed.osism.xyz:5000"\n    "rgw keystone verify ssl": "false"\n    "rgw keystone implicit tenants": "true"\n    "rgw s3 auth use keystone": "true"\n    "rgw swift account in url": "true"\n    "rgw swift versioning enabled": "true"\n'})})})]}),"\n",(0,d.jsxs)(n.p,{children:["If the ",(0,d.jsx)(n.code,{children:"ceph_conf_overrides"})," parameter already exists in ",(0,d.jsx)(n.code,{children:"environments/ceph/configuration.yml"}),",\nexpand it and do not overwrite it."]}),"\n",(0,d.jsx)(n.p,{children:"If self-signed SSL certificates are used, two additional parameters must be set."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",metastring:'title="environments/ceph/configuration.yml"',children:' "rgw keystone verify ssl": "false"\n "rgw verify ssl": "false"\n'})}),"\n",(0,d.jsxs)(n.p,{children:["For all possible configuration parameters visit the\n",(0,d.jsx)(n.a,{href:"https://docs.ceph.com/en/quincy/radosgw/config-ref/",children:"Ceph configuration reference"}),"."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Add the ",(0,d.jsx)(n.code,{children:"ceph_rgw_keystone_password"})," from ",(0,d.jsx)(n.code,{children:"environments/kolla/secrets.yml"})," to\n",(0,d.jsx)(n.code,{children:"environments/ceph/secrets.yml"}),"."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Add following configuration in ",(0,d.jsx)(n.code,{children:"environments/kolla/configuration.yml"})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",metastring:'title="environments/kolla/configuration.yml"',children:"enable_ceph_rgw: true\nenable_ceph_rgw_keystone: true\n\nceph_rgw_swift_compatibility: false\nceph_rgw_swift_account_in_url: true\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["On the nodes on which the RGW service is to be deployed, ",(0,d.jsx)(n.code,{children:"radosgw_interface"})," ",(0,d.jsx)(n.strong,{children:"or"}),"\n",(0,d.jsx)(n.code,{children:"radosgw_address"})," must be set in the host vars for the nodes in the inventory.\nIf ",(0,d.jsx)(n.code,{children:"radosgw_interface"})," is used, the first IPv4 address on this interface is used."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",metastring:"title=inventory/host_vars/testbed-node-0.testbed.osism.xyz/vars.yml",children:"##########################################################\n# ceph\n\nradosgw_address: 192.168.16.10\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["The nodes on which the RGW service is to be deployed can be defined in inventory group\n",(0,d.jsx)(n.code,{children:"ceph-rgw"}),". By default, the RGW services are deployed on the Ceph control nodes.."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ini",metastring:'title="inventory/20-roles"',children:"[ceph-rgw:children]\nceph-control\n"})}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"pools-and-keys",children:"Pools and Keys"}),"\n",(0,d.jsxs)(n.p,{children:["The defaults for pools are defined in the ",(0,d.jsx)(n.a,{href:"https://github.com/osism/defaults/blob/main/all/099-ceph.yml",children:"osism/defaults"}),"\nrepository:"]}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{style:{textAlign:"left"},children:"Parameter"}),(0,d.jsx)(n.th,{style:{textAlign:"left"},children:"Default value"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{style:{textAlign:"left"},children:(0,d.jsx)(n.code,{children:"openstack_pool_default_min_size"})}),(0,d.jsx)(n.td,{style:{textAlign:"left"},children:"0"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{style:{textAlign:"left"},children:(0,d.jsx)(n.code,{children:"openstack_pool_default_pg_autoscale_mode"})}),(0,d.jsx)(n.td,{style:{textAlign:"left"},children:"false"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{style:{textAlign:"left"},children:(0,d.jsx)(n.code,{children:"openstack_pool_default_pg_num"})}),(0,d.jsx)(n.td,{style:{textAlign:"left"},children:"64"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{style:{textAlign:"left"},children:(0,d.jsx)(n.code,{children:"openstack_pool_default_rule_name"})}),(0,d.jsx)(n.td,{style:{textAlign:"left"},children:(0,d.jsx)(n.code,{children:"replicated_rule"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{style:{textAlign:"left"},children:(0,d.jsx)(n.code,{children:"openstack_pool_default_size"})}),(0,d.jsx)(n.td,{style:{textAlign:"left"},children:"3"})]})]})]}),"\n",(0,d.jsx)(n.admonition,{type:"warning",children:(0,d.jsxs)(n.p,{children:["The autoscaler for pools is not enabled by default and the number of PGs used when creating\na pool is very low. Either you enable the autoscaler by default or you have to\n",(0,d.jsx)(n.a,{href:"/docs/iaas/guides/operations-guide/ceph/#set-number-of-pgs-for-a-pool",children:"adjust the number of PGs"}),"\naccordingly after the initial creation of the pools."]})}),"\n",(0,d.jsx)(n.h3,{id:"extra-pools",children:"Extra pools"}),"\n",(0,d.jsxs)(n.p,{children:["Extra pools can be defined via the ",(0,d.jsx)(n.code,{children:"openstack_pools_extra"})," parameter."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",metastring:'title="environments/ceph/configuration.yml"',children:'openstack_extra001_pool:\n  name: extra001\n  pg_num: "{{ openstack_pool_default_pg_num }}"\n  pgp_num: "{{ openstack_pool_default_pg_num }}"\n  rule_name: "replicated_rule"\n  type: 1\n  erasure_profile: ""\n  expected_num_objects: ""\n  application: "rbd"\n  size: "{{ openstack_pool_default_size }}"\n  min_size: "{{ openstack_pool_default_min_size }}"\n  pg_autoscale_mode: "{{ openstack_pool_default_pg_autoscale_mode }}"\n\nopenstack_pools_extra:\n  - "{{ openstack_extra001_pool }}"\n'})}),"\n",(0,d.jsxs)(n.p,{children:["If more than one Ceph cluster is managed with one manager, do not place the\nparameters in ",(0,d.jsx)(n.code,{children:"environments/ceph/configuration.yml"})," but in a corresponding file."]}),"\n",(0,d.jsxs)(n.p,{children:["The extra pools can then be created by calling ",(0,d.jsx)(n.code,{children:"osism apply ceph-pools"}),"."]}),"\n",(0,d.jsx)(n.h3,{id:"extra-keys",children:"Extra keys"}),"\n",(0,d.jsxs)(n.p,{children:["Extra keys can be defined via the ",(0,d.jsx)(n.code,{children:"openstack_keys_extra"})," parameter."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",metastring:'title="environments/ceph/configuration.yml"',children:'openstack_extra001_key:\n  - name: client.extra001\n    caps:\n      mon: "profile rbd"\n      osd: "profile rbd pool={{ openstack_extra001_pool.name }}"\n    mode: "0600"\n\nopenstack_keys_extra:\n  - "{{ openstack_extra001_key }}"\n'})}),"\n",(0,d.jsx)(n.p,{children:"The key is also added in the manager environment to copy it to the correct location."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",metastring:'title="environments/manager/configuration.yml"',children:'ceph_custom_keys:\n  - src: ceph.client.extra001.keyring\n    dest: "{{ configuration_directory }}/environments/infrastructure/files/ceph/ceph.client.extra001.keyring"\n'})}),"\n",(0,d.jsxs)(n.p,{children:["The extra keys can then be created by calling ",(0,d.jsx)(n.code,{children:"osism apply ceph-pools"}),"."]}),"\n",(0,d.jsxs)(n.p,{children:["The extra keys can then be fetched and copied by calling ",(0,d.jsx)(n.code,{children:"osism apply ceph-copy-keys"}),"."]}),"\n",(0,d.jsx)(n.h2,{id:"osd-devices",children:"OSD devices"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["For each Ceph storage node edit the file ",(0,d.jsx)(n.code,{children:"inventory/host_vars/<nodename>.yml"}),"\nadd a configuration like the following to it. Ensure that no ",(0,d.jsx)(n.code,{children:"devices"})," parameter\nis present in the file."]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Parameters"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["With the optional parameter ",(0,d.jsx)(n.code,{children:"ceph_osd_db_wal_devices_buffer_space_percent"})," it is possible to\nset the percentage of VGs to leave free. The parameter is not set by default. Can be helpful\nfor SSD performance of some older SSD models or to extend lifetime of SSDs in general."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_osd_db_wal_devices_buffer_space_percent: 10\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["It is possible to configure the devices to be used with the parameters ",(0,d.jsx)(n.code,{children:"ceph_osd_devices"}),",\n",(0,d.jsx)(n.code,{children:"ceph_db_devices"}),", ",(0,d.jsx)(n.code,{children:"ceph_wal_devices"}),", and ",(0,d.jsx)(n.code,{children:"ceph_db_wal_devices"}),". This is described below."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["It is always possible to use device names such as ",(0,d.jsx)(n.code,{children:"sda"})," or device IDs such as\n",(0,d.jsx)(n.code,{children:"disk/by-id/wwn-<something>"})," or ",(0,d.jsx)(n.code,{children:"disk/by-id/nvme-eui.<something>"}),". ",(0,d.jsx)(n.code,{children:"/dev/"})," is not\nprefixed and is added automatically."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"db_size"})," parameter is optional and defaults to ",(0,d.jsx)(n.code,{children:"(VG size - buffer space (if enabled)) / num_osds"}),"."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"wal_size"})," parameter is optional and defaults to ",(0,d.jsx)(n.code,{children:"2 GB"}),"."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"num_osds"})," parameter specifies the maximum number of OSDs that can be assigned to a WAL device or DB device."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["The optional parameter ",(0,d.jsx)(n.code,{children:"wal_pv"})," can be used to set the device that is to be used as the WAL device."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["The optional parameter ",(0,d.jsx)(n.code,{children:"db_pv"})," can be used to set the device that is to be used as the DB device."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"OSD only"}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"sda"})," device will be used as an OSD device without WAL and DB device."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_osd_devices:\n  sda:\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"OSD + DB device"}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"nvme0n1"})," device will be used as an DB device. It is possible to use this DB device for up to 6 OSDs. Each\nOSD is provided with 30 GB."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_db_devices:\n  nvme0n1:\n    num_osds: 6\n    db_size: 30 GB\n"})}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"sda"})," device will be used as an OSD device with ",(0,d.jsx)(n.code,{children:"nvme0n1"})," as DB device."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_osd_devices:\n   sda:\n     db_pv: nvme0n1\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"OSD + WAL device"}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"nvme0n1"})," device will be used as an WAL device. It is possible to use this WAL device for up to 6 OSDs. Each\nOSD is provided with 2 GB."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_wal_devices:\n  nvme0n1:\n    num_osds: 6\n    wal_size: 2 GB\n"})}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"sda"})," device will be used as an OSD device with ",(0,d.jsx)(n.code,{children:"nvme0n1"})," as WAL device."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_osd_devices:\n   sda:\n     wal_pv: nvme0n1\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"OSD + DB device + WAL device (same device for DB + WAL)"}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"nvme0n1"})," device will be used as an DB device and a WAL device. It is possible to use those devices for up\nto 6 OSDs."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_db_wal_devices:\n  nvme0n1:\n    num_osds: 6\n    db_size: 30 GB\n    wal_size: 2 GB\n"})}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"sda"})," device will be used as an OSD device with ",(0,d.jsx)(n.code,{children:"nvme0n1"})," as DB device and ",(0,d.jsx)(n.code,{children:"nvme0n1"})," as WAL device."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_osd_devices:\n   sda:\n     db_pv: nvme0n1\n     wal_pv: nvme0n1\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"OSD + DB device + WAL device (different device for DB + WAL)"}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"nvme0n1"})," device will be used as an DB device. It is possible to use this DB device for up to 6 OSDs. Each\nOSD is provided with 30 GB."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_db_devices:\n  nvme0n1:\n    num_osds: 6\n    db_size: 30 GB\n"})}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"nvme1n1"})," device will be used as an WAL device. It is possible to use this WAL device for up to 6 OSDs. Each\nOSD is provided with 2 GB."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_wal_devices:\n  nvme1n1:\n    num_osds: 6\n    wal_size: 2 GB\n"})}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"sda"})," device will be used as an OSD device with ",(0,d.jsx)(n.code,{children:"nvme0n1"})," as DB device and ",(0,d.jsx)(n.code,{children:"nvme1n1"})," as WAL device."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_osd_devices:\n   sda:\n     db_pv: nvme0n1\n     wal_pv: nvme1n1\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Push the configuration to your configuration repository and after that do the following"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"osism apply configuration\nosism reconciler sync\nosism apply facts\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"After the configuration has been pulled and facts updated,\nyou can run the LVM configuration playbook:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"osism apply ceph-configure-lvm-volumes\n"})}),"\n",(0,d.jsxs)(n.p,{children:["This will generate a new configuration file for each node in ",(0,d.jsx)(n.code,{children:"/tmp"}),"\non the first manager node named ",(0,d.jsx)(n.code,{children:"<nodename>-ceph-lvm-configuration.yml"}),"."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Take the generated configuration file from ",(0,d.jsx)(n.code,{children:"/tmp"})," and ",(0,d.jsx)(n.strong,{children:"replace the previously\nconfiguration"})," for each node."]}),"\n",(0,d.jsxs)(n.p,{children:["In this example, the following content was in the host vars file before\n",(0,d.jsx)(n.code,{children:"osism apply ceph-configure-lvm-volumes"})," was called."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_osd_devices:\n  sdb:\n  sdc:\n"})}),"\n",(0,d.jsxs)(n.p,{children:["The following content has now been generated in the file in the ",(0,d.jsx)(n.code,{children:"/tmp"})," directory by running\n",(0,d.jsx)(n.code,{children:"osism apply ceph-configure-lvm-volumes"}),"."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_osd_devices:\n  sdb:\n    osd_lvm_uuid: 196aad32-7cc4-5350-8a45-1b03f50fc9bb\n  sdc:\n    osd_lvm_uuid: c6df96be-1264-5815-9cb2-da5eb453a6de\nlvm_volumes:\n- data: osd-block-196aad32-7cc4-5350-8a45-1b03f50fc9bb\n  data_vg: ceph-196aad32-7cc4-5350-8a45-1b03f50fc9bb\n- data: osd-block-c6df96be-1264-5815-9cb2-da5eb453a6de\n  data_vg: ceph-c6df96be-1264-5815-9cb2-da5eb453a6de\n"})}),"\n",(0,d.jsxs)(n.p,{children:["This content from the file in the ",(0,d.jsx)(n.code,{children:"/tmp"})," directory is added in the host vars file.\nThe previous ",(0,d.jsx)(n.code,{children:"ceph_osd_devices"})," is replaced with the new content."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Push the updated configuration ",(0,d.jsx)(n.strong,{children:"again"})," to your configuration repository and re-run:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"osism apply configuration\nosism reconciler sync\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Finally create the LVM devices."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"osism apply ceph-create-lvm-devices\n"})}),"\n",(0,d.jsx)(n.p,{children:"These PVs, VGs and LVs are created using the example from step 4."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-console",children:"$ sudo pvs\nPV         VG                                        Fmt  Attr PSize   PFree\n/dev/sdb   ceph-196aad32-7cc4-5350-8a45-1b03f50fc9bb lvm2 a--  <20.00g    0\n/dev/sdc   ceph-c6df96be-1264-5815-9cb2-da5eb453a6de lvm2 a--  <20.00g    0\n\n$ sudo vgs\nVG                                        #PV #LV #SN Attr   VSize   VFree\nceph-196aad32-7cc4-5350-8a45-1b03f50fc9bb   1   1   0 wz--n- <20.00g    0\nceph-c6df96be-1264-5815-9cb2-da5eb453a6de   1   1   0 wz--n- <20.00g    0\n\n$ sudo lvs\nLV                                             VG                                        Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert\nosd-block-196aad32-7cc4-5350-8a45-1b03f50fc9bb ceph-196aad32-7cc4-5350-8a45-1b03f50fc9bb -wi-a----- <20.00g\nosd-block-c6df96be-1264-5815-9cb2-da5eb453a6de ceph-c6df96be-1264-5815-9cb2-da5eb453a6de -wi-a----- <20.00g\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Everything is now ready for the deployment of the OSDs.\nDetails on deploying Ceph in the ",(0,d.jsx)(n.a,{href:"/docs/iaas/guides/deploy-guide/services/ceph/",children:"Ceph Deploy Guide"}),"."]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"full-examples",children:"Full examples"}),"\n",(0,d.jsx)(n.h4,{id:"use-of-dedicated-db-devices",children:"Use of dedicated DB devices"}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"ceph_osd_devices"})," and ",(0,d.jsx)(n.code,{children:"ceph_db_devices"})," parameters with the following content are initially added\nin the host vars of the node. Devices ",(0,d.jsx)(n.code,{children:"/dev/sda"})," and ",(0,d.jsx)(n.code,{children:"/dev/sdb"})," are used as OSD devices. The device ",(0,d.jsx)(n.code,{children:"/dev/sdd"}),"\nis used as a DB device for up to 2 OSDs. For each OSD that uses ",(0,d.jsx)(n.code,{children:"/dev/sdd"})," as DB device, an LV volume of\n(in this case) 30 GByte is created. Please note that at least 30 GByte must be used for a DB device in production."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_db_devices:\n  sdd:\n    num_osds: 2\n    db_size: 30 GB\n\nceph_osd_devices:\n  sdb:\n    db_pv: sdd\n  sdc:\n    db_pv: sdd\n"})}),"\n",(0,d.jsxs)(n.p,{children:["Then generate the required LVM2 device configuration with the ",(0,d.jsx)(n.code,{children:"ceph-configure-lvm-volumes"})," play."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"osism apply facts\nosism reconciler sync\nosism apply ceph-configure-lvm-volumes\n"})}),"\n",(0,d.jsxs)(n.p,{children:["Check the ",(0,d.jsx)(n.code,{children:"/tmp"})," directory on the manager node for files like ",(0,d.jsx)(n.code,{children:"testbed-node-0.testbed.osism.xyz-ceph-lvm-configuration.yml"}),".\nAdd this content to the host vars of the corresponding node. The existing ",(0,d.jsx)(n.code,{children:"ceph_osd_devices"})," parameter is replaced."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"---\n#\n# This is Ceph LVM configuration for testbed-node-0.testbed.osism.xyz\n# generated by ceph-configure-lvm-volumes playbook.\n#\nceph_db_devices:\n  sdd:\n    db_size: 30 GB\n    num_osds: 2\n    vg_name: ceph-db-eb7522b1-41cf-522e-8d7e-2a4a82a879bb\nceph_osd_devices:\n  sdb:\n    db_pv: sdd\n    osd_lvm_uuid: 75960289-2e0e-525d-8bb5-dd8552531ef5\n  sdc:\n    db_pv: sdd\n    osd_lvm_uuid: ce2c2cb6-f911-52dd-b57f-4476bf7afe9f\nlvm_volumes:\n- data: osd-block-75960289-2e0e-525d-8bb5-dd8552531ef5\n  data_vg: ceph-75960289-2e0e-525d-8bb5-dd8552531ef5\n  db: osd-db-75960289-2e0e-525d-8bb5-dd8552531ef5\n  db_vg: ceph-db-eb7522b1-41cf-522e-8d7e-2a4a82a879bb\n- data: osd-block-ce2c2cb6-f911-52dd-b57f-4476bf7afe9f\n  data_vg: ceph-ce2c2cb6-f911-52dd-b57f-4476bf7afe9f\n  db: osd-db-ce2c2cb6-f911-52dd-b57f-4476bf7afe9f\n  db_vg: ceph-db-eb7522b1-41cf-522e-8d7e-2a4a82a879bb\n"})}),"\n",(0,d.jsxs)(n.p,{children:["Finally, create the necessary PVs, VGs and LVs. The parameter ",(0,d.jsx)(n.code,{children:"-e ignore_db_too_small=true"})," is only set\nhere in the example because we use less than 30 GByte for the size of the DB LV."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"osism reconciler sync\nosism apply ceph-create-lvm-devices -e ignore_db_too_small=true\n"})}),"\n",(0,d.jsx)(n.p,{children:"You can check the PVs, VGs, and LVs on the node."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-console",children:"$ sudo pvs\nPV         VG                                           Fmt  Attr PSize   PFree\n/dev/sdb   ceph-75960289-2e0e-525d-8bb5-dd8552531ef5    lvm2 a--  <20.00g      0\n/dev/sdc   ceph-ce2c2cb6-f911-52dd-b57f-4476bf7afe9f    lvm2 a--  <20.00g      0\n/dev/sdd   ceph-db-eb7522b1-41cf-522e-8d7e-2a4a82a879bb lvm2 a--  <20.00g <10.00g\n\n$ sudo vgs\nVG                                           #PV #LV #SN Attr   VSize   VFree\nceph-75960289-2e0e-525d-8bb5-dd8552531ef5      1   1   0 wz--n- <20.00g      0\nceph-ce2c2cb6-f911-52dd-b57f-4476bf7afe9f      1   1   0 wz--n- <20.00g      0\nceph-db-eb7522b1-41cf-522e-8d7e-2a4a82a879bb   1   2   0 wz--n- <20.00g <10.00g\n\n$ sudo lvs\nLV                                             VG                                           Attr       LSize   [...]\nosd-block-75960289-2e0e-525d-8bb5-dd8552531ef5 ceph-75960289-2e0e-525d-8bb5-dd8552531ef5    -wi-a----- <20.00g\nosd-block-ce2c2cb6-f911-52dd-b57f-4476bf7afe9f ceph-ce2c2cb6-f911-52dd-b57f-4476bf7afe9f    -wi-a----- <20.00g\nosd-db-75960289-2e0e-525d-8bb5-dd8552531ef5    ceph-db-eb7522b1-41cf-522e-8d7e-2a4a82a879bb -wi-a-----   5.00g\nosd-db-ce2c2cb6-f911-52dd-b57f-4476bf7afe9f    ceph-db-eb7522b1-41cf-522e-8d7e-2a4a82a879bb -wi-a-----   5.00g\n"})}),"\n",(0,d.jsx)(n.h4,{id:"use-of-partitions",children:"Use of partitions"}),"\n",(0,d.jsx)(n.p,{children:"The use of partitions presented in this example is not recommended for use in production but only for POCs."}),"\n",(0,d.jsxs)(n.p,{children:["First create partitions that should be used for Ceph. In this example we use a block device ",(0,d.jsx)(n.code,{children:"/dev/sdb"}),"\nwith four partitions that will be used for Ceph OSDs."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-console",children:"$ sudo fdisk -l /dev/sdb\nDisk /dev/sdb: 20 GiB, 21474836480 bytes, 41943040 sectors\nDisk model: QEMU HARDDISK\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: gpt\nDisk identifier: 709B8C6C-51E1-4644-9ED4-0604607FCCEE\n\nDevice        Start      End  Sectors Size Type\n/dev/sdb1      2048 10487807 10485760   5G Linux filesystem\n/dev/sdb2  10487808 20973567 10485760   5G Linux filesystem\n/dev/sdb3  20973568 31459327 10485760   5G Linux filesystem\n/dev/sdb4  31459328 41943006 10483679   5G Linux filesystem\n"})}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"ceph_osd_devices"})," parameter with the following content is initially added in the host vars of the node.\nThe partitions ",(0,d.jsx)(n.code,{children:"/dev/sda1"}),", ",(0,d.jsx)(n.code,{children:"/dev/sdb1"}),", ",(0,d.jsx)(n.code,{children:"/dev/sdc1"})," and ",(0,d.jsx)(n.code,{children:"/dev/sdd1"}),", are to be used as OSD."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_osd_devices:\n  sdb1:\n  sdb2:\n  sdb3:\n  sdb4:\n"})}),"\n",(0,d.jsxs)(n.p,{children:["Then generate the required LVM2 device configuration with the ",(0,d.jsx)(n.code,{children:"ceph-configure-lvm-volumes"})," play."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"osism apply facts\nosism reconciler sync\nosism apply ceph-configure-lvm-volumes\n"})}),"\n",(0,d.jsxs)(n.p,{children:["Check the ",(0,d.jsx)(n.code,{children:"/tmp"})," directory on the manager node for files like ",(0,d.jsx)(n.code,{children:"testbed-node-0.testbed.osism.xyz-ceph-lvm-configuration.yml"}),".\nAdd this content to the host vars of the corresponding node. The existing ",(0,d.jsx)(n.code,{children:"ceph_osd_devices"})," parameter is replaced."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"---\n#\n# This is Ceph LVM configuration for testbed-node-0.testbed.osism.xyz\n# generated by ceph-configure-lvm-volumes playbook.\n#\nceph_osd_devices:\n  sdb1:\n    osd_lvm_uuid: 9e8799ae-c716-5212-8833-49f153ffbcef\n  sdb2:\n    osd_lvm_uuid: 8518d3a2-3194-5764-b55a-c51222b9b576\n  sdb3:\n    osd_lvm_uuid: a0da232a-e5b8-5823-8c42-8fb231442edc\n  sdb4:\n    osd_lvm_uuid: 56f7b5bc-82b0-5626-90a5-adf6078ceba6\nlvm_volumes:\n- data: osd-block-9e8799ae-c716-5212-8833-49f153ffbcef\n  data_vg: ceph-9e8799ae-c716-5212-8833-49f153ffbcef\n- data: osd-block-8518d3a2-3194-5764-b55a-c51222b9b576\n  data_vg: ceph-8518d3a2-3194-5764-b55a-c51222b9b576\n- data: osd-block-a0da232a-e5b8-5823-8c42-8fb231442edc\n  data_vg: ceph-a0da232a-e5b8-5823-8c42-8fb231442edc\n- data: osd-block-56f7b5bc-82b0-5626-90a5-adf6078ceba6\n  data_vg: ceph-56f7b5bc-82b0-5626-90a5-adf6078ceba6\n"})}),"\n",(0,d.jsx)(n.p,{children:"Finally, create the necessary PVs, VGs and LVs."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"osism reconciler sync\nosism apply ceph-create-lvm-devices\n"})}),"\n",(0,d.jsx)(n.p,{children:"You can check the PVs, VGs, and LVs on the node."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-console",children:"$ sudo pvs\nPV         VG                                        Fmt  Attr PSize  PFree\n/dev/sdb1  ceph-9e8799ae-c716-5212-8833-49f153ffbcef lvm2 a--  <5.00g    0\n/dev/sdb2  ceph-8518d3a2-3194-5764-b55a-c51222b9b576 lvm2 a--  <5.00g    0\n/dev/sdb3  ceph-a0da232a-e5b8-5823-8c42-8fb231442edc lvm2 a--  <5.00g    0\n/dev/sdb4  ceph-56f7b5bc-82b0-5626-90a5-adf6078ceba6 lvm2 a--  <5.00g    0\n\n$ sudo vgs\nVG                                        #PV #LV #SN Attr   VSize  VFree\nceph-56f7b5bc-82b0-5626-90a5-adf6078ceba6   1   1   0 wz--n- <5.00g    0\nceph-8518d3a2-3194-5764-b55a-c51222b9b576   1   1   0 wz--n- <5.00g    0\nceph-9e8799ae-c716-5212-8833-49f153ffbcef   1   1   0 wz--n- <5.00g    0\nceph-a0da232a-e5b8-5823-8c42-8fb231442edc   1   1   0 wz--n- <5.00g    0\n\n$ sudo lvs\nLV                                             VG                                        Attr       LSize  [...]\nosd-block-56f7b5bc-82b0-5626-90a5-adf6078ceba6 ceph-56f7b5bc-82b0-5626-90a5-adf6078ceba6 -wi-a----- <5.00g\nosd-block-8518d3a2-3194-5764-b55a-c51222b9b576 ceph-8518d3a2-3194-5764-b55a-c51222b9b576 -wi-a----- <5.00g\nosd-block-9e8799ae-c716-5212-8833-49f153ffbcef ceph-9e8799ae-c716-5212-8833-49f153ffbcef -wi-a----- <5.00g\nosd-block-a0da232a-e5b8-5823-8c42-8fb231442edc ceph-a0da232a-e5b8-5823-8c42-8fb231442edc -wi-a----- <5.00g\n"})}),"\n",(0,d.jsx)(n.h3,{id:"add-a-new-osd",children:"Add a new osd"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["There is the following existing configuration in ",(0,d.jsx)(n.code,{children:"inventory/host_vars/<nodename>.yml"}),"."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_osd_devices:\n  sda:\n    osd_lvm_uuid: 71e54cfb-65e5-5109-8f09-2be6b661f39c\n  sdb:\n    osd_lvm_uuid: acb56e1f-0700-587f-95d4-fbe905491fea\nlvm_volumes:\n- data: osd-block-71e54cfb-65e5-5109-8f09-2be6b661f39c\n  data_vg: ceph-71e54cfb-65e5-5109-8f09-2be6b661f39c\n- data: osd-block-acb56e1f-0700-587f-95d4-fbe905491fea\n  data_vg: ceph-acb56e1f-0700-587f-95d4-fbe905491fea\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["The block device ",(0,d.jsx)(n.code,{children:"sdc"})," should be added as new OSD on ",(0,d.jsx)(n.code,{children:"nodename"}),". Edit the existing\nconfiguration in ",(0,d.jsx)(n.code,{children:"inventory/host_vars/<nodename>.yml"})," and add ",(0,d.jsx)(n.code,{children:"sdc"})," to the list\n",(0,d.jsx)(n.code,{children:"ceph_osd_devices"}),"."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_osd_devices:\n  sda:\n    osd_lvm_uuid: 71e54cfb-65e5-5109-8f09-2be6b661f39c\n  sdb:\n    osd_lvm_uuid: acb56e1f-0700-587f-95d4-fbe905491fea\n  sdc:\nlvm_volumes:\n- data: osd-block-71e54cfb-65e5-5109-8f09-2be6b661f39c\n  data_vg: ceph-71e54cfb-65e5-5109-8f09-2be6b661f39c\n- data: osd-block-acb56e1f-0700-587f-95d4-fbe905491fea\n  data_vg: ceph-acb56e1f-0700-587f-95d4-fbe905491fea\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Commit changes in the configuration repository, sync the configuration repository on\nthe manager and reconcile the inventory with ",(0,d.jsx)(n.code,{children:"osism reconciler sync"}),"."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Regenerate the configuration with ",(0,d.jsx)(n.code,{children:"osism apply ceph-configure-lvm-volumes -l <nodename>"}),".\nSynchronize the contents of ",(0,d.jsx)(n.code,{children:"/tmp/<nodename>-ceph-lvm-configuration.yml"})," with those in\n",(0,d.jsx)(n.code,{children:"inventory/host_vars/<nodename>.yml"}),"."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_osd_devices:\n  sda:\n    osd_lvm_uuid: 71e54cfb-65e5-5109-8f09-2be6b661f39c\n  sdb:\n    osd_lvm_uuid: acb56e1f-0700-587f-95d4-fbe905491fea\n  sdc:\n    osd_lvm_uuid: ad1a16cd-b35e-58d1-8e40-80a14597f583\nlvm_volumes:\n- data: osd-block-71e54cfb-65e5-5109-8f09-2be6b661f39c\n  data_vg: ceph-71e54cfb-65e5-5109-8f09-2be6b661f39c\n- data: osd-block-acb56e1f-0700-587f-95d4-fbe905491fea\n  data_vg: ceph-acb56e1f-0700-587f-95d4-fbe905491fea\n- data: osd-block-ad1a16cd-b35e-58d1-8e40-80a14597f583\n  data_vg: ceph-ad1a16cd-b35e-58d1-8e40-80a14597f583\n"})}),"\n",(0,d.jsx)(n.p,{children:"Added in this case:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"[...]\n  sdc:\n    osd_lvm_uuid: ad1a16cd-b35e-58d1-8e40-80a14597f583\n[...]\n- data: osd-block-ad1a16cd-b35e-58d1-8e40-80a14597f583\n  data_vg: ceph-ad1a16cd-b35e-58d1-8e40-80a14597f583\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Commit changes in the configuration repository, sync the configuration repository on\nthe manager and reconcile the inventory with ",(0,d.jsx)(n.code,{children:"osism reconciler sync"}),"."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Create new LVM devices."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"osism apply ceph-create-lvm-devices -l <nodename>\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Everything is now ready for the deployment of the new OSD.\nDetails on deploying the OSD service in the ",(0,d.jsx)(n.a,{href:"../../operations-guide/ceph#add-a-new-osd",children:"Ceph operations guide"}),"."]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"dashboard",children:"Dashboard"}),"\n",(0,d.jsxs)(n.p,{children:["Password for the admin user of the Ceph dashboard is set via ",(0,d.jsx)(n.code,{children:"ceph_dashboard_password"}),"."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",metastring:'title="environments/ceph/secrets.yml"',children:"ceph_dashboard_password: password\n"})}),"\n",(0,d.jsx)(n.p,{children:"User name of the admin user, port and listen IP address can be set via additional parameters."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",metastring:'title="environments/ceph/configuration.yml"',children:"ceph_dashboard_addr: 0.0.0.0\nceph_dashboard_port: 7000\nceph_dashboard_username: admin\n"})}),"\n",(0,d.jsxs)(n.p,{children:["The Ceph dashboard is bootstrapped with the ",(0,d.jsx)(n.code,{children:"ceph-bootstrap-dashboard"})," play."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"osism apply ceph-bootstrap-dashboard\n"})}),"\n",(0,d.jsx)(n.h3,{id:"configuring-the-openstack-loadbalancer-to-expose-the-ceph-dashboard",children:"Configuring the openstack loadbalancer to expose the ceph dashboard"}),"\n",(0,d.jsx)(n.p,{children:"The ceph dashboard runs in an active/standby configuration. In its default standby instances will\nredirect to the active instance. Most deployments will want to use the openstack loadbalancer to\nexpose the ceph dashboard on the internal network and direct traffic directly to the active\ninstance."}),"\n",(0,d.jsxs)(n.p,{children:["In this scenario the dashboard should be configured to return an http error with status ",(0,d.jsx)(n.code,{children:"404"})," on\nstandby instances."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",metastring:'title="environments/ceph/configuration.yml"',children:"ceph_dashboard_standby_behaviour: error\nceph_dashboard_standby_error_status_code: 404\n"})}),"\n",(0,d.jsx)(n.p,{children:"Create a loadbalancer configuration"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-jinja2",metastring:'title="environments/kolla/files/overlays/haproxy/services.d/ceph_dashboard.cfg"',children:"\n{%- set internal_tls_bind_info = 'ssl crt /etc/haproxy/certificates/haproxy-internal.pem' if kolla_enable_tls_internal|bool else '' %}\n\nlisten ceph_dashboard\n  option httpchk\n  http-check expect status 200,404\n  http-check disable-on-404\n  {{ \"bind %s:%s %s\"|e|format(kolla_internal_vip_address, 8140, internal_tls_bind_info)|trim() }}\n{% for host in groups['ceph-mgr'] %}\n  server {{ hostvars[host]['ansible_facts']['hostname'] }} {{ hostvars[host]['monitor_address'] }}:7000 check inter 2000 rise 2 fall 5\n{% endfor %}\n"})}),"\n",(0,d.jsx)(n.p,{children:"and apply it."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"osism apply -a reconfigure loadbalancer\n"})}),"\n",(0,d.jsx)(n.h2,{id:"second-ceph-cluster",children:"Second Ceph cluster"}),"\n",(0,d.jsxs)(n.p,{children:["With OSISM, it is possible to manage any number of independent Ceph clusters via a single OSISM\nmanager service using sub-environments. A sub environment is basically nothing more than another directory\nbelow the ",(0,d.jsx)(n.code,{children:"environments"})," directory of the configuration repository with a special name."]}),"\n",(0,d.jsxs)(n.p,{children:["A sub-environment for Ceph always has the name ",(0,d.jsx)(n.code,{children:"ceph.NAME"}),". The ",(0,d.jsx)(n.code,{children:"ceph.NAME"})," directory in the\nconfiguration repository then contains the ",(0,d.jsx)(n.code,{children:"configuration.yml"}),", ",(0,d.jsx)(n.code,{children:"images.yml"})," and ",(0,d.jsx)(n.code,{children:"secrets.yml"}),"\nfiles as usual."]}),"\n",(0,d.jsxs)(n.p,{children:["In this example, a sub-environment ",(0,d.jsx)(n.code,{children:"ceph.rgw"})," is created which is used for a Ceph cluster that\nwill only be used as an RGW cluster."]}),"\n",(0,d.jsxs)(n.p,{children:["In comparison to the normal ",(0,d.jsx)(n.code,{children:"ceph"})," environment, the groups to be used must be overwritten for a\nCeph sub-environment. In this case, two groups are defined: ",(0,d.jsx)(n.code,{children:"ceph.rgw"})," and ",(0,d.jsx)(n.code,{children:"ceph.rgw.empty"}),".\nAny other groups can be used, e.g. ",(0,d.jsx)(n.code,{children:"ceph.rgw.osd"}),". It is recommended to base the name of the\ngroups on the name of the sub-environments."]}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.code,{children:"ceph.rgw.empty"})," group is important because there are plays in ceph-ansible that are executed\nwhen nodes are in a specific group. To explicitly avoid this, certain groups are set to the empty\ngroup."]}),"\n",(0,d.jsxs)(n.p,{children:["All available group name parameters are listed in the ",(0,d.jsx)(n.a,{href:"https://github.com/osism/defaults/blob/main/all/099-ceph.yml",children:"[099-ceph.yml]"}),"\nfile of the ",(0,d.jsx)(n.a,{href:"https://github.com/osism/defaults",children:"osism/defaults"})," repository."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",metastring:'title="environments/ceph.rgw/configuration.yml"',children:"##########################\n# groups\n\nceph_group_name: ceph.rgw\n\nclient_group_name: ceph.rgw\ngrafana_server_group_name: ceph.rgw\niscsi_gw_group_name: ceph.rgw.empty\nmds_group_name: ceph.rgw.empty\nmgr_group_name: ceph.rgw\nmon_group_name: ceph.rgw\nnfs_group_name: ceph.rgw.empty\nosd_group_name: ceph.rgw\nrbdmirror_group_name: ceph.rgw.empty\nrestapi_group_name: ceph.rgw.empty\nrgw_group_name: ceph.rgw\nrgwloadbalancer_group_name: ceph.rgw.empty\n"})}),"\n",(0,d.jsxs)(n.p,{children:["The groups used are then added in the inventory in the ",(0,d.jsx)(n.code,{children:"10-custom"})," file."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ini",metastring:'title="inventory/10-custom"',children:"[ceph.rgw]\ntestbed-node-3.testbed.osism.xyz\ntestbed-node-4.testbed.osism.xyz\ntestbed-node-5.testbed.osism.xyz\n\n[ceph.rgw.empty]\n"})}),"\n",(0,d.jsxs)(n.p,{children:["The sub environment can then be specified with all ",(0,d.jsx)(n.code,{children:"apply"})," commands of the OSISM CLI. For example,\nto deploy the Ceph mon services of the ",(0,d.jsx)(n.code,{children:"ceph.rgw"})," sub environment:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"osism apply --sub rgw ceph-osds\n"})}),"\n",(0,d.jsx)(n.h2,{id:"resource-limits",children:"Resource limits"}),"\n",(0,d.jsxs)(n.p,{children:["Resource limits for the individual Ceph services can be set via ",(0,d.jsx)(n.code,{children:"environments/ceph/configuration.yml"}),".\nThe possible parameters and their defaults for memory limits and CPU limits are listed below."]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Memory limits"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:'ceph_mds_docker_memory_limit: "{{ ansible_facts[\'memtotal_mb\'] }}m"\nceph_mgr_docker_memory_limit: "{{ ansible_facts[\'memtotal_mb\'] }}m"\nceph_mon_docker_memory_limit: "{{ ansible_facts[\'memtotal_mb\'] }}m"\nceph_osd_docker_memory_limit: "{{ ansible_facts[\'memtotal_mb\'] }}m"\nceph_rbd_mirror_docker_memory_limit: "{{ ansible_facts[\'memtotal_mb\'] }}m"\nceph_rgw_docker_memory_limit: "4096m"\n'})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"CPU limits"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"ceph_mds_docker_cpu_limit: 4\nceph_mgr_docker_cpu_limit: 1\nceph_mon_docker_cpu_limit: 1\nceph_osd_docker_cpu_limit: 4\nceph_rbd_mirror_docker_cpu_limit: 1\nceph_rgw_docker_cpu_limit: 8\n"})}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"cpu-pinning",children:"CPU Pinning"}),"\n",(0,d.jsxs)(n.p,{children:["CPU pinning and specifying the NUMA nodes to be used for the Ceph OSD and RGW services can be\nset via ",(0,d.jsx)(n.code,{children:"environments/ceph/configuration.yml"}),".\nThe possible parameters and possible values are listed below. The parameters are not enabled\nby default."]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Limit the specific CPUs or cores a container can use. A comma-separated list or\nhyphen-separated range of CPUs a container can use, if you have more than one CPU.\nThe first CPU is numbered 0. A valid value might be 0-3 (to use the first, second,\nthird, and fourth CPU) or 1,3 (to use the second and fourth CPU)."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:'# ceph_osd_docker_cpuset_cpus: "0,2,4,6,8,10,12,14,16"\n# ceph_rgw_docker_cpuset_cpus: "0,2,4,6,8,10,12,14,16"\n'})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Memory nodes in which to allow execution (e.g. 0-3, 0,1). Only effective on NUMA systems."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:'# ceph_osd_docker_cpuset_mems: "0"\n# ceph_rgw_docker_cpuset_mems: "0"\n'})}),"\n",(0,d.jsxs)(n.p,{children:["Available NUMA nodes on a node can be displayed with ",(0,d.jsx)(n.a,{href:"https://github.com/numactl/numactl",children:"numactl"}),".\nIn this example, there are 2 NUMA nodes. The pinned CPUs should all be assigned to the\nspecified NUMA node."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-console",children:"# numactl --hardware\navailable: 2 nodes (0-1)\nnode 0 cpus: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59\nnode 0 size: 515581 MB\nnode 0 free: 511680 MB\nnode 1 cpus: 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79\nnode 1 size: 516078 MB\nnode 1 free: 511865 MB\nnode distances:\nnode   0   1\n  0:  10  20\n  1:  20  10\n"})}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"use-of-rbds-for-nodes",children:"Use of RBDs for nodes"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Add an extra pool (see ",(0,d.jsx)(n.a,{href:"#extra-pools",children:"Extra pools"}),")."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Add a key for the new pool (see ",(0,d.jsx)(n.a,{href:"#extra-keys",children:"Extra keys"}),")."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Add nodes on which RBDs are to be used to the inventory group ",(0,d.jsx)(n.code,{children:"cephclient"}),". The file\n",(0,d.jsx)(n.code,{children:"99-overwrite"})," must be used for this. By default, the inventory group looks like this:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ini",metastring:'file="inventory/99-overwrite"',children:"[cephclient:children]\nmanager\n"})}),"\n",(0,d.jsx)(n.p,{children:"It could look like this with the additional inventory group:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ini",metastring:'file="inventory/99-overwrite"',children:"[cephclient:children]\nmanager\ntestbed-resource-nodes\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Prepare the configuration of the Ceph client. Get the keyring with\n",(0,d.jsx)(n.code,{children:"ceph auth get client.extra001"}),"."]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",metastring:'file="inventory/group_vars/testbed-resource-nodes.yml"',children:'---\ncephclient_install_type: package\ncephclient_keyring_name: client.extra001\ncephclient_keyring: |\n  [client.extra001]\n      key = AQBiHV9nAAAAABAAhtxl8rdW/EBvxiOGw4iMJw==\n      caps mon = "profile rbd"\n      caps osd = "profile rbd pool=extra001"\n'})}),"\n",(0,d.jsx)(n.p,{children:"For Ubuntu 24.04 nodes also add the following parameter. At the moment no Ceph packages\nare available for Ubuntu 24.04."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:'cephclient_debian_repository: "deb https://download.ceph.com/debian-{{ cephclient_version }} jammy main"\n'})}),"\n",(0,d.jsxs)(n.ol,{start:"5",children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Create new RBD in the new pool (run this command on the manager node).\nIn this example, the name of the node on which the RBD is to be used is\nused as the name for the RBD."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"rbd create testbed-node-5 --size 64 --pool extra001\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"On the node map the RBD as block device."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"sudo rbd map testbed-node-5 --pool extra001 --id extra001\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"On the node check the mapped block device."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-console",children:"sudo rbd showmapped --id extra001\nid  pool      namespace  image           snap  device\n0   extra001             testbed-node-5  -     /dev/rbd0\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Done. ",(0,d.jsx)(n.code,{children:"/dev/rbd0"})," can now be used like a normal block device."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["The file ",(0,d.jsx)(n.code,{children:"/etc/ceph/rbdmap"})," is used to persist the mapping. The service ",(0,d.jsx)(n.code,{children:"rbdmap.service"}),"\nmust be activated and started for this."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-text",children:"extra001/testbed-node-5 id=extra001,keyring=/etc/ceph/ceph.client.extra001.keyring\n"})}),"\n"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(p,{...e})}):p(e)}},19365:(e,n,s)=>{s.d(n,{A:()=>a});s(96540);var i=s(18215);const d={tabItem:"tabItem_Ymn6"};var c=s(74848);function a({children:e,hidden:n,className:s}){return(0,c.jsx)("div",{role:"tabpanel",className:(0,i.A)(d.tabItem,s),hidden:n,children:e})}},11470:(e,n,s)=>{s.d(n,{A:()=>w});var i=s(96540),d=s(18215),c=s(17559),a=s(23104),r=s(56347),o=s(205),t=s(57485),l=s(31682),h=s(70679);function p(e){return i.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:n,children:s}=e;return(0,i.useMemo)((()=>{const e=n??function(e){return p(e).map((({props:{value:e,label:n,attributes:s,default:i}})=>({value:e,label:n,attributes:s,default:i})))}(s);return function(e){const n=(0,l.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,s])}function m({value:e,tabValues:n}){return n.some((n=>n.value===e))}function f({queryString:e=!1,groupId:n}){const s=(0,r.W6)(),d=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,t.aZ)(d),(0,i.useCallback)((e=>{if(!d)return;const n=new URLSearchParams(s.location.search);n.set(d,e),s.replace({...s.location,search:n.toString()})}),[d,s])]}function b(e){const{defaultValue:n,queryString:s=!1,groupId:d}=e,c=u(e),[a,r]=(0,i.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const s=n.find((e=>e.default))??n[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:c}))),[t,l]=f({queryString:s,groupId:d}),[p,b]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[s,d]=(0,h.Dv)(n);return[s,(0,i.useCallback)((e=>{n&&d.set(e)}),[n,d])]}({groupId:d}),x=(()=>{const e=t??p;return m({value:e,tabValues:c})?e:null})();(0,o.A)((()=>{x&&r(x)}),[x]);return{selectedValue:a,selectValue:(0,i.useCallback)((e=>{if(!m({value:e,tabValues:c}))throw new Error(`Can't select invalid tab value=${e}`);r(e),l(e),b(e)}),[l,b,c]),tabValues:c}}var x=s(92303);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var v=s(74848);function j({className:e,block:n,selectedValue:s,selectValue:i,tabValues:c}){const r=[],{blockElementScrollPositionUntilNextRender:o}=(0,a.a_)(),t=e=>{const n=e.currentTarget,d=r.indexOf(n),a=c[d].value;a!==s&&(o(n),i(a))},l=e=>{let n=null;switch(e.key){case"Enter":t(e);break;case"ArrowRight":{const s=r.indexOf(e.currentTarget)+1;n=r[s]??r[0];break}case"ArrowLeft":{const s=r.indexOf(e.currentTarget)-1;n=r[s]??r[r.length-1];break}}n?.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,d.A)("tabs",{"tabs--block":n},e),children:c.map((({value:e,label:n,attributes:i})=>(0,v.jsx)("li",{role:"tab",tabIndex:s===e?0:-1,"aria-selected":s===e,ref:e=>{r.push(e)},onKeyDown:l,onClick:t,...i,className:(0,d.A)("tabs__item",g.tabItem,i?.className,{"tabs__item--active":s===e}),children:n??e},e)))})}function _({lazy:e,children:n,selectedValue:s}){const c=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=c.find((e=>e.props.value===s));return e?(0,i.cloneElement)(e,{className:(0,d.A)("margin-top--md",e.props.className)}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:c.map(((e,n)=>(0,i.cloneElement)(e,{key:n,hidden:e.props.value!==s})))})}function y(e){const n=b(e);return(0,v.jsxs)("div",{className:(0,d.A)(c.G.tabs.container,"tabs-container",g.tabList),children:[(0,v.jsx)(j,{...n,...e}),(0,v.jsx)(_,{...n,...e})]})}function w(e){const n=(0,x.A)();return(0,v.jsx)(y,{...e,children:p(e.children)},String(n))}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>r});var i=s(96540);const d={},c=i.createContext(d);function a(e){const n=i.useContext(c);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:a(e.components),i.createElement(c.Provider,{value:n},e.children)}}}]);