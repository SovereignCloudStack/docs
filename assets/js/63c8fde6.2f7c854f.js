"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4168],{83139:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"scs-0101-v1-entropy","title":"SCS Entropy","description":"The SCS-0101 Entropy Standard ensures adequate entropy is available in virtual instances, crucial for operations\\nsuch as secure key creation in cryptography. The standard recommends using kernel version 5.18 or higher and\\nactivating the hw_rng_model: virtio attribute for images, while compute nodes should employ CPUs with entropy\\naccessing instructions unfiltered by the hypervisor. It allows the infusion of the hosts entropy sources into\\nvirtual instances and ensures the availability and quality of entropy in virtual environments, promoting system\\nsecurity and efficiency.\\n","source":"@site/standards/scs-0101-v1-entropy.md","sourceDirName":".","slug":"/scs-0101-v1-entropy","permalink":"/standards/scs-0101-v1-entropy","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"SCS Entropy","type":"Standard","status":"Stable","stabilized_at":"2024-02-08T00:00:00.000Z","track":"IaaS","description":"The SCS-0101 Entropy Standard ensures adequate entropy is available in virtual instances, crucial for operations\\nsuch as secure key creation in cryptography. The standard recommends using kernel version 5.18 or higher and\\nactivating the hw_rng_model: virtio attribute for images, while compute nodes should employ CPUs with entropy\\naccessing instructions unfiltered by the hypervisor. It allows the infusion of the hosts entropy sources into\\nvirtual instances and ensures the availability and quality of entropy in virtual environments, promoting system\\nsecurity and efficiency.\\n"},"sidebar":"standards","previous":{"title":"scs-0101: SCS Entropy","permalink":"/standards/iaas/scs-0101"},"next":{"title":"W1","permalink":"/standards/scs-0101-w1-entropy-implementation-testing"}}');var i=t(74848),r=t(28453);const o={title:"SCS Entropy",type:"Standard",status:"Stable",stabilized_at:new Date("2024-02-08T00:00:00.000Z"),track:"IaaS",description:"The SCS-0101 Entropy Standard ensures adequate entropy is available in virtual instances, crucial for operations\nsuch as secure key creation in cryptography. The standard recommends using kernel version 5.18 or higher and\nactivating the hw_rng_model: virtio attribute for images, while compute nodes should employ CPUs with entropy\naccessing instructions unfiltered by the hypervisor. It allows the infusion of the hosts entropy sources into\nvirtual instances and ensures the availability and quality of entropy in virtual environments, promoting system\nsecurity and efficiency.\n"},a=void 0,d={},l=[{value:"Introduction",id:"introduction",level:2},{value:"Entropy in information technology",id:"entropy-in-information-technology",level:3},{value:"Real-world uses of entropy",id:"real-world-uses-of-entropy",level:3},{value:"Sources of entropy",id:"sources-of-entropy",level:3},{value:"Entropy in virtual instances",id:"entropy-in-virtual-instances",level:3},{value:"Motivation",id:"motivation",level:2},{value:"Entropy in SCS clouds",id:"entropy-in-scs-clouds",level:2},{value:"Flavors",id:"flavors",level:3},{value:"Images",id:"images",level:3},{value:"Compute nodes",id:"compute-nodes",level:3}];function c(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(n.h3,{id:"entropy-in-information-technology",children:"Entropy in information technology"}),"\n",(0,i.jsx)(n.p,{children:"Entropy is a concept that is widely used in the scope of information\ntechnology. It is a measurement of the amount of disorder or randomness in\na system. Entropy is used to measure the amount of information in a\nself-contained system, as well as the amount of incertitude that exists in this\nsystem."}),"\n",(0,i.jsx)(n.h3,{id:"real-world-uses-of-entropy",children:"Real-world uses of entropy"}),"\n",(0,i.jsxs)(n.p,{children:["Cryptography is a very prominent, albeit not the only application that\nheavily relies on entropy for operations such as creating secure keys.\nWhen the available ",(0,i.jsx)(n.em,{children:"entropy runs out"}),", said operations can stall and\ntake an abnormally long amount of time, which in turn can lead to\nmalfunctions, e.g., with OpenSSL or load balancers."]}),"\n",(0,i.jsx)(n.h3,{id:"sources-of-entropy",children:"Sources of entropy"}),"\n",(0,i.jsxs)(n.p,{children:["In ",(0,i.jsx)(n.em,{children:"traditional baremetal systems"})," the amount of incertitude is sourced\nfrom the randomness of the read/write cycles of the disk heads of a disk drive,\nbus timings, or keyboard timings, to name a few."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:"More recent methods"})," of generating entropy include measuring IRQ jitter\n(available in Linux since kernel 5.4 or, before that, via a daemon such as\n",(0,i.jsx)(n.a,{href:"http://www.issihosts.com/haveged/",children:"HavegeD"}),") as well as dedicated CPU\ninstructions (available in virtually all major CPUs: RDSEED or RDRAND\non x86_64 and RNDR on arm64)."]}),"\n",(0,i.jsxs)(n.p,{children:["Finally, a dedicated device can be utilized \u2014 if present \u2014 that is\ncalled ",(0,i.jsx)(n.em,{children:"hardware random number generator"})," or HRNG for short. For instance,\nthe ",(0,i.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Trusted_Platform_Module",children:"Trusted Platform Module"}),"\nincludes a HRNG. On Linux systems, the HRNG appears as ",(0,i.jsx)(n.code,{children:"/dev/hwrng"}),".\nNote that, while the dedicated CPU instructions can be construed as\na HRNG, they are not treated as such by the kernel, i.e., they ",(0,i.jsx)(n.em,{children:"do not"}),"\nappear as ",(0,i.jsx)(n.code,{children:"/dev/hwrng"}),"!"]}),"\n",(0,i.jsxs)(n.p,{children:["The Linux kernel combines multiple sources of entropy into a pool. To this\nend, it will use all the sources discussed so far with one exception:\nthe HRNG must be fed into the pool (if so desired) via the daemon ",(0,i.jsx)(n.code,{children:"rngd"}),".\nThe kernel converts the entropy from the pool into cryptographically\nsecure random numbers that appear under ",(0,i.jsx)(n.code,{children:"/dev/random"})," and ",(0,i.jsx)(n.code,{children:"/dev/urandom"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["With kernel 5.18, the algorithm that accomplishes\nsaid conversion has been drastically improved (see\n",(0,i.jsx)(n.a,{href:"https://web.archive.org/web/20230321040526/https://www.zx2c4.com/projects/linux-rng-5.17-5.18/",children:"linux-rng-5.17-18"}),"),\nso much so that running out of entropy is virtually ruled out.\nThese patches have now also arrived in the upstream LTS images."]}),"\n",(0,i.jsx)(n.h3,{id:"entropy-in-virtual-instances",children:"Entropy in virtual instances"}),"\n",(0,i.jsx)(n.p,{children:"Virtual instances or virtual machines do not have the traditional sources\nof entropy mentioned above. However, the more recent methods mentioned\nabove do work just fine (the CPU instructions are not privileged)."}),"\n",(0,i.jsxs)(n.p,{children:["Alternatively, a virtualized HRNG called ",(0,i.jsx)(n.code,{children:"virtio-rng"})," can be established\nthat injects entropy from the host into the instance, where this\nentropy can be sourced optionally from either the host's ",(0,i.jsx)(n.code,{children:"/dev/random"})," or\nsome HRNG in the host. This virtualized HRNG behaves just like a real\none, that is, it appears as ",(0,i.jsx)(n.code,{children:"/dev/hwrng"}),", and the daemon ",(0,i.jsx)(n.code,{children:"rngd"})," must\nbe used to feed it into the kernel's entropy pool."]}),"\n",(0,i.jsxs)(n.p,{children:["On a side note, the kernel exposes available HRNGs via the special\ndirectory ",(0,i.jsx)(n.code,{children:"/sys/devices/virtual/misc/hw_random"}),". In particular, the\nfile ",(0,i.jsx)(n.code,{children:"rng_available"})," lists available HRNGs while the file ",(0,i.jsx)(n.code,{children:"rng_current"}),"\ncontains the HRNG currently used."]}),"\n",(0,i.jsxs)(n.p,{children:["In summary, with current kernels and CPUs entropy in virtual instances\nis readily available to a sufficient degree. In addition, the host's\nentropy sources can be injected using ",(0,i.jsx)(n.code,{children:"virtio-rng"})," if so desired, e.g.,\nto enable access to a HRNG."]}),"\n",(0,i.jsx)(n.h2,{id:"motivation",children:"Motivation"}),"\n",(0,i.jsx)(n.p,{children:"As stated above, good sources of entropy are paramount for many\nimportant applications. This standard ensures that sufficient entropy\nwill be available in virtual instances."}),"\n",(0,i.jsx)(n.h2,{id:"entropy-in-scs-clouds",children:"Entropy in SCS clouds"}),"\n",(0,i.jsx)(n.h3,{id:"flavors",children:"Flavors"}),"\n",(0,i.jsx)(n.p,{children:"It is recommended that all flavors have the following attribute:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-console",children:"hw_rng:allowed=True\n"})}),"\n",(0,i.jsx)(n.p,{children:"The following attributes are optional:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-console",children:"hw_rng:rate_bytes - The allowed amount of bytes for the the guest\n    to read from the host's entropy per period.\nhw_rng:rate_period - Sets the duration of a read period in seconds.\n"})}),"\n",(0,i.jsx)(n.h3,{id:"images",children:"Images"}),"\n",(0,i.jsxs)(n.p,{children:["It is recommended to use images having a kernel (patch level) version 5.18\nor up. This condition is already satisfied by every mandatory image defined\nin the ",(0,i.jsx)(n.a,{href:"https://github.com/SovereignCloudStack/standards/blob/main/Standards/scs-0102-v1-image-metadata.md",children:"Image Metadata Standard"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["It is recommended that images activate the attribute ",(0,i.jsx)(n.code,{children:"hw_rng_model: virtio"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["The daemon ",(0,i.jsx)(n.code,{children:"rngd"})," must be installed (usually from ",(0,i.jsx)(n.code,{children:"rng-tools"}),"\nor ",(0,i.jsx)(n.code,{children:"rng-utils"}),")."]}),"\n",(0,i.jsxs)(n.p,{children:["The user may choose to use the ",(0,i.jsx)(n.code,{children:"virtio-rng"})," device via ",(0,i.jsx)(n.code,{children:"rngd"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"compute-nodes",children:"Compute nodes"}),"\n",(0,i.jsx)(n.p,{children:"Compute nodes must use CPUs that offer instructions for accessing\nentropy (such as RDSEED or RDRAND on x86_64 or RNDR on arm64), and\nthese instructions may not be filtered by the hypervisor."}),"\n",(0,i.jsxs)(n.p,{children:["Compute nodes may provide a HRNG via ",(0,i.jsx)(n.code,{children:"rngd"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var s=t(96540);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);