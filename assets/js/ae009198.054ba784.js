"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[50676],{39104:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>p,frontMatter:()=>l,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"operating-scs/components/status-page-deployment/docs/k3s","title":"k3s - A simple deployment on a single host","description":"From a new machine to a working status page in ~15 minutes.","source":"@site/docs/04-operating-scs/components/status-page-deployment/docs/k3s.md","sourceDirName":"04-operating-scs/components/status-page-deployment/docs","slug":"/operating-scs/components/status-page-deployment/docs/k3s","permalink":"/docs/operating-scs/components/status-page-deployment/docs/k3s","draft":false,"unlisted":false,"editUrl":"https://github.com/SovereignCloudStack/docs/tree/main/docs/04-operating-scs/components/status-page-deployment/docs/k3s.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"kind - Local development environment","permalink":"/docs/operating-scs/components/status-page-deployment/docs/kind"},"next":{"title":"SCS Public","permalink":"/docs/operating-scs/components/status-page-deployment/docs/scs-public"}}');var o=s(74848),i=s(28453);const l={},r="k3s - A simple deployment on a single host",a={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"k3s setup",id:"k3s-setup",level:2},{value:"Firewall settings",id:"firewall-settings",level:3},{value:"<code>ufw</code> example",id:"ufw-example",level:4},{value:"Install",id:"install",level:3},{value:"Deployment",id:"deployment",level:2},{value:"Kube config",id:"kube-config",level:3},{value:"Deploy cert manager",id:"deploy-cert-manager",level:3},{value:"Configure and deploy status page",id:"configure-and-deploy-status-page",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"k3s---a-simple-deployment-on-a-single-host",children:"k3s - A simple deployment on a single host"})}),"\n",(0,o.jsx)(n.p,{children:"From a new machine to a working status page in ~15 minutes."}),"\n",(0,o.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsx)(n.p,{children:"A VM or bare metal host with a public IP. Optional: A domain pointing to the public IP."}),"\n",(0,o.jsx)(n.h2,{id:"k3s-setup",children:"k3s setup"}),"\n",(0,o.jsx)(n.p,{children:"Setting up k3s to run k8s workloads on the machine."}),"\n",(0,o.jsx)(n.h3,{id:"firewall-settings",children:"Firewall settings"}),"\n",(0,o.jsx)(n.p,{children:"Allow communication to and from the cluster."}),"\n",(0,o.jsx)(n.p,{children:"Incoming:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"6443 Kubernetes API server"}),"\n",(0,o.jsx)(n.li,{children:"80 HTTP ingress"}),"\n",(0,o.jsx)(n.li,{children:"443 HTTPS ingress"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Internal:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"10.42.0.0/16 - Pod communication"}),"\n",(0,o.jsx)(n.li,{children:"10.43.0.0/16 - Service communication"}),"\n"]}),"\n",(0,o.jsxs)(n.h4,{id:"ufw-example",children:[(0,o.jsx)(n.code,{children:"ufw"})," example"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ufw allow 6443/tcp # api server\nufw allow from 10.42.0.0/16 to any # pods\nufw allow from 10.43.0.0/16 to any # services\n\nufw allow 80/tcp # http\nufw allow 443/tcp # https\n"})}),"\n",(0,o.jsx)(n.h3,{id:"install",children:"Install"}),"\n",(0,o.jsxs)(n.p,{children:["Configure and install k3s directly via install script. See the ",(0,o.jsx)(n.a,{href:"https://docs.k3s.io/cli/server",children:"k3s server config"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"curl -sfL https://get.k3s.io | sh -s - server \\\n--tls-san <your-ip> \\\n--tls-san <your-domain>\n"})}),"\n",(0,o.jsx)(n.p,{children:"Setting the SANs enables the k3s server to be available via your domain and server ip."}),"\n",(0,o.jsx)(n.h2,{id:"deployment",children:"Deployment"}),"\n",(0,o.jsx)(n.p,{children:"Deploy services to the cluster, to get the status page running."}),"\n",(0,o.jsxs)(n.p,{children:["If you don't have access to a domain name, consider using ",(0,o.jsx)(n.a,{href:"https://nip.io/",children:"nip.io"})," to use as (sub)domains for Dex, Oathkeeper (API server) and the web frontend."]}),"\n",(0,o.jsx)(n.h3,{id:"kube-config",children:"Kube config"}),"\n",(0,o.jsxs)(n.p,{children:["The newly generated kube config for the cluster is located at ",(0,o.jsx)(n.code,{children:"/etc/rancher/k3s/k3s.yaml"}),". Copy to your machine to configure access to the cluster."]}),"\n",(0,o.jsxs)(n.p,{children:["Change the URI at ",(0,o.jsx)(n.code,{children:".clusters[0].cluster.server"})," to the URI you added to the SAN config."]}),"\n",(0,o.jsx)(n.h3,{id:"deploy-cert-manager",children:"Deploy cert manager"}),"\n",(0,o.jsxs)(n.p,{children:["Deploy ",(0,o.jsx)(n.a,{href:"https://cert-manager.io/docs/installation/kubectl/",children:"cert-manager"})," on the cluster to automatically receive LetsEncrypt certificates."]}),"\n",(0,o.jsxs)(n.p,{children:["See ",(0,o.jsx)(n.code,{children:"issuer.yaml"})," for settings."]}),"\n",(0,o.jsx)(n.h3,{id:"configure-and-deploy-status-page",children:"Configure and deploy status page"}),"\n",(0,o.jsxs)(n.p,{children:["For in depth configuration see ",(0,o.jsx)(n.a,{href:"/docs/operating-scs/components/status-page-deployment/docs/configuration",children:(0,o.jsx)(n.code,{children:"configuration.md"})}),"."]}),"\n",(0,o.jsx)(n.p,{children:"Assemble and deploy the k3s deployment."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl kustomize kubernetes/environments/k3s/ > k3s_out.yaml\nkubectl apply -f k3s_out.yaml\n# or\nkubectl apply -k kubernetes/environments/k3s/\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The deployment creates a namespace called ",(0,o.jsx)(n.code,{children:"status-page"})," where all services, ingress, etc. gets deployed."]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>r});var t=s(96540);const o={},i=t.createContext(o);function l(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);