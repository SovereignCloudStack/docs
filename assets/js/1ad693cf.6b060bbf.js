"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[60540],{24844:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>t,toc:()=>u});const t=JSON.parse('{"id":"iaas/deployment-examples/testbed/deployment","title":"Deployment","description":"This section describes step by step how to deploy the OSISM Testbed.","source":"@site/docs/02-iaas/deployment-examples/testbed/deployment.mdx","sourceDirName":"02-iaas/deployment-examples/testbed","slug":"/iaas/deployment-examples/testbed/deployment","permalink":"/docs/iaas/deployment-examples/testbed/deployment","draft":false,"unlisted":false,"editUrl":"https://github.com/SovereignCloudStack/docs/tree/main/docs/02-iaas/deployment-examples/testbed/deployment.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_label":"Deployment","sidebar_position":2},"sidebar":"docs","previous":{"title":"Prerequisites","permalink":"/docs/iaas/deployment-examples/testbed/prerequisites"},"next":{"title":"Usage","permalink":"/docs/iaas/deployment-examples/testbed/usage"}}');var r=s(74848),a=s(28453),o=s(11470),i=s(19365);const l={sidebar_label:"Deployment",sidebar_position:2},c="Deployment",d={},u=[{value:"Initializing",id:"initializing",level:2},{value:"Start deployment",id:"start-deployment",level:2},{value:"Verify and adjust deployment",id:"verify-and-adjust-deployment",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"deployment",children:"Deployment"})}),"\n",(0,r.jsx)(n.p,{children:"This section describes step by step how to deploy the OSISM Testbed."}),"\n",(0,r.jsx)(n.h2,{id:"initializing",children:"Initializing"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Request access from the administrator of the respective cloud or get access to an OpenStack cloud."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Clone the ",(0,r.jsx)(n.a,{href:"https://github.com/osism/testbed",children:"osism/testbed"})," repository."]}),"\n",(0,r.jsx)(n.p,{children:"The repository can also be cloned to any other location."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/src/github.com/osism\ngit clone https://github.com/osism/testbed ~/src/github.com/osism/testbed\ncd ~/src/github.com/osism/testbed\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Configure your cloud access profile"}),"\n",(0,r.jsxs)(n.p,{children:["The access data for the cloud provider used is stored in ",(0,r.jsx)(n.code,{children:"terraform/clouds.yaml"})," and (optionally) in ",(0,r.jsx)(n.code,{children:"terraform/secure.yaml"})," (same structure, if you want to store credentials in a separate place)."]}),"\n",(0,r.jsxs)(n.p,{children:["In file ",(0,r.jsx)(n.a,{href:"https://github.com/osism/testbed/blob/main/terraform/clouds.yaml.sample",children:"terraform/clouds.yaml.sample"})," you will find examples of typical setups. Settings that are identical for all users of a cloud can be defined centrally via the profiles of the file ",(0,r.jsx)(n.a,{href:"https://github.com/osism/testbed/blob/main/terraform/clouds-public.yaml",children:"terraform/clouds-public.yaml"}),". You can reference these settings by using the ",(0,r.jsx)(n.code,{children:"profile"})," parameter in the cloud-specific definition in ",(0,r.jsx)(n.code,{children:"terraform/clouds.yaml"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The user-specific settings of the ",(0,r.jsx)(n.code,{children:"clouds.yaml"})," file are provided by the cloud provider. Please check the\ndocumentation of the cloud provider you are using or their support for details."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://regio.digital",children:"REGIO.cloud"})," is used as an example here. The cloud name in ",(0,r.jsx)(n.code,{children:"clouds.yaml"}),"\nand the environment name (value of ",(0,r.jsx)(n.code,{children:"ENVIRONMENT"}),") are ",(0,r.jsx)(n.code,{children:"regiocloud"})," in this case. It is important that\nthe name of the cloud in ",(0,r.jsx)(n.code,{children:"clouds.yaml"})," matches the name of the environment to be used. The names must\nbe identical. It is currently not possible to name the cloud ",(0,r.jsx)(n.code,{children:"regiocloud-123"})," in ",(0,r.jsx)(n.code,{children:"clouds.yaml"})," if the\nenvironment is ",(0,r.jsx)(n.code,{children:"regiocloud"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["If another cloud is used, replace ",(0,r.jsx)(n.code,{children:"regiocloud"})," with the respective profile\nname\n",(0,r.jsx)(n.a,{href:"/docs/iaas/deployment-examples/testbed/prerequisites#cloud-access",children:"from the table on the prerequisites page"}),"."]}),"\n",(0,r.jsxs)(o.A,{children:[(0,r.jsxs)(i.A,{value:"testbed-cloud-access-with-app-credentials",label:"Application Credentials",children:[(0,r.jsxs)(n.p,{children:["The use of application credentials is preferred. This way it is not necessary to store\ndetails like username, project name or sensitive information like the password in the\n",(0,r.jsx)(n.code,{children:"clouds.yaml"})," file."]}),(0,r.jsxs)(n.p,{children:["The application credentials can be found in Horizon under ",(0,r.jsx)(n.strong,{children:"Identity"}),". Use ",(0,r.jsx)(n.code,{children:"OSISM Testbed"})," as\nname and click ",(0,r.jsx)(n.code,{children:"Create Application Credential"}),"."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="terraform/clouds.yaml"',children:'clouds:\n  regiocloud:\n    profile: regiocloud\n    auth:\n      application_credential_id: ID\n      application_credential_secret: SECRET\n    auth_type: "v3applicationcredential"\n'})}),(0,r.jsxs)(n.p,{children:["If you want to make use of ",(0,r.jsx)(n.code,{children:"terraform/secure.yaml"})," add your application credential secret there\ninstead of ",(0,r.jsx)(n.code,{children:"terraform/clouds.yaml"}),"."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="terraform/secure.yaml"',children:"clouds:\n  regiocloud:\n    auth:\n      application_credential_secret: SECRET\n"})})]}),(0,r.jsxs)(i.A,{value:"testbed-cloud-access-with-username-password",label:"Username/Password",children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="terraform/clouds.yaml"',children:"clouds:\n  regiocloud:\n    profile: regiocloud\n    auth:\n      project_name: PROJECT\n      username: USERNAME\n      project_domain_name: DOMAIN\n      user_domain_name: DOMAIN\n"})}),(0,r.jsxs)(n.p,{children:["If you want to make use of ",(0,r.jsx)(n.code,{children:"terraform/secure.yaml"})," add your password there instead of ",(0,r.jsx)(n.code,{children:"terraform/clouds.yaml"}),"."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="terraform/secure.yaml"',children:"clouds:\n  regiocloud:\n    auth:\n      password: PASSWORD\n"})})]})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Prepare for the deployment."}),"\n",(0,r.jsxs)(n.p,{children:["The versions of Ansible and ",(0,r.jsx)(n.a,{href:"https://opentofu.org",children:"OpenTofu"})," are managed\nautomatically, and necessary dependencies are cloned."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"make prepare\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["If any error occurs during preparation, and you want to run the preparation\nagain, it is important to run ",(0,r.jsx)(n.code,{children:"make wipe-local-install"})," first. Otherwise, the\npreparation will not be redone completely, and necessary parts will be missing\nlater on."]})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"start-deployment",children:"Start deployment"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Create the infrastructure with OpenTofu."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"make ENVIRONMENT=regiocloud create\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Deploy the OSISM manager and bootstrap all nodes."}),"\n",(0,r.jsxs)(o.A,{children:[(0,r.jsx)(i.A,{value:"testbed-deploy-latest",label:"Deploy latest manager version",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"make ENVIRONMENT=regiocloud manager\n"})})}),(0,r.jsx)(i.A,{value:"testbed-deploy-stable",label:"Deploy a stable manager version",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"make ENVIRONMENT=regiocloud VERSION_MANAGER=8.0.1 manager\n"})})})]}),"\n",(0,r.jsxs)(n.p,{children:["Replace the version with the version you prefer.\nCheck the ",(0,r.jsx)(n.a,{href:"https://osism.tech/docs/release-notes/",children:"OSISM release notes"}),"\nto find out what's available."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"After the bootstrap, you can log in to the manager via SSH."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"make ENVIRONMENT=regiocloud login\n"})}),"\n",(0,r.jsx)(n.p,{children:"Yo can log in to the nodes of the cluster via the manager."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"osism console testbed-node-0\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Deploy all services."}),"\n",(0,r.jsxs)(o.A,{children:[(0,r.jsxs)(i.A,{value:"testbed-deploy-multi-steps",label:"Deployment in single steps",children:[(0,r.jsxs)(n.p,{children:["It is also possible to deploy the services step by step on the\nmanager. To do this, first log in to the manager with ",(0,r.jsx)(n.code,{children:"make ENVIRONMENT=regiocloud login"}),"\nand then execute the deployment scripts one after the other. It is recommended to do this\nwithin a screen session."]}),(0,r.jsx)(n.p,{children:"Deploying the services takes some time and depends on how much bandwidth is available,\nhow the instances are equipped, etc. 90\u2013120 minutes is not unusual when Ceph and OpenStack\nare fully deployed."}),(0,r.jsxs)(n.p,{children:["To speed up the Ansible playbooks, ",(0,r.jsx)(n.a,{href:"https://ara.recordsansible.org",children:"ARA"})," can be disabled. This\nis done by executing ",(0,r.jsx)(n.code,{children:"/opt/configuration/scripts/disable-ara.sh"}),". Run this script ",(0,r.jsx)(n.strong,{children:"before"})," the deployment scripts.\nAfterwards, no more logs are available in the ARA web\ninterface. To re-enable ARA use ",(0,r.jsx)(n.code,{children:"/opt/configuration/scripts/enable-ara.sh"}),"."]}),(0,r.jsxs)(n.p,{children:["There is also the option of pre-population of images with ",(0,r.jsx)(n.code,{children:"/opt/configuration/scripts/pull-images.sh"}),"\nso that deployments do not have to be lengthy. Run this script ",(0,r.jsx)(n.strong,{children:"before"})," the deployment scripts."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"/opt/configuration/scripts/deploy/001-helpers.sh\n/opt/configuration/scripts/deploy/100-ceph-with-ansible.sh\n/opt/configuration/scripts/deploy/200-infrastructure.sh\n/opt/configuration/scripts/deploy/300-openstack.sh\n/opt/configuration/scripts/deploy/400-monitoring.sh\n/opt/configuration/scripts/deploy/500-kubernetes.sh\n"})}),(0,r.jsxs)(n.p,{children:["Prepare OpenStack resources like public network, flavors and images by running\n",(0,r.jsx)(n.code,{children:"/opt/configuration/scripts/bootstrap.sh"}),". Run this script ",(0,r.jsx)(n.strong,{children:"after"})," the deployment scripts."]}),(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsxs)(n.p,{children:["If you only want to deploy the monitoring services with ",(0,r.jsx)(n.code,{children:"/opt/configuration/scripts/deploy/400-monitoring.sh"}),",\na few dependencies must be deployed first. You can then use the monitoring services without having to install a\ncomplete OpenStack & Ceph environment."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"osism apply common\nosism apply loadbalancer\nosism apply opensearch\nosism apply mariadb\n"})})]})]}),(0,r.jsxs)(i.A,{value:"testbed-deploy-single-step",label:"Deployment of all services",children:[(0,r.jsx)(n.p,{children:"In this single-step deployment, Ceph, OpenStack and all necessary\ninfrastructure services (MariaDB, RabbitMQ, ...) are deployed.\nDepending on the cloud, the deployment will take some time. Up to two hours is not unusual."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"make ENVIRONMENT=regiocloud deploy\n"})})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"verify-and-adjust-deployment",children:"Verify and adjust deployment"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["If you want to verify the deployment with ",(0,r.jsx)(n.a,{href:"https://opendev.org/openinfra/refstack",children:"refstack"})," run\n",(0,r.jsx)(n.code,{children:"/opt/configuration/scripts/check.sh"}),". This step will take some time and is optional."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The machine images required for the use of Kubernetes Cluster API and the amphora driver of OpenStack Octavia\nservice are not provided by default to save resources on the OSISM Testbed and improve deployment time.\nThese can be provisioned if required."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"/opt/configuration/scripts/bootstrap/301-openstack-octavia-amhpora-image.sh\n/opt/configuration/scripts/bootstrap/302-openstack-k8s-clusterapi-images.sh\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"If you want, you can create a test project with a test user after login. It also\ncreates an instance with a volume attached to a network with a router. This step is optional."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"osism apply --environment openstack test\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"When the OSISM Testbed is no longer needed, it can be deleted."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"make ENVIRONMENT=regiocloud clean\n"})}),"\n"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},19365:(e,n,s)=>{s.d(n,{A:()=>o});s(96540);var t=s(18215);const r={tabItem:"tabItem_Ymn6"};var a=s(74848);function o({children:e,hidden:n,className:s}){return(0,a.jsx)("div",{role:"tabpanel",className:(0,t.A)(r.tabItem,s),hidden:n,children:e})}},11470:(e,n,s)=>{s.d(n,{A:()=>N});var t=s(96540),r=s(18215),a=s(17559),o=s(23104),i=s(56347),l=s(205),c=s(57485),d=s(31682),u=s(70679);function h(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:s}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return h(e).map((({props:{value:e,label:n,attributes:s,default:t}})=>({value:e,label:n,attributes:s,default:t})))}(s);return function(e){const n=(0,d.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,s])}function m({value:e,tabValues:n}){return n.some((n=>n.value===e))}function f({queryString:e=!1,groupId:n}){const s=(0,i.W6)(),r=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,c.aZ)(r),(0,t.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(s.location.search);n.set(r,e),s.replace({...s.location,search:n.toString()})}),[r,s])]}function b(e){const{defaultValue:n,queryString:s=!1,groupId:r}=e,a=p(e),[o,i]=(0,t.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const s=n.find((e=>e.default))??n[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:a}))),[c,d]=f({queryString:s,groupId:r}),[h,b]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[s,r]=(0,u.Dv)(n);return[s,(0,t.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:r}),x=(()=>{const e=c??h;return m({value:e,tabValues:a})?e:null})();(0,l.A)((()=>{x&&i(x)}),[x]);return{selectedValue:o,selectValue:(0,t.useCallback)((e=>{if(!m({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);i(e),d(e),b(e)}),[d,b,a]),tabValues:a}}var x=s(92303);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var y=s(74848);function j({className:e,block:n,selectedValue:s,selectValue:t,tabValues:a}){const i=[],{blockElementScrollPositionUntilNextRender:l}=(0,o.a_)(),c=e=>{const n=e.currentTarget,r=i.indexOf(n),o=a[r].value;o!==s&&(l(n),t(o))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const s=i.indexOf(e.currentTarget)+1;n=i[s]??i[0];break}case"ArrowLeft":{const s=i.indexOf(e.currentTarget)-1;n=i[s]??i[i.length-1];break}}n?.focus()};return(0,y.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},e),children:a.map((({value:e,label:n,attributes:t})=>(0,y.jsx)("li",{role:"tab",tabIndex:s===e?0:-1,"aria-selected":s===e,ref:e=>{i.push(e)},onKeyDown:d,onClick:c,...t,className:(0,r.A)("tabs__item",g.tabItem,t?.className,{"tabs__item--active":s===e}),children:n??e},e)))})}function v({lazy:e,children:n,selectedValue:s}){const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=a.find((e=>e.props.value===s));return e?(0,t.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,y.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==s})))})}function w(e){const n=b(e);return(0,y.jsxs)("div",{className:(0,r.A)(a.G.tabs.container,"tabs-container",g.tabList),children:[(0,y.jsx)(j,{...n,...e}),(0,y.jsx)(v,{...n,...e})]})}function N(e){const n=(0,x.A)();return(0,y.jsx)(w,{...e,children:h(e.children)},String(n))}},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>i});var t=s(96540);const r={},a=t.createContext(r);function o(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);