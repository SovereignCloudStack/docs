"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[87638],{49862:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"iaas/guides/deploy-guide/bootstrap","title":"Bootstrap","description":"The prerequisite for bootstraping the nodes of a cluster the Manager node has to be","source":"@site/docs/02-iaas/guides/deploy-guide/bootstrap.md","sourceDirName":"02-iaas/guides/deploy-guide","slug":"/iaas/guides/deploy-guide/bootstrap","permalink":"/docs/iaas/guides/deploy-guide/bootstrap","draft":false,"unlisted":false,"editUrl":"https://github.com/SovereignCloudStack/docs/tree/main/docs/02-iaas/guides/deploy-guide/bootstrap.md","tags":[],"version":"current","sidebarPosition":40,"frontMatter":{"sidebar_label":"Bootstrap","sidebar_position":40},"sidebar":"docs","previous":{"title":"Provisioning","permalink":"/docs/iaas/guides/deploy-guide/provisioning"},"next":{"title":"Services","permalink":"/docs/iaas/guides/deploy-guide/services/"}}');var i=n(74848),r=n(28453);const t={sidebar_label:"Bootstrap",sidebar_position:40},a="Bootstrap",d={},l=[];function c(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"bootstrap",children:"Bootstrap"})}),"\n",(0,i.jsxs)(s.admonition,{type:"info",children:[(0,i.jsxs)(s.p,{children:["The prerequisite for bootstraping the nodes of a cluster the Manager node has to be\nprepares. What a Manager node is and how to prepare it is documented in the\n",(0,i.jsx)(s.a,{href:"/docs/iaas/guides/deploy-guide/manager",children:"Manager chapter of the Deploy Guide"}),"."]}),(0,i.jsxs)(s.p,{children:["All the nodes must also have already been provisioned. How manual provisioning is done\nis documented in the ",(0,i.jsx)(s.a,{href:"/docs/iaas/guides/deploy-guide/provisioning",children:"Provisioning chapter of the Deploy Guide"}),"."]})]}),"\n",(0,i.jsxs)(s.p,{children:["Before the nodes can be bootstrapped, they must all have already been provisioned.\nThe guide for this can be found in the section ",(0,i.jsx)(s.a,{href:"/docs/iaas/guides/deploy-guide/provisioning",children:"Provisioning of bare-metal nodes"}),"."]}),"\n",(0,i.jsx)(s.p,{children:"The following steps are applied to bootstrap all nodes. After the completion of the bootstrap,\nthe nodes are already ready for use."}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Create operator user."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"osism apply operator -u osism\n"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["When using the ",(0,i.jsx)(s.a,{href:"https://github.com/osism/node-image",children:"osism/node-image"})," the user is ",(0,i.jsx)(s.code,{children:"osism"}),"\nand the password of this user is ",(0,i.jsx)(s.code,{children:"password"}),". If you install Ubuntu manually the user usually\nis ",(0,i.jsx)(s.code,{children:"ubuntu"}),". If you want to use any other user here, with exception of ",(0,i.jsx)(s.code,{children:"dragon"}),", that's no problem.\nThe later used operator user ",(0,i.jsx)(s.code,{children:"dragon"})," is created during the bootstrap and ",(0,i.jsx)(s.strong,{children:"should not be created"}),"\nduring the installation. Do not use ",(0,i.jsx)(s.code,{children:"dragon"})," as username. It is important that\nthis user has sudo rights. The password according to what you have set yourself."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["The operator public SSH key has to be added in advance on all nodes to ",(0,i.jsx)(s.code,{children:"authorized_keys"})," file\nof the user specified with ",(0,i.jsx)(s.code,{children:"-u"}),". This key is stored as ",(0,i.jsx)(s.code,{children:"operator_public_key"})," in the file\n",(0,i.jsx)(s.code,{children:"environments/configuration.yml"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["Alternatively (not recommended), the password can be stored in plain text in a file ",(0,i.jsx)(s.code,{children:"/opt/configuration/secrets/conn_password"}),".\nThe parameter ",(0,i.jsx)(s.code,{children:"--conn-pass-file /opt/configuration/secrets/conn_password"})," must then also be specified:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"osism apply operator -u osism \\\n  --conn-pass-file /opt/configuration/secrets/conn_password\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["It is important that this user has sudo rights with ",(0,i.jsx)(s.code,{children:"NOPASSWD"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["Alternatively (not recommended), the password can be stored in plain text in a file ",(0,i.jsx)(s.code,{children:"/opt/configuration/secrets/become_password"}),".\nThe parameter ",(0,i.jsx)(s.code,{children:"--become-pass-file /opt/configuration/secrets/become_password"})," must then also be specified:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"osism apply operator -u osism \\\n  --become-pass-file /opt/configuration/secrets/become_password\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"If a password is required for both sudo and login, use both arguments at the same time."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"osism apply operator -u osism \\\n  --become-pass-file /opt/configuration/secrets/become_password \\\n  --conn-pass-file /opt/configuration/secrets/conn_password\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["When using the ",(0,i.jsx)(s.a,{href:"https://github.com/osism/node-image",children:"osism/node-image"})," the user is ",(0,i.jsx)(s.code,{children:"osism"})," and the password of this\nuser is ",(0,i.jsx)(s.code,{children:"password"}),". If you install Ubuntu manually the user usually is ",(0,i.jsx)(s.code,{children:"ubuntu"}),". The password according to what you\nhave set yourself"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Proxy deployment (optional). This is only necessary if you use the proxy on the manager to enable external access to\nthe nodes."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"osism apply squid\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Proxy configuration (optional). This is only necessary if you use the proxy on the manager to enable external access to\nthe nodes."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"osism apply proxy\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Network configuration. It is recommended to backup the existing network configuration."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"osism apply network\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Reboot (optional). The reboot at this point is recommended to ensure that the network configuration is working."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"osism apply reboot -l 'all:!manager' -e ireallymeanit=yes\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Check if all systems are reachable (you probably have to do this several times until all systems are accessible)."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"osism apply ping\n"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"System is currently rebooting and is not yet accessible via network."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:'fatal: [net003]: UNREACHABLE! => {"changed": false, "msg": "Connection timed\nout.", "unreachable": true}``\n'})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"System has already been rebooted and is not accessible via the network."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:'fatal: [net003]: UNREACHABLE! => {"changed": false, "msg": "EOF on stream;\nlast 100 lines received:\\nssh: connect to host 10.15.0.33 port 22: No route\nto host\\r", "unreachable": true}\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Refresh facts."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"osism apply facts\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Bootstrap."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"osism apply bootstrap\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Reboot (non-optional). Since the kernel version often changes after the initial bootstrap,\nthe reboot should always be performed."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"osism apply reboot -l 'all:!manager' -e ireallymeanit=yes\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Check if all systems are reachable (you probably have to do this several times until all systems are accessible)."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"osism apply ping\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Prepare the SSH configuration of the manager node."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"osism apply sshconfig\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Make all SSH public keys known."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"osism apply known-hosts\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Ready. All nodes are now bootstrapped and available to deploy services."})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>t,x:()=>a});var o=n(96540);const i={},r=o.createContext(i);function t(e){const s=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),o.createElement(r.Provider,{value:s},e.children)}}}]);