"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[96162],{51302:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"iaas/guides/user-guide/openstack/install-instance-from-iso","title":"Install instance from ISO image","description":"While in general it is considered best practice to create instances from existing or specially crafted images, sometimes it is necessary to install an instance using a traditional installer packaged in an ISO image.","source":"@site/docs/02-iaas/guides/user-guide/openstack/install-instance-from-iso.md","sourceDirName":"02-iaas/guides/user-guide/openstack","slug":"/iaas/guides/user-guide/openstack/install-instance-from-iso","permalink":"/docs/iaas/guides/user-guide/openstack/install-instance-from-iso","draft":false,"unlisted":false,"editUrl":"https://github.com/SovereignCloudStack/docs/tree/main/docs/02-iaas/guides/user-guide/openstack/install-instance-from-iso.md","tags":[],"version":"current","frontMatter":{"sidebar_label":"Install instance from ISO image"},"sidebar":"docs","previous":{"title":"Client","permalink":"/docs/iaas/guides/user-guide/openstack/openstackclient"},"next":{"title":"Migration from VMware ESXi","permalink":"/docs/iaas/guides/user-guide/openstack/migration-vmware-esxi"}}');var t=s(74848),i=s(28453);const o={sidebar_label:"Install instance from ISO image"},r="Install instance from ISO image",c={},l=[{value:"Upload the ISO image",id:"upload-the-iso-image",level:2},{value:"Creating the instance",id:"creating-the-instance",level:2},{value:"Using nova local storage",id:"using-nova-local-storage",level:3},{value:"Using boot from volume",id:"using-boot-from-volume",level:3},{value:"Install the created instance from the uploaded ISO",id:"install-the-created-instance-from-the-uploaded-iso",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"install-instance-from-iso-image",children:"Install instance from ISO image"})}),"\n",(0,t.jsxs)(n.p,{children:["While in general it is considered best practice to create instances from existing or specially crafted images, sometimes it is necessary to install an instance using a traditional installer packaged in an ISO image.\nOne way to do this in OpenStack is to leverage the ",(0,t.jsx)(n.a,{href:"https://docs.openstack.org/nova/latest/user/rescue.html",children:"instance rescue mechanism"}),", which allows to boot an instance from another image while providing access to the instances storage."]}),"\n",(0,t.jsx)(n.h2,{id:"upload-the-iso-image",children:"Upload the ISO image"}),"\n",(0,t.jsx)(n.p,{children:"If the required ISO image is not available in the image store yet upload it first:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'PATH_TO_ISO_IMAGE=""\nIMAGE_NAME=""\nopenstack image create \\\n  --disk-format iso \\\n  --file $PATH_TO_ISO_IMAGE \\\n  --property hw_rescue_device=disk \\\n  --property hw_rescue_bus=virtio \\\n  $IMAGE_NAME\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"hw_rescue_device"})," and ",(0,t.jsx)(n.code,{children:"hw_rescue_bus"})," properties may be omitted if you do not intent to create an instance from a boot volume."]}),"\n",(0,t.jsx)(n.h2,{id:"creating-the-instance",children:"Creating the instance"}),"\n",(0,t.jsx)(n.h3,{id:"using-nova-local-storage",children:"Using nova local storage"}),"\n",(0,t.jsx)(n.p,{children:"One cannot create an instance with a blank local boot device. As a workaround create a blank image first, e.g.:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'BLANK_IMAGE_NAME="blank"\ndd if=/dev/zero of="$BLANK_IMAGE_NAME" bs=1k count=1\nopenstack image create \\\n  --file "$BLANK_IMAGE_NAME" \\\n  "$BLANK_IMAGE_NAME"\nrm  "$BLANK_IMAGE_NAME"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Create the instance:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'INSTANCE_NAME=""\nFLAVOR=""\nopenstack server create \\\n  --flavor "$FLAVOR" \\\n  --image "$BLANK_IMAGE_NAME" \\\n  --no-network \\\n  "$INSTANCE_NAME"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"using-boot-from-volume",children:"Using boot from volume"}),"\n",(0,t.jsx)(n.p,{children:"Create an instance with a blank boot volume"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'INSTANCE_NAME=""\nFLAVOR=""\nBOOT_VOLUME_SIZE=""\nopenstack server create \\\n  --flavor "$FLAVOR" \\\n  --block-device "source_type=blank,destination_type=volume,volume_size=$BOOT_VOLUME_SIZE,boot_index=0" \\\n  --no-network \\\n  "$INSTANCE_NAME"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Set the created volume to bootable"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"openstack volume set --bootable $(openstack server show $INSTANCE_NAME -f json -c attached_volumes | jq -r '.attached_volumes | first | .id')\n"})}),"\n",(0,t.jsx)(n.h2,{id:"install-the-created-instance-from-the-uploaded-iso",children:"Install the created instance from the uploaded ISO"}),"\n",(0,t.jsx)(n.p,{children:"Use the rescue mechanism to boot the ISO, e.g.:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"openstack server rescue \\\n  --image $IMAGE_NAME \\\n  $INSTANCE_NAME\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Wait for the instance to be rescued. This will take a moment, as a soft reboot is tried before issuing a hard reboot.\nWatch the instance ",(0,t.jsx)(n.code,{children:"task_state"})," and ",(0,t.jsx)(n.code,{children:"status"})," to see the latter change from ",(0,t.jsx)(n.code,{children:"ACTIVE"})," to ",(0,t.jsx)(n.code,{children:"RESCUE"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"watch openstack server show $INSTANCE_NAME -f value -c status -c task_state\n"})}),"\n",(0,t.jsx)(n.p,{children:"Start the installation procedure, e.g. by opening the instance's console"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"openstack console url show $INSTANCE_NAME\n"})}),"\n",(0,t.jsx)(n.p,{children:"The instances storage device should be available as a destination for the installation.\nRebooting the instance in this state will lead to the rescue image being booted again.\nTo boot the instance from its freshly provisioned boot device unrescue the instance:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"openstack server unrescue $INSTANCE_NAME\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>r});var a=s(96540);const t={},i=a.createContext(t);function o(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);