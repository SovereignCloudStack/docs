<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-iaas/guides/operations-guide/ceph/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Ceph | One platform — standardized, built and operated by many.</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.scs.community/img/scs-og-basic.png"><meta data-rh="true" name="twitter:image" content="https://docs.scs.community/img/scs-og-basic.png"><meta data-rh="true" property="og:url" content="https://docs.scs.community/docs/iaas/guides/operations-guide/ceph/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Ceph | One platform — standardized, built and operated by many."><meta data-rh="true" name="description" content="Where to find docs"><meta data-rh="true" property="og:description" content="Where to find docs"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://docs.scs.community/docs/iaas/guides/operations-guide/ceph/"><link data-rh="true" rel="alternate" href="https://docs.scs.community/docs/iaas/guides/operations-guide/ceph/" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.scs.community/docs/iaas/guides/operations-guide/ceph/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"IaaS Layer","item":"https://docs.scs.community/docs/category/iaas-layer"},{"@type":"ListItem","position":2,"name":"Operations Guide","item":"https://docs.scs.community/docs/iaas/guides/operations-guide/"},{"@type":"ListItem","position":3,"name":"Ceph","item":"https://docs.scs.community/docs/iaas/guides/operations-guide/ceph/"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="SCS Community Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="SCS Community Blog Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="SCS Community Blog JSON Feed">









<link rel="preconnect" href="https://matomo.scs.community/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setDocumentTitle",document.domain+"/"+document.title]),_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var e="https://matomo.scs.community/";_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","2"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script><link rel="stylesheet" href="/assets/css/styles.7136250c.css">
<script src="/assets/js/runtime~main.07d47f80.js" defer="defer"></script>
<script src="/assets/js/main.23799193.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="SCS" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="SCS" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/standards">Standards</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">For Operators</a><a class="navbar__item navbar__link" href="/contributor-docs">For Contributors</a><a class="navbar__item navbar__link" href="/user-docs">For Users</a><a class="navbar__item navbar__link" href="/community">Community</a><a class="navbar__item navbar__link" href="/docs/faq">FAQ</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/SovereignCloudStack/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/docs/category/iaas-layer"><span title="IaaS Layer" class="categoryLinkLabel_W154">IaaS Layer</span></a><button aria-label="Collapse sidebar category &#x27;IaaS Layer&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/iaas/guides/concept-guide/"><span title="Guides" class="categoryLinkLabel_W154">Guides</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/concept-guide/"><span title="Concept Guide" class="categoryLinkLabel_W154">Concept Guide</span></a><button aria-label="Expand sidebar category &#x27;Concept Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/deploy-guide/"><span title="Deploy Guide" class="categoryLinkLabel_W154">Deploy Guide</span></a><button aria-label="Expand sidebar category &#x27;Deploy Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/upgrade-guide/"><span title="Upgrade Guide" class="categoryLinkLabel_W154">Upgrade Guide</span></a><button aria-label="Expand sidebar category &#x27;Upgrade Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/configuration-guide/"><span title="Configuration Guide" class="categoryLinkLabel_W154">Configuration Guide</span></a><button aria-label="Expand sidebar category &#x27;Configuration Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/iaas/guides/operations-guide/"><span title="Operations Guide" class="categoryLinkLabel_W154">Operations Guide</span></a><button aria-label="Collapse sidebar category &#x27;Operations Guide&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/operations-guide/manager/"><span title="Manager" class="categoryLinkLabel_W154">Manager</span></a><button aria-label="Expand sidebar category &#x27;Manager&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iaas/guides/operations-guide/baremetal/"><span title="Baremetal" class="linkLabel_WmDU">Baremetal</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" aria-current="page" tabindex="0" href="/docs/iaas/guides/operations-guide/ceph/"><span title="Ceph" class="categoryLinkLabel_W154">Ceph</span></a><button aria-label="Collapse sidebar category &#x27;Ceph&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iaas/guides/operations-guide/ceph/rook"><span title="Operations for Rook" class="linkLabel_WmDU">Operations for Rook</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iaas/guides/operations-guide/infrastructure"><span title="Infrastructure" class="linkLabel_WmDU">Infrastructure</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iaas/guides/operations-guide/kubernetes"><span title="Kubernetes" class="linkLabel_WmDU">Kubernetes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iaas/guides/operations-guide/network"><span title="Network" class="linkLabel_WmDU">Network</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/operations-guide/node/"><span title="Node" class="categoryLinkLabel_W154">Node</span></a><button aria-label="Expand sidebar category &#x27;Node&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/operations-guide/openstack/"><span title="OpenStack" class="categoryLinkLabel_W154">OpenStack</span></a><button aria-label="Expand sidebar category &#x27;OpenStack&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iaas/guides/operations-guide/sonic/"><span title="SONiC" class="linkLabel_WmDU">SONiC</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/troubleshooting-guide/"><span title="Troubleshooting Guide" class="categoryLinkLabel_W154">Troubleshooting Guide</span></a><button aria-label="Expand sidebar category &#x27;Troubleshooting Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iaas/guides/"><span title="Guides" class="linkLabel_WmDU">Guides</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/user-guide/"><span title="User Guide" class="categoryLinkLabel_W154">User Guide</span></a><button aria-label="Expand sidebar category &#x27;User Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/developer-guide/"><span title="Developer Guide" class="categoryLinkLabel_W154">Developer Guide</span></a><button aria-label="Expand sidebar category &#x27;Developer Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/migration-guide/"><span title="Migration Guide" class="categoryLinkLabel_W154">Migration Guide</span></a><button aria-label="Expand sidebar category &#x27;Migration Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/category/components"><span title="Components" class="categoryLinkLabel_W154">Components</span></a><button aria-label="Expand sidebar category &#x27;Components&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/category/deployment-examples"><span title="Deployment Examples" class="categoryLinkLabel_W154">Deployment Examples</span></a><button aria-label="Expand sidebar category &#x27;Deployment Examples&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/container/"><span title="Container Layer" class="categoryLinkLabel_W154">Container Layer</span></a><button aria-label="Expand sidebar category &#x27;Container Layer&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/category/operating-scs"><span title="Operating SCS" class="categoryLinkLabel_W154">Operating SCS</span></a><button aria-label="Expand sidebar category &#x27;Operating SCS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/iam/"><span title="Identity and Access Management (IAM)" class="categoryLinkLabel_W154">Identity and Access Management (IAM)</span></a><button aria-label="Expand sidebar category &#x27;Identity and Access Management (IAM)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/category/turnkey-solution"><span title="Turnkey Solution" class="categoryLinkLabel_W154">Turnkey Solution</span></a><button aria-label="Expand sidebar category &#x27;Turnkey Solution&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/category/releases"><span title="Releases" class="categoryLinkLabel_W154">Releases</span></a><button aria-label="Expand sidebar category &#x27;Releases&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq/"><span title="FAQ" class="linkLabel_WmDU">FAQ</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/glossary"><span title="Glossary" class="linkLabel_WmDU">Glossary</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/iaas-layer"><span>IaaS Layer</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/iaas/guides/operations-guide/"><span>Operations Guide</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Ceph</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Ceph</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="where-to-find-docs">Where to find docs<a href="#where-to-find-docs" class="hash-link" aria-label="Direct link to Where to find docs" title="Direct link to Where to find docs" translate="no">​</a></h2>
<p>The official Ceph documentation is located on <a href="https://docs.ceph.com/en/latest/rados/operations/" target="_blank" rel="noopener noreferrer" class="">https://docs.ceph.com/en/latest/rados/operations/</a></p>
<p>It is <strong>strongly advised</strong> to use the documentation for the version being used.</p>
<ul>
<li class="">Pacific - <a href="https://docs.ceph.com/en/pacific/rados/operations/" target="_blank" rel="noopener noreferrer" class="">https://docs.ceph.com/en/pacific/rados/operations/</a></li>
<li class="">Quincy - <a href="https://docs.ceph.com/en/quincy/rados/operations/" target="_blank" rel="noopener noreferrer" class="">https://docs.ceph.com/en/quincy/rados/operations/</a></li>
<li class="">Reef - <a href="https://docs.ceph.com/en/reef/rados/operations/" target="_blank" rel="noopener noreferrer" class="">https://docs.ceph.com/en/reef/rados/operations/</a></li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Do not take information in the documentation at face value.
Especially when it comes to advanced/rarely used/very new features it is <strong>strongly advised</strong>
to test any claims made in the documentation about any particular feature.</p><p>Never assume that things will work as written without actually testing it on a test setup
as close to your real workload scenario as possible.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="advice-on-ceph-releases">Advice on Ceph releases<a href="#advice-on-ceph-releases" class="hash-link" aria-label="Direct link to Advice on Ceph releases" title="Direct link to Advice on Ceph releases" translate="no">​</a></h2>
<p>The current Ceph releases and their support status can be found on <a href="https://docs.ceph.com/en/latest/releases/" target="_blank" rel="noopener noreferrer" class="">https://docs.ceph.com/en/latest/releases/</a></p>
<p>When a new Ceph stable version is released you are <strong>strongly advised</strong>
to not roll it out on any production cluster whatsoever.
Even though its listed as &quot;stable&quot; it doesn&#x27;t mean that this is actually true.
Especially avoid using .0 releases on anything remotely production
unless you really, really now what you&#x27;re doing and can live with a possible catastrophic failure.</p>
<p>Be <strong>very</strong> conservative about what version you run on production systems.</p>
<p>Shiny new features aren&#x27;t worth the risk of total or partial data loss/corruption.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="general-maintenance">General maintenance<a href="#general-maintenance" class="hash-link" aria-label="Direct link to General maintenance" title="Direct link to General maintenance" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="60-seconds-cluster-overview">60 seconds cluster overview<a href="#60-seconds-cluster-overview" class="hash-link" aria-label="Direct link to 60 seconds cluster overview" title="Direct link to 60 seconds cluster overview" translate="no">​</a></h3>
<p>The following commands can be used to quickly check the status of Ceph:</p>
<ul>
<li class="">
<p>Print overall cluster status</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph -s</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Print detailed health information</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph health detail</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Display current OSD tree</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd tree</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Cluster storage usage by pool and storage class</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph df</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>List pools with detailed configuration</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd pool ls detail</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Get usage stats for OSDs</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd df {plain|tree} {class e.g. hdd|ssd}</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Watch Ceph health messages sequentially</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph -w</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>List daemon versions running in the cluster</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph versions</span><br></span></code></pre></div></div>
</li>
</ul>
<p>Also you can run the following on each node running ceph-daemons,
to provide further debug information about the environment:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">lscpu</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cat /proc/cpuinfo # if lscpu isn&#x27;t available</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">free -g</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ip l</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ethtool &lt;device&gt; # for each network adapter</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="muteunmute-a-health-warning">Mute/Unmute a health warning<a href="#muteunmute-a-health-warning" class="hash-link" aria-label="Direct link to Mute/Unmute a health warning" title="Direct link to Mute/Unmute a health warning" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph health mute &lt;what&gt; &lt;duration&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph health unmute &lt;what&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="disableenable-deep-scrubbing">Disable/Enable (deep-)scrubbing<a href="#disableenable-deep-scrubbing" class="hash-link" aria-label="Direct link to Disable/Enable (deep-)scrubbing" title="Direct link to Disable/Enable (deep-)scrubbing" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd set noscrub</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd set nodeep-scrub</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd unset noscrub</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd unset nodeep-scrub</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Use this sparingly only in emergency situations.
Setting these flags will cause a HEALTH_WARN status,
increase risk of data corruption and also the risk of generating
a HEALTH_WARN due to PGs not being (deep-)scrubbed in time.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="reboot-a-single-node">Reboot a single node<a href="#reboot-a-single-node" class="hash-link" aria-label="Direct link to Reboot a single node" title="Direct link to Reboot a single node" translate="no">​</a></h3>
<p>The traditional way of doing this is by setting the <code>noout</code> flag,
do the appropriate maintenance work and after the node is back online
unset the flag like so:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd set noout</span><br></span></code></pre></div></div>
<p>After maintenance is done and host is back up:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd unset noout</span><br></span></code></pre></div></div>
<p>On versions Luminous or above you can set the flag individually for single
OSDs or entire CRUSH buckets, which can be a safer option in case of prolonged
maintenance periods.</p>
<p>Add noout for a OSD:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd add-noout osd.&lt;ID&gt;</span><br></span></code></pre></div></div>
<p>Remove noout for a OSD:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd rm-noout osd.&lt;ID&gt;</span><br></span></code></pre></div></div>
<p>Add noout for CRUSH bucket (e.g. host name as seen in <code>ceph osd tree</code>):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd set-group noout &lt;crush-bucket-name&gt;</span><br></span></code></pre></div></div>
<p>Remove noout for CRUSH bucket:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd unset-group noout &lt;crush-bucket-name&gt;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="gathering-information-about-block-devices">Gathering information about block devices<a href="#gathering-information-about-block-devices" class="hash-link" aria-label="Direct link to Gathering information about block devices" title="Direct link to Gathering information about block devices" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="enumerate-typical-storage-devices-and-lvm">Enumerate typical storage devices and LVM<a href="#enumerate-typical-storage-devices-and-lvm" class="hash-link" aria-label="Direct link to Enumerate typical storage devices and LVM" title="Direct link to Enumerate typical storage devices and LVM" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">lsblk</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lsblk -S</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lsscsi</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nvme list</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pvs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">vgs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lvs</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="smart-data-for-satasas-and-nvme-devices">SMART data for SATA/SAS and NVME devices<a href="#smart-data-for-satasas-and-nvme-devices" class="hash-link" aria-label="Direct link to SMART data for SATA/SAS and NVME devices" title="Direct link to SMART data for SATA/SAS and NVME devices" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">smartctl -a /dev/sdX</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nvme smart-log /dev/nvmeXnY</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="check-format-of-a-nvme-device">Check format of a NVME device<a href="#check-format-of-a-nvme-device" class="hash-link" aria-label="Direct link to Check format of a NVME device" title="Direct link to Check format of a NVME device" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">nvme id-ns -H /dev/nvmeXnY</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Check the last lines named &quot;LBA Format&quot;.
It will show which formats are supported,
which format is in use and which format offers the best performance
according to the vendor.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="format-a-nvme-device-to-a-different-lba-format-using-nvme-cli">Format a NVME device to a different LBA format using nvme-cli<a href="#format-a-nvme-device-to-a-different-lba-format-using-nvme-cli" class="hash-link" aria-label="Direct link to Format a NVME device to a different LBA format using nvme-cli" title="Direct link to Format a NVME device to a different LBA format using nvme-cli" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>This will destroy all data on the device!</p></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">nvme format --lbaf=&lt;id&gt; /dev/nvmeXnY</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="secure-erase-a-nvme-drive-using-nvme-cli">Secure Erase a NVME drive using nvme-cli<a href="#secure-erase-a-nvme-drive-using-nvme-cli" class="hash-link" aria-label="Direct link to Secure Erase a NVME drive using nvme-cli" title="Direct link to Secure Erase a NVME drive using nvme-cli" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>This will destroy all data on the device!</p></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">nvme format -s2 /dev/nvmeXnY</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">blkdiscard /dev/nvmeXnY</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nvme format -s1 /dev/nvmeXnY</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="secure-erase-a-satasas-drive-using-hdparm">Secure Erase a SATA/SAS drive using hdparm<a href="#secure-erase-a-satasas-drive-using-hdparm" class="hash-link" aria-label="Direct link to Secure Erase a SATA/SAS drive using hdparm" title="Direct link to Secure Erase a SATA/SAS drive using hdparm" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>This will destroy all data on the device!</p></div></div>
<ol>
<li class="">
<p>Gather device info:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">hdparm -I /dev/sdX</span><br></span></code></pre></div></div>
</li>
</ol>
<p>Check that the output says <strong>&quot;not frozen&quot;</strong> and <strong>&quot;not locked&quot;</strong>,
also it should list support for enhanced erase and list time estimates
for <strong>SECURITY ERASE UNIT</strong> and/or <strong>ENHANCED SECURITY ERASE UNIT</strong></p>
<ol start="2">
<li class="">
<p>Set a master password for the disk (required, will be automatically removed after wipe)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">hdparm --user-master wipeit --security-set-pass wipeit /dev/sdX</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">hdparm -I /dev/sdX</span><br></span></code></pre></div></div>
<p>Check that &quot;Security level&quot; is now <strong>&quot;high&quot;</strong> and master password is now
<strong>&quot;enabled&quot;</strong> instead of <strong>&quot;not enabled&quot;</strong> before</p>
</li>
<li class="">
<p>Wipe the device</p>
<p>If device supports enhanced security erase (better), use the following:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">hdparm --user-master wipeit --security-erase-enhanced wipeit /dev/sdX</span><br></span></code></pre></div></div>
<p>If not, use standard security erase:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">hdparm --user-master wipeit --security-erase wipeit /dev/sdX</span><br></span></code></pre></div></div>
</li>
</ol>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>On some systems the system firmware might &quot;freeze&quot; the device,
which makes it impossible to issue a secure erase or reformat the device.
In that case it might be necessary to either &quot;unfreeze&quot; the drive or
to install the drive in another system where it can be unfrozen.
Also make sure that the device is <em>actually</em> wiped. Its recommended to
at least perform a blanking pass on HDDs with a tool like nwipe.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="osd-maintenance-tasks">OSD maintenance tasks<a href="#osd-maintenance-tasks" class="hash-link" aria-label="Direct link to OSD maintenance tasks" title="Direct link to OSD maintenance tasks" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="locate-a-specific-osd-in-the-cluster">Locate a specific OSD in the cluster<a href="#locate-a-specific-osd-in-the-cluster" class="hash-link" aria-label="Direct link to Locate a specific OSD in the cluster" title="Direct link to Locate a specific OSD in the cluster" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd find osd.&lt;ID&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="get-osd-metadata-global-and-single-osd">Get OSD metadata (global and single OSD)<a href="#get-osd-metadata-global-and-single-osd" class="hash-link" aria-label="Direct link to Get OSD metadata (global and single OSD)" title="Direct link to Get OSD metadata (global and single OSD)" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd metadata</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd metadata osd.&lt;ID&gt;</span><br></span></code></pre></div></div>
<p>Interesting fields:</p>
<ul>
<li class="">bluefs_db_rotational</li>
<li class="">bluefs_dedicated_db</li>
<li class="">bluefs_dedicated_wal</li>
<li class="">bluefs_wal_rotational</li>
<li class="">bluestore_bdev_rotational</li>
<li class="">device_ids</li>
<li class="">device_paths</li>
<li class="">devices</li>
<li class="">hostname</li>
<li class="">osd_objectstore</li>
<li class="">rotational</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="add-a-new-osd">Add a new OSD<a href="#add-a-new-osd" class="hash-link" aria-label="Direct link to Add a new OSD" title="Direct link to Add a new OSD" translate="no">​</a></h3>
<ol>
<li class="">
<p>Prepare the configuration for the new OSD first. Details on adding the configuration
for a new OSD in the <a class="" href="/docs/iaas/guides/configuration-guide/ceph/#add-a-new-osd">Ceph configuration guide</a>.</p>
</li>
<li class="">
<p>Deploy the new OSD service on <code>&lt;nodename&gt;</code>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">osism apply ceph-osds -l &lt;nodename&gt; -e ceph_handler_osds_restart=false</span><br></span></code></pre></div></div>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="replace-a-defect-osd">Replace a defect OSD<a href="#replace-a-defect-osd" class="hash-link" aria-label="Direct link to Replace a defect OSD" title="Direct link to Replace a defect OSD" translate="no">​</a></h3>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="remove-a-osd">Remove a OSD<a href="#remove-a-osd" class="hash-link" aria-label="Direct link to Remove a OSD" title="Direct link to Remove a OSD" translate="no">​</a></h3>
<p>As with ‘Remove a single OSD node’. Except that the steps are only executed
for a single OSD and the node is not removed from the CRUSH map and the inventory.
Only the entries relating to the removed OSD are removed from the host vars.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="manual-way">Manual way<a href="#manual-way" class="hash-link" aria-label="Direct link to Manual way" title="Direct link to Manual way" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd crush reweight osd.&lt;ID&gt; 0.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Wait for rebalance to complete...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd out osd.&lt;ID&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl stop ceph-osd@&lt;ID&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl disable ceph-osd@&lt;ID&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd purge osd.&lt;ID&gt; --yes-i-really-mean-it</span><br></span></code></pre></div></div>
<p>The LV and VG defined in the inventory for this OSD must also be removed. The
OSD itself should be wiped.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="remove-a-single-osd-node">Remove a single OSD node<a href="#remove-a-single-osd-node" class="hash-link" aria-label="Direct link to Remove a single OSD node" title="Direct link to Remove a single OSD node" translate="no">​</a></h3>
<ol>
<li class="">
<p>Get all OSDs  of the node</p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ceph osd tree</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ID  CLASS  WEIGHT   TYPE NAME                STATUS  REWEIGHT  PRI-AFF</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-1         0.11691  root default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-3         0.03897      host testbed-node-0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 0    hdd  0.01949          osd.0                up   1.00000  1.00000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 4    hdd  0.01949          osd.4                up   1.00000  1.00000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-5         0.03897      host testbed-node-1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1    hdd  0.01949          osd.1                up   1.00000  1.00000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 3    hdd  0.01949          osd.3                up   1.00000  1.00000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-7         0.03897      host testbed-node-2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 2    hdd  0.01949          osd.2                up   1.00000  1.00000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 5    hdd  0.01949          osd.5                up   1.00000  1.00000</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Reduce the weighting of all OSDs on the node to 0. Do this for each OSD
in a row and wait after each adjustment until the Ceph cluster is balanced.
Depending on how large the Ceph cluster and the individual OSDs are, this
may take some time.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd crush reweight osd.2 0.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd crush reweight osd.5 0.0</span><br></span></code></pre></div></div>
<p>The Ceph OSDs that are to be removed then have a weight of 0.</p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ceph osd tree</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ID  CLASS  WEIGHT   TYPE NAME                STATUS  REWEIGHT  PRI-AFF</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-1         0.07794  root default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-3         0.03897      host testbed-node-0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 0    hdd  0.01949          osd.0                up   1.00000  1.00000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 4    hdd  0.01949          osd.4                up   1.00000  1.00000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-5         0.03897      host testbed-node-1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1    hdd  0.01949          osd.1                up   1.00000  1.00000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 3    hdd  0.01949          osd.3                up   1.00000  1.00000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-7               0      host testbed-node-2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 2    hdd        0          osd.2                up   1.00000  1.00000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 5    hdd        0          osd.5                up   1.00000  1.00000</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Remove the OSDs and everything that belongs to them from the node.
This is a disruptive action that cannot be undone. The devices used
are also reset.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">osism apply ceph-shrink-osd -e ireallymeanit=yes -e osd_to_kill=2,5</span><br></span></code></pre></div></div>
<p>All OSDs were removed.</p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ceph osd tree</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ID  CLASS  WEIGHT   TYPE NAME                STATUS  REWEIGHT  PRI-AFF</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-1         0.07794  root default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-3         0.03897      host testbed-node-0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 0    hdd  0.01949          osd.0                up   1.00000  1.00000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 4    hdd  0.01949          osd.4                up   1.00000  1.00000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-5         0.03897      host testbed-node-1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1    hdd  0.01949          osd.1                up   1.00000  1.00000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 3    hdd  0.01949          osd.3                up   1.00000  1.00000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-7               0      host testbed-node-2</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Remove the node from the CRUSH map.</p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ceph osd crush remove testbed-node-2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">removed item id -7 name &#x27;testbed-node-2&#x27; from crush map</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Remove the node from all Ceph groups in the inventory.</p>
</li>
<li class="">
<p>Remove all Ceph-specific parameters from the host vars of the node from the
inventory</p>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="remove-an-osd-temporarily-eg-when-replacing-a-broken-disk">Remove an OSD (temporarily e.g. when replacing a broken disk)<a href="#remove-an-osd-temporarily-eg-when-replacing-a-broken-disk" class="hash-link" aria-label="Direct link to Remove an OSD (temporarily e.g. when replacing a broken disk)" title="Direct link to Remove an OSD (temporarily e.g. when replacing a broken disk)" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd out osd.&lt;ID&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl stop ceph-osd@&lt;ID&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl disable ceph-osd@&lt;ID&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="disable-backfillsrecovery-completely">Disable backfills/recovery completely<a href="#disable-backfillsrecovery-completely" class="hash-link" aria-label="Direct link to Disable backfills/recovery completely" title="Direct link to Disable backfills/recovery completely" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Use only in emergency situations!</p></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd set nobackfill</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd set norecovery</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd set norebalance</span><br></span></code></pre></div></div>
<p>Unset the flags with <code>ceph osd unset &lt;flag&gt;</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="rebalance-osds">Rebalance OSDs<a href="#rebalance-osds" class="hash-link" aria-label="Direct link to Rebalance OSDs" title="Direct link to Rebalance OSDs" translate="no">​</a></h3>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="placement-group-maintenance">Placement Group maintenance<a href="#placement-group-maintenance" class="hash-link" aria-label="Direct link to Placement Group maintenance" title="Direct link to Placement Group maintenance" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="dump-placement-groups">Dump placement groups<a href="#dump-placement-groups" class="hash-link" aria-label="Direct link to Dump placement groups" title="Direct link to Dump placement groups" translate="no">​</a></h3>
<p>Usually only useful when parsing it, so here are two ways to get the data:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph pg dump</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph pg dump --format=json-pretty</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="query-a-pg-about-its-status">Query a PG about its status<a href="#query-a-pg-about-its-status" class="hash-link" aria-label="Direct link to Query a PG about its status" title="Direct link to Query a PG about its status" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph pg &lt;pgid&gt; query</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="start-deep-scrubbing-of-a-placement-group">Start (deep-)scrubbing of a placement group<a href="#start-deep-scrubbing-of-a-placement-group" class="hash-link" aria-label="Direct link to Start (deep-)scrubbing of a placement group" title="Direct link to Start (deep-)scrubbing of a placement group" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph pg scrub &lt;pgid&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph pg deep-scrub &lt;pgid&gt;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Instructing a PG to (deep-)scrub does not mean that it will do so immediately,
it can take some time for the scrub to start.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="health_warn---large-omap-objects-found">HEALTH_WARN - Large omap objects found<a href="#health_warn---large-omap-objects-found" class="hash-link" aria-label="Direct link to HEALTH_WARN - Large omap objects found" title="Direct link to HEALTH_WARN - Large omap objects found" translate="no">​</a></h3>
<p>Finding PGs which have large OMAP objects:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph pg dump --format=json | jq &#x27;.pg_map.pg_stats[] |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select(.stat_sum.num_large_omap_objects != 0) |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(.pgid, .stat_sum.num_large_omap_objects, .up, .acting)&#x27;</span><br></span></code></pre></div></div>
<p>(Remove the line breaks between the single quotes or <code>jq</code> might act weird!)</p>
<p>This will dump all PG IDs with large OMAP objects and their up/acting OSDs.
You then can grep the logs of these OSDs for <strong>&quot;Large omap object&quot;</strong>
to find the actual objects causing the health warning.</p>
<p>Also the PG ID before the dot is equal to the pool ID it belongs to.</p>
<p>In case the logs have been rotated, instruct those OSDs to do a deep-scrub
and watch the logs for the message to appear.</p>
<p>From there you can investigate the issue further,
mostly it&#x27;ll be due to the index of a RGW bucket getting too big due to too many objects,
thus resharding that bucket&#x27;s index will be necessary.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="instruct-a-pg-to-repair-in-case-of-scrub-errors-inconsistent-pg">Instruct a PG to repair in case of scrub errors (inconsistent PG)<a href="#instruct-a-pg-to-repair-in-case-of-scrub-errors-inconsistent-pg" class="hash-link" aria-label="Direct link to Instruct a PG to repair in case of scrub errors (inconsistent PG)" title="Direct link to Instruct a PG to repair in case of scrub errors (inconsistent PG)" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph pg repair &lt;pgid&gt;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Recovery might not start immediately and might take some time.
You can query the status of the recovery through <code>ceph pg &lt;pgid&gt; query</code>.
Be sure to read the Ceph manual about this topic <em>thoroughly</em>:</p><p><a href="https://docs.ceph.com/en/latest/rados/troubleshooting/troubleshooting-pg/" target="_blank" rel="noopener noreferrer" class="">https://docs.ceph.com/en/latest/rados/troubleshooting/troubleshooting-pg/</a></p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="rados-pool-maintenance">RADOS Pool maintenance<a href="#rados-pool-maintenance" class="hash-link" aria-label="Direct link to RADOS Pool maintenance" title="Direct link to RADOS Pool maintenance" translate="no">​</a></h2>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Read the RADOS pool operations documentation in detail before playing around with pools.
Especially when considering making changes to the CRUSH map.
Wrong decisions there can lead to data loss or other catastrophic failures.</p><p><a href="https://docs.ceph.com/en/latest/rados/operations/pools/" target="_blank" rel="noopener noreferrer" class="">https://docs.ceph.com/en/latest/rados/operations/pools/</a></p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="get-pools-and-their-configuration">Get pools and their configuration<a href="#get-pools-and-their-configuration" class="hash-link" aria-label="Direct link to Get pools and their configuration" title="Direct link to Get pools and their configuration" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd pool ls detail</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="dump-all-crush-rules">Dump all CRUSH rules<a href="#dump-all-crush-rules" class="hash-link" aria-label="Direct link to Dump all CRUSH rules" title="Direct link to Dump all CRUSH rules" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd crush rule dump</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="get-autoscaler-status">Get autoscaler status<a href="#get-autoscaler-status" class="hash-link" aria-label="Direct link to Get autoscaler status" title="Direct link to Get autoscaler status" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd pool autoscale-status</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="create-a-replicated-pool">Create a replicated pool<a href="#create-a-replicated-pool" class="hash-link" aria-label="Direct link to Create a replicated pool" title="Direct link to Create a replicated pool" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd pool create &lt;pool_name&gt; &lt;pg_num&gt; &lt;pgp_num&gt; replicated [&lt;crush_rule_name&gt;]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="enabling-an-application-on-a-pool">Enabling an application on a pool<a href="#enabling-an-application-on-a-pool" class="hash-link" aria-label="Direct link to Enabling an application on a pool" title="Direct link to Enabling an application on a pool" translate="no">​</a></h3>
<p>Required, otherwise a health warning will be raised after some time.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd pool application enable &lt;pool_name&gt; &lt;application_name&gt; # Syntax</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd pool application enable cinder rbd # Example</span><br></span></code></pre></div></div>
<p>Typical application names are: rbd, rgw, cephfs</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="delete-a-pool">Delete a pool<a href="#delete-a-pool" class="hash-link" aria-label="Direct link to Delete a pool" title="Direct link to Delete a pool" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>This will delete all data in that pool. There is no undo/restore.</p></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd pool delete &lt;pool_name&gt; &lt;pool_name&gt; --yes-i-really-really-mean-it</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>In order to be able to delete pools, it has to be enabled on the monitors
by setting the <code>mon_allow_pool_delete</code> flag to true. Default is false.</p><p>See: <a href="https://docs.ceph.com/en/latest/rados/configuration/mon-config-ref" target="_blank" rel="noopener noreferrer" class="">https://docs.ceph.com/en/latest/rados/configuration/mon-config-ref</a></p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="set-number-of-pgs-for-a-pool">Set number of PGs for a pool<a href="#set-number-of-pgs-for-a-pool" class="hash-link" aria-label="Direct link to Set number of PGs for a pool" title="Direct link to Set number of PGs for a pool" translate="no">​</a></h3>
<p>If no autoscaling of PGs is used, it is very important to adapt the PGs per pool to the
real world when operating a Ceph cluster. If, for example, OSDs are exchanged, added, new
nodes are added, etc., the number of PGs must also be taken into account.</p>
<p>The <a href="https://docs.ceph.com/en/latest/rados/operations/pgcalc/" target="_blank" rel="noopener noreferrer" class="">PG Calc Tool</a> can be used
to calculate a reasonable number of PGs per pool depending on all ODSs and pools.</p>
<p>Further information on placement groups can be found in the
<a href="https://docs.ceph.com/en/latest/rados/operations/placement-groups/" target="_blank" rel="noopener noreferrer" class="">Ceph documentation</a>.
You should definitely read <em>FACTORS RELEVANT TO SPECIFYING PG_NUM</em> and <em>CHOOSING THE NUMBER OF PGS</em>
there.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd pool set &lt;poolname&gt; pg_num &lt;num_pgs&gt;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Num PGs must be a power of two! Be careful about changing number of PGs.
Changing pg_num to a new value will gradually increase pgp_num on newer versions of Ceph.</p><p>In older versions one also has to set pgp_num manually, either in increments or in one big leap.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="create-crush-rules-for-different-storage-classes">Create CRUSH rules for different storage classes<a href="#create-crush-rules-for-different-storage-classes" class="hash-link" aria-label="Direct link to Create CRUSH rules for different storage classes" title="Direct link to Create CRUSH rules for different storage classes" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd crush rule create-replicated replicated_hdd default host hdd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd crush rule create-replicated replicated_ssd default host ssd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd crush rule create-replicated replicated_nvme default host nvme</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="change-crush-rule-for-a-pool-move-pool">Change CRUSH rule for a pool (&quot;move pool&quot;)<a href="#change-crush-rule-for-a-pool-move-pool" class="hash-link" aria-label="Direct link to Change CRUSH rule for a pool (&quot;move pool&quot;)" title="Direct link to Change CRUSH rule for a pool (&quot;move pool&quot;)" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd pool set &lt;poolname&gt; crush_rule &lt;rule_name&gt;</span><br></span></code></pre></div></div>
<p>This can be used to move a pool from e.g. HDD to SSD or NVME class
or anything else that the new CRUSH rule specifies.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="advanced-topics">Advanced topics<a href="#advanced-topics" class="hash-link" aria-label="Direct link to Advanced topics" title="Direct link to Advanced topics" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="validating-ceph-using-osism-playbooks">Validating Ceph using OSISM playbooks<a href="#validating-ceph-using-osism-playbooks" class="hash-link" aria-label="Direct link to Validating Ceph using OSISM playbooks" title="Direct link to Validating Ceph using OSISM playbooks" translate="no">​</a></h3>
<p>For Ceph, special playbooks were added to validate the deployment status of
the OSD, MON and MGR services. The commands for use are <code>osism validate ceph-osds</code>,
<code>osism validate ceph-mons</code>, and <code>osism validate ceph-mgrs</code>.</p>
<p>These playbooks will validate that the deployed Ceph environment matches
the configuration and is overall in a healthy state. The playbooks will
generate report files in JSON format on the first manager node in <code>/opt/reports/validator</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="shutdown-a-ceph-cluster">Shutdown a Ceph cluster<a href="#shutdown-a-ceph-cluster" class="hash-link" aria-label="Direct link to Shutdown a Ceph cluster" title="Direct link to Shutdown a Ceph cluster" translate="no">​</a></h3>
<p>In order to fully shutdown a Ceph cluster safely, you first do the following steps:</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Take GOOD NOTES of the unit names and OSD IDs running on each node.
You will need them to restart the cluster later.</p></div></div>
<ol>
<li class="">
<p>Stop the workload that is using the cluster</p>
<p>This will vary depending on your environment and is not covered here.</p>
</li>
<li class="">
<p>Pause/Stop operations on the cluster by setting flags</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd set noout</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd set nobackfill</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd set norecover</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd set norebalance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd set nodown</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd set pause</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Stop and disable the <code>radosgw</code> services on all nodes (on each rgw node) (if RGW is used)</p>
<p>Get the name of the unit (globs not supported for disable) and
make a note of the unit name for that node:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl | grep ceph-radosgw</span><br></span></code></pre></div></div>
<p>Then disable and stop the unit:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl disable --now ceph-radosgw@&lt;name&gt;.service</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Stop all CephFS file systems (if CephFS is used)</p>
<p>List all Ceph file systems</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph fs ls</span><br></span></code></pre></div></div>
<p>For each CephFS do:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph fs &lt;file system name&gt; down true</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>After that disable and stop all <code>ceph-mds</code> services on all nodes (do this on each node)</p>
<p>Get the name of the unit (globs not supported for disable) and
make a note of the unit name for that node:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl | grep ceph-mds</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl disable --now ceph-mds@&lt;unit&gt;.service</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Stop and disable the <code>ceph-mgr</code> services on all nodes (do this on each node)</p>
<p>Get the name of the unit (globs not supported for disable) and
make a note of the unit name for that node:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl | grep ceph-mgr</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl disable --now ceph-mgr@&lt;unit&gt;.service</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Stop and disable the <code>ceph-osd</code> services on all nodes (do this on each node)</p>
<p>Get the names of the units (globs not supported for disable) and
make a note of the unit names for that node (best to save it to a file):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl | grep ceph-osd</span><br></span></code></pre></div></div>
<p>For each OSD unit execute:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl disable ceph-osd@&lt;osd-id&gt;.service</span><br></span></code></pre></div></div>
<p>Stop all OSDs at once:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl stop ceph-osd\*.service</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Finally stop the <code>ceph-mon</code> services on all nodes (do this on each node)</p>
<p>Get the name of the unit (globs not supported for disable) and
make a note of the unit name for that node:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl | grep ceph-mon</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl disable --now ceph-mon@&lt;unit&gt;.service</span><br></span></code></pre></div></div>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="restart-a-ceph-cluster-after-manual-shutdown">Restart a Ceph cluster after manual shutdown<a href="#restart-a-ceph-cluster-after-manual-shutdown" class="hash-link" aria-label="Direct link to Restart a Ceph cluster after manual shutdown" title="Direct link to Restart a Ceph cluster after manual shutdown" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>You will need the notes taken during shutdown of the unit names.
It <strong>can</strong> be done without, but then it&#x27;ll be way more work finding out the names.</p></div></div>
<p>In order to restart a Ceph cluster after performing a manual shutdown like described
in the section above, you do the following:</p>
<ol>
<li class="">
<p>Enable &amp; start the <code>ceph-mon</code> services on all nodes (do this on each node)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl enable --now ceph-mon@&lt;unit-name&gt;.service</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Enable &amp; start the <code>ceph-osd</code> services on all nodes (do this on each node)</p>
<p>For each Ceph OSD on that node do:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl enable --now ceph-osd@&lt;osd-id&gt;.service</span><br></span></code></pre></div></div>
<p>Depending on the number of OSDs on that node it can take a while.</p>
</li>
<li class="">
<p>Enable &amp; start the <code>ceph-mgr</code> services on all nodes (do this on each node)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl enable --now ceph-mgr@&lt;unit-name&gt;.service</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Check the status of your cluster and wait for all OSDs to come online</p>
<p>You can watch the status periodically by running:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">watch ceph -s</span><br></span></code></pre></div></div>
<p>You should wait until all OSDs are up + in again, before removing flags.</p>
</li>
<li class="">
<p>Remove flags to unpause operations</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd unset pause</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd unset nodown</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd unset noout</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd unset nobackfill</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd unset norecover</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph osd unset norebalance</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Wait for cluster to resume operations</p>
<p>See step #4 of this SOP.
Now you wait until the cluster seems &quot;happy enough&quot; to accept clients.
(i.e. rebalancing finished etc.)
Maybe it will complain about MDS being down, but that&#x27;s normal for now.</p>
</li>
<li class="">
<p>Enable &amp; start the <code>ceph-mds</code> services on each node (if CephFS is used)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl enable --now ceph-mds@&lt;unit&gt;.service</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Start CephFS file systems again</p>
<p>List all Ceph file systems</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph fs ls</span><br></span></code></pre></div></div>
<p>For each CephFS do:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ceph fs &lt;file system name&gt; down false</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Enable &amp; start the <code>radosgw</code> services on each node (if RGW is used)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl enable --now ceph-radosgw@&lt;name&gt;.service</span><br></span></code></pre></div></div>
</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="performance-benchmark">Performance benchmark<a href="#performance-benchmark" class="hash-link" aria-label="Direct link to Performance benchmark" title="Direct link to Performance benchmark" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">apt-get install -y fio</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#!/usr/bin/env bash</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BENCH_DEVICE=&quot;$2&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DATE=$(date +%s)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">IOENGINE=&quot;libaio&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LOGPATH=&quot;$1&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SIZE=1G</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir -p $LOGPATH</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">for RW in &quot;write&quot; &quot;randwrite&quot; &quot;read&quot; &quot;randread&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">do</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  for BS in &quot;4K&quot; &quot;64K&quot; &quot;1M&quot; &quot;4M&quot; &quot;16M&quot; &quot;64M&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  do</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    echo &quot;==== $RW - $BS - DIRECT ====&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    echo 3 &gt; /proc/sys/vm/drop_caches</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    fio --rw=$RW --ioengine=${IOENGINE} --size=$SIZE --bs=$BS --direct=1 --runtime=60 --time_based --name=bench --filename=$BENCH_DEVICE --output=$LOGPATH/$RW.${BS}-direct-$(basename $BENCH_DEVICE).$DATE.log.json --output-format=json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sync</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    echo 3 &gt; /proc/sys/vm/drop_caches</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    echo &quot;==== $RW - $BS - DIRECT IODEPTH 32  ====&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    fio --rw=$RW --ioengine=${IOENGINE} --size=$SIZE --bs=$BS --iodepth=32 --direct=1 --runtime=60 --time_based --name=bench --filename=$BENCH_DEVICE --output=$LOGPATH/$RW.${BS}-direct-iod32-$(basename $BENCH_DEVICE).$DATE.log.json --output-format=json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sync</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ) | tee $LOGPATH/$RW.$BS-$(basename $BENCH_DEVICE).$DATE.log</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    echo</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  done</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">done</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="where-and-how-to-get-further-help">Where and how to get further help<a href="#where-and-how-to-get-further-help" class="hash-link" aria-label="Direct link to Where and how to get further help" title="Direct link to Where and how to get further help" translate="no">​</a></h2>
<p>Join the <strong>#ceph</strong> IRC channel on <strong>irc.oftc.net</strong>, state the problem with as many details as possible
including information about what steps have already been taken to solve the problem
also provide information from the command output from the &quot;60 seconds cluster overview&quot; above
through a pastebin or a similar service. In order for people to be able
to help, details and some patience are important.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/SovereignCloudStack/docs/tree/main/docs/02-iaas/guides/operations-guide/ceph/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/iaas/guides/operations-guide/baremetal/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Baremetal</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/iaas/guides/operations-guide/ceph/rook"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Operations for Rook</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#where-to-find-docs" class="table-of-contents__link toc-highlight">Where to find docs</a></li><li><a href="#advice-on-ceph-releases" class="table-of-contents__link toc-highlight">Advice on Ceph releases</a></li><li><a href="#general-maintenance" class="table-of-contents__link toc-highlight">General maintenance</a><ul><li><a href="#60-seconds-cluster-overview" class="table-of-contents__link toc-highlight">60 seconds cluster overview</a></li><li><a href="#muteunmute-a-health-warning" class="table-of-contents__link toc-highlight">Mute/Unmute a health warning</a></li><li><a href="#disableenable-deep-scrubbing" class="table-of-contents__link toc-highlight">Disable/Enable (deep-)scrubbing</a></li><li><a href="#reboot-a-single-node" class="table-of-contents__link toc-highlight">Reboot a single node</a></li></ul></li><li><a href="#gathering-information-about-block-devices" class="table-of-contents__link toc-highlight">Gathering information about block devices</a><ul><li><a href="#enumerate-typical-storage-devices-and-lvm" class="table-of-contents__link toc-highlight">Enumerate typical storage devices and LVM</a></li><li><a href="#smart-data-for-satasas-and-nvme-devices" class="table-of-contents__link toc-highlight">SMART data for SATA/SAS and NVME devices</a></li><li><a href="#check-format-of-a-nvme-device" class="table-of-contents__link toc-highlight">Check format of a NVME device</a></li><li><a href="#format-a-nvme-device-to-a-different-lba-format-using-nvme-cli" class="table-of-contents__link toc-highlight">Format a NVME device to a different LBA format using nvme-cli</a></li><li><a href="#secure-erase-a-nvme-drive-using-nvme-cli" class="table-of-contents__link toc-highlight">Secure Erase a NVME drive using nvme-cli</a></li><li><a href="#secure-erase-a-satasas-drive-using-hdparm" class="table-of-contents__link toc-highlight">Secure Erase a SATA/SAS drive using hdparm</a></li></ul></li><li><a href="#osd-maintenance-tasks" class="table-of-contents__link toc-highlight">OSD maintenance tasks</a><ul><li><a href="#locate-a-specific-osd-in-the-cluster" class="table-of-contents__link toc-highlight">Locate a specific OSD in the cluster</a></li><li><a href="#get-osd-metadata-global-and-single-osd" class="table-of-contents__link toc-highlight">Get OSD metadata (global and single OSD)</a></li><li><a href="#add-a-new-osd" class="table-of-contents__link toc-highlight">Add a new OSD</a></li><li><a href="#replace-a-defect-osd" class="table-of-contents__link toc-highlight">Replace a defect OSD</a></li><li><a href="#remove-a-osd" class="table-of-contents__link toc-highlight">Remove a OSD</a></li><li><a href="#remove-a-single-osd-node" class="table-of-contents__link toc-highlight">Remove a single OSD node</a></li><li><a href="#remove-an-osd-temporarily-eg-when-replacing-a-broken-disk" class="table-of-contents__link toc-highlight">Remove an OSD (temporarily e.g. when replacing a broken disk)</a></li><li><a href="#disable-backfillsrecovery-completely" class="table-of-contents__link toc-highlight">Disable backfills/recovery completely</a></li><li><a href="#rebalance-osds" class="table-of-contents__link toc-highlight">Rebalance OSDs</a></li></ul></li><li><a href="#placement-group-maintenance" class="table-of-contents__link toc-highlight">Placement Group maintenance</a><ul><li><a href="#dump-placement-groups" class="table-of-contents__link toc-highlight">Dump placement groups</a></li><li><a href="#query-a-pg-about-its-status" class="table-of-contents__link toc-highlight">Query a PG about its status</a></li><li><a href="#start-deep-scrubbing-of-a-placement-group" class="table-of-contents__link toc-highlight">Start (deep-)scrubbing of a placement group</a></li><li><a href="#health_warn---large-omap-objects-found" class="table-of-contents__link toc-highlight">HEALTH_WARN - Large omap objects found</a></li><li><a href="#instruct-a-pg-to-repair-in-case-of-scrub-errors-inconsistent-pg" class="table-of-contents__link toc-highlight">Instruct a PG to repair in case of scrub errors (inconsistent PG)</a></li></ul></li><li><a href="#rados-pool-maintenance" class="table-of-contents__link toc-highlight">RADOS Pool maintenance</a><ul><li><a href="#get-pools-and-their-configuration" class="table-of-contents__link toc-highlight">Get pools and their configuration</a></li><li><a href="#dump-all-crush-rules" class="table-of-contents__link toc-highlight">Dump all CRUSH rules</a></li><li><a href="#get-autoscaler-status" class="table-of-contents__link toc-highlight">Get autoscaler status</a></li><li><a href="#create-a-replicated-pool" class="table-of-contents__link toc-highlight">Create a replicated pool</a></li><li><a href="#enabling-an-application-on-a-pool" class="table-of-contents__link toc-highlight">Enabling an application on a pool</a></li><li><a href="#delete-a-pool" class="table-of-contents__link toc-highlight">Delete a pool</a></li><li><a href="#set-number-of-pgs-for-a-pool" class="table-of-contents__link toc-highlight">Set number of PGs for a pool</a></li><li><a href="#create-crush-rules-for-different-storage-classes" class="table-of-contents__link toc-highlight">Create CRUSH rules for different storage classes</a></li><li><a href="#change-crush-rule-for-a-pool-move-pool" class="table-of-contents__link toc-highlight">Change CRUSH rule for a pool (&quot;move pool&quot;)</a></li></ul></li><li><a href="#advanced-topics" class="table-of-contents__link toc-highlight">Advanced topics</a><ul><li><a href="#validating-ceph-using-osism-playbooks" class="table-of-contents__link toc-highlight">Validating Ceph using OSISM playbooks</a></li><li><a href="#shutdown-a-ceph-cluster" class="table-of-contents__link toc-highlight">Shutdown a Ceph cluster</a></li><li><a href="#restart-a-ceph-cluster-after-manual-shutdown" class="table-of-contents__link toc-highlight">Restart a Ceph cluster after manual shutdown</a></li></ul></li><li><a href="#performance-benchmark" class="table-of-contents__link toc-highlight">Performance benchmark</a></li><li><a href="#where-and-how-to-get-further-help" class="table-of-contents__link toc-highlight">Where and how to get further help</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Contribute</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://matrix.to/#/!TiDqlLmEUaXqTemaLc:matrix.org?via=matrix.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Matrix<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://fosstodon.org/@sovereigncloudstack" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mastodon<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/SovereignCloudStack/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Sovereign Cloud Stack, SCS and the logo are registered trademarks of the Open Source Business Alliance e.V. — Other trademarks are property of their respective owners.</div></div></div></footer></div>
</body>
</html>