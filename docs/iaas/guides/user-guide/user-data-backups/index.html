<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-iaas/guides/user-guide/user-data-backups" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">User Data Backups | One platform — standardized, built and operated by many.</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.scs.community/img/scs-og-basic.png"><meta data-rh="true" name="twitter:image" content="https://docs.scs.community/img/scs-og-basic.png"><meta data-rh="true" property="og:url" content="https://docs.scs.community/docs/iaas/guides/user-guide/user-data-backups"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="User Data Backups | One platform — standardized, built and operated by many."><meta data-rh="true" name="description" content="This guide will explain common procedures for creating and restoring backups of user data accumulated in cloud resources such as volumes, images or ephemeral server disks."><meta data-rh="true" property="og:description" content="This guide will explain common procedures for creating and restoring backups of user data accumulated in cloud resources such as volumes, images or ephemeral server disks."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://docs.scs.community/docs/iaas/guides/user-guide/user-data-backups"><link data-rh="true" rel="alternate" href="https://docs.scs.community/docs/iaas/guides/user-guide/user-data-backups" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.scs.community/docs/iaas/guides/user-guide/user-data-backups" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"IaaS Layer","item":"https://docs.scs.community/docs/category/iaas-layer"},{"@type":"ListItem","position":2,"name":"User Guide","item":"https://docs.scs.community/docs/iaas/guides/user-guide/"},{"@type":"ListItem","position":3,"name":"User Data Backups","item":"https://docs.scs.community/docs/iaas/guides/user-guide/user-data-backups"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="SCS Community Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="SCS Community Blog Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="SCS Community Blog JSON Feed">









<link rel="preconnect" href="https://matomo.scs.community/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setDocumentTitle",document.domain+"/"+document.title]),_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var e="https://matomo.scs.community/";_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","2"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script><link rel="stylesheet" href="/assets/css/styles.7136250c.css">
<script src="/assets/js/runtime~main.ff722ccb.js" defer="defer"></script>
<script src="/assets/js/main.6cc1e574.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="SCS" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="SCS" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/standards">Standards</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">For Operators</a><a class="navbar__item navbar__link" href="/contributor-docs">For Contributors</a><a class="navbar__item navbar__link" href="/user-docs">For Users</a><a class="navbar__item navbar__link" href="/community">Community</a><a class="navbar__item navbar__link" href="/docs/faq">FAQ</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/SovereignCloudStack/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/docs/category/iaas-layer"><span title="IaaS Layer" class="categoryLinkLabel_W154">IaaS Layer</span></a><button aria-label="Collapse sidebar category &#x27;IaaS Layer&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/iaas/guides/concept-guide/"><span title="Guides" class="categoryLinkLabel_W154">Guides</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/concept-guide/"><span title="Concept Guide" class="categoryLinkLabel_W154">Concept Guide</span></a><button aria-label="Expand sidebar category &#x27;Concept Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/deploy-guide/"><span title="Deploy Guide" class="categoryLinkLabel_W154">Deploy Guide</span></a><button aria-label="Expand sidebar category &#x27;Deploy Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/upgrade-guide/"><span title="Upgrade Guide" class="categoryLinkLabel_W154">Upgrade Guide</span></a><button aria-label="Expand sidebar category &#x27;Upgrade Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/configuration-guide/"><span title="Configuration Guide" class="categoryLinkLabel_W154">Configuration Guide</span></a><button aria-label="Expand sidebar category &#x27;Configuration Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/operations-guide/"><span title="Operations Guide" class="categoryLinkLabel_W154">Operations Guide</span></a><button aria-label="Expand sidebar category &#x27;Operations Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/troubleshooting-guide/"><span title="Troubleshooting Guide" class="categoryLinkLabel_W154">Troubleshooting Guide</span></a><button aria-label="Expand sidebar category &#x27;Troubleshooting Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iaas/guides/"><span title="Guides" class="linkLabel_WmDU">Guides</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/iaas/guides/user-guide/"><span title="User Guide" class="categoryLinkLabel_W154">User Guide</span></a><button aria-label="Collapse sidebar category &#x27;User Guide&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/user-guide/openstack/"><span title="OpenStack" class="categoryLinkLabel_W154">OpenStack</span></a><button aria-label="Expand sidebar category &#x27;OpenStack&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/iaas/guides/user-guide/security-groups/"><span title="Best Practise: How to configure and use security groups" class="linkLabel_WmDU">Best Practise: How to configure and use security groups</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/iaas/guides/user-guide/user-data-backups"><span title="User Data Backups" class="linkLabel_WmDU">User Data Backups</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/developer-guide/"><span title="Developer Guide" class="categoryLinkLabel_W154">Developer Guide</span></a><button aria-label="Expand sidebar category &#x27;Developer Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/iaas/guides/migration-guide/"><span title="Migration Guide" class="categoryLinkLabel_W154">Migration Guide</span></a><button aria-label="Expand sidebar category &#x27;Migration Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/category/components"><span title="Components" class="categoryLinkLabel_W154">Components</span></a><button aria-label="Expand sidebar category &#x27;Components&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/category/deployment-examples"><span title="Deployment Examples" class="categoryLinkLabel_W154">Deployment Examples</span></a><button aria-label="Expand sidebar category &#x27;Deployment Examples&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/container/"><span title="Container Layer" class="categoryLinkLabel_W154">Container Layer</span></a><button aria-label="Expand sidebar category &#x27;Container Layer&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/category/operating-scs"><span title="Operating SCS" class="categoryLinkLabel_W154">Operating SCS</span></a><button aria-label="Expand sidebar category &#x27;Operating SCS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/iam/"><span title="Identity and Access Management (IAM)" class="categoryLinkLabel_W154">Identity and Access Management (IAM)</span></a><button aria-label="Expand sidebar category &#x27;Identity and Access Management (IAM)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/category/turnkey-solution"><span title="Turnkey Solution" class="categoryLinkLabel_W154">Turnkey Solution</span></a><button aria-label="Expand sidebar category &#x27;Turnkey Solution&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/category/releases"><span title="Releases" class="categoryLinkLabel_W154">Releases</span></a><button aria-label="Expand sidebar category &#x27;Releases&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq/"><span title="FAQ" class="linkLabel_WmDU">FAQ</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/glossary"><span title="Glossary" class="linkLabel_WmDU">Glossary</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/iaas-layer"><span>IaaS Layer</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/iaas/guides/user-guide/"><span>User Guide</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">User Data Backups</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>User Data Backups</h1></header>
<p>This guide will explain common procedures for creating and restoring backups of user data accumulated in cloud resources such as volumes, images or ephemeral server disks.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="glossary">Glossary<a href="#glossary" class="hash-link" aria-label="Direct link to Glossary" title="Direct link to Glossary" translate="no">​</a></h2>
<table><thead><tr><th>Term</th><th>Explanation</th></tr></thead><tbody><tr><td>Virtual Machine</td><td>Equals the <code>server</code> resource in Nova.</td></tr><tr><td>Ephemeral Storage</td><td>Disk storage directly supplied to a virtual machine by Nova. Different from volumes.</td></tr><tr><td>(Glance) Image</td><td>IaaS resource usually storing raw disk data. Managed by the Glance service.</td></tr><tr><td>(Cinder) Volume</td><td>IaaS resource representing block storage disk that can be attached as a virtual disk to virtual machines. Managed by the Cinder service.</td></tr><tr><td>(Volume) Snapshot</td><td>Thinly-provisioned copy-on-write snapshots of volumes. Stored in the same Cinder storage backend as volumes.</td></tr><tr><td>Volume Type</td><td>Attribute of volumes determining storage details of a volume such as backend location or whether the volume will be encrypted.</td></tr><tr><td>(Barbican) Secret</td><td>IaaS resource storing cryptographic assets such as encryption keys. Managed by the Barbican service.</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="scope">Scope<a href="#scope" class="hash-link" aria-label="Direct link to Scope" title="Direct link to Scope" translate="no">​</a></h2>
<p>User data in the context of this guide describes data accumulated in cloud resources of a user at runtime.
This concerns primarily storage data of virtual machines stored at at-rest.
This does not cover in-transit or in-use data such as network traffic, virtual machines&#x27; RAM contents or IaaS configuration and metadata of cloud resources.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview-of-applicable-user-data">Overview of applicable User Data<a href="#overview-of-applicable-user-data" class="hash-link" aria-label="Direct link to Overview of applicable User Data" title="Direct link to Overview of applicable User Data" translate="no">​</a></h3>
<p>Given the mentioned scope, the following can be classified as user data:</p>
<ul>
<li class="">images stored in Glance</li>
<li class="">virtual machine disks, either:<!-- -->
<ul>
<li class="">Ephemeral Storage stored in Nova</li>
<li class="">volumes stored in Cinder</li>
</ul>
</li>
<li class="">encryption keys stored as secrets in Barbican</li>
</ul>
<p>The following sections will describe backup procedures for each of those resources individually.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="image-backup-using-download">Image backup using download<a href="#image-backup-using-download" class="hash-link" aria-label="Direct link to Image backup using download" title="Direct link to Image backup using download" translate="no">​</a></h2>
<p>Glance images may act as backup targets for other resources (such as volumes) but don&#x27;t have a dedicated backup service for themselves.</p>
<p>When an image is to be backed up, it can be downloaded from the Glance image service and stored outside of the IaaS infrastructure for backup purposes.
In this case it is the user&#x27;s responsibility to establish the backup procedure and appropriate target storage.</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>When creating images from volumes with a volume type that uses encryption, the resulting image will contain the raw LUKS-encrypted blocks of the volume.
When transferred outside of the IaaS infrastructure, this data is only useful as a backup together with the corresponding encryption key.</p><p>Such images can be identified by an attribute called <code>cinder_encryption_key_id</code> in the <code>properties</code> metadata field of the image.
It only exists for encrypted images and references the encryption key in Barbican.
Refer to the <a href="#barbican-secrets-backup-using-download" class="">Barbican secrets section</a> for instructions on how to backup the key.</p></div></div>
<p>The API or the OpenStack client may be used to initiate the download, for example:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack image save --file $TARGET_FILE_PATH $IMAGE_NAME_OR_ID</span><br></span></code></pre></div></div>
<p>This or the underlying API request may be automated as part of a regular backup schedule involving the backup storage target on the user side.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="ephemeral-storage-backup-using-glance-images">Ephemeral Storage backup using Glance images<a href="#ephemeral-storage-backup-using-glance-images" class="hash-link" aria-label="Direct link to Ephemeral Storage backup using Glance images" title="Direct link to Ephemeral Storage backup using Glance images" translate="no">​</a></h2>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>When using the <code>createImage</code> Compute API action (e.g. via the <code>openstack server image create</code> command) on a virtual machine that has volumes attached to it in addition to its Ephemeral Storage disk, the volumes will not be backed up into the image. Instead, a snapshot will be created for each attached volume and referenced in the image metadata. This does not replace genuine volume backups.</p><p>See the <a href="#image-creation-action-for-servers-with-attached-volumes" class="">corresponding appendix section</a> for further details.</p></div></div>
<p>Ephemeral Storage disks of virtual machines can be backed up to Glance images easily by using the <code>createImage</code> Compute API action or the corresponding OpenStack client command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack server image create --name $IMAGE_NAME $SERVER_NAME_OR_ID</span><br></span></code></pre></div></div>
<p>This will create a Glance image containing a one-to-one copy of the data on the Ephemeral Storage disk at the time of execution.</p>
<p>If the necessity arises to store this backup outside of the IaaS infrastructure, the download procedure as described in <a href="#image-backup-using-download" class="">Image backup using download</a> may be used after the image creation.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="volume-data-backup-using-cinder-backup-api">Volume data backup using Cinder Backup API<a href="#volume-data-backup-using-cinder-backup-api" class="hash-link" aria-label="Direct link to Volume data backup using Cinder Backup API" title="Direct link to Volume data backup using Cinder Backup API" translate="no">​</a></h2>
<p>The following instructions only apply if the infrastructure offers the Cinder Backup API.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Backups of volumes using a volume type that uses encryption will retain their encryption and a clone of the original encryption key is created in Barbican linked to the backup.
These backups can only be restored when the Barbican service is available and still has the corresponding copy of the encryption key.</p><p>Also, it is advised to take note of the exact volume type when creating a backup of an encrypted volume, because this information will be needed to restore the backup.
See <a href="#restoring-an-encrypted-volume-backup-cinder-backup" class="">restoring an encrypted volume backup</a>.</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>It might be difficult or even impossible for a user to transfer backups created by the Cinder Backup API outside of the IaaS infrastructure, depending on the backup backend.
A more easily accessible backup of volumes can be created by using Glance images.
See the <a href="#volume-data-backup-using-glance-images" class="">section about volume data backup using Glance images</a> for details.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="backup-of-detached-volumes">Backup of detached volumes<a href="#backup-of-detached-volumes" class="hash-link" aria-label="Direct link to Backup of detached volumes" title="Direct link to Backup of detached volumes" translate="no">​</a></h3>
<p>Backups can be created using the Cinder Backup API or the corresponding OpenStack client commands:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack volume backup create $VOLUME_NAME_OR_ID</span><br></span></code></pre></div></div>
<p>Further backups of the same volume can subsequently be created as incremental backups using the following command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack volume backup create --incremental $VOLUME_NAME_OR_ID</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="backup-of-attached-volumes">Backup of attached volumes<a href="#backup-of-attached-volumes" class="hash-link" aria-label="Direct link to Backup of attached volumes" title="Direct link to Backup of attached volumes" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>When creating backups of attached (in-use) volumes, the state of the full volume is captured at runtime. Backups created this way will be crash-consistent but not app-consistent.</p></div></div>
<p>In case of attached (in-use) volumes, backups can only be created while also specfiying the <code>force</code> parameter:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack volume backup create --force $VOLUME_NAME_OR_ID</span><br></span></code></pre></div></div>
<p>Further backups of the same volume can subsequently be created as incremental backups using the following command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack volume backup create --force --incremental $VOLUME_NAME_OR_ID</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="volume-data-backup-using-glance-images">Volume data backup using Glance images<a href="#volume-data-backup-using-glance-images" class="hash-link" aria-label="Direct link to Volume data backup using Glance images" title="Direct link to Volume data backup using Glance images" translate="no">​</a></h2>
<p>In case the Cinder Backup storage is not available in the IaaS infrastructure, Glance images can be used as a backup target instead.
Such images may also subsequently be downloaded to transfer the backup outside of the IaaS infrastructure.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Glance image backups of Cinder volumes only allow full backup copies and do not offer incremental or differential backup mechanisms.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="glance-image-backups-of-detached-volumes">Glance image backups of detached volumes<a href="#glance-image-backups-of-detached-volumes" class="hash-link" aria-label="Direct link to Glance image backups of detached volumes" title="Direct link to Glance image backups of detached volumes" translate="no">​</a></h3>
<p>Volumes not attached to virtual machines can be directly copied into an image.
Such volumes can be identified by their status being <code>available</code>.
To backup a detached volume to a Glance image, directly use the corresponding image creation action:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack image create --volume $VOLUME_NAME_OR_ID $IMAGE_NAME</span><br></span></code></pre></div></div>
<p>After the image creation has finished, a full backup copy of the volume will reside in the Glance storage backend.</p>
<p>If the necessity arises to store this backup outside of the IaaS infrastructure, the download procedure as described in <a href="#image-backup-using-download" class="">Image backup using download</a> may be used after the image creation.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="glance-image-backups-of-attached-in-use-volumes">Glance image backups of attached (in-use) volumes<a href="#glance-image-backups-of-attached-in-use-volumes" class="hash-link" aria-label="Direct link to Glance image backups of attached (in-use) volumes" title="Direct link to Glance image backups of attached (in-use) volumes" translate="no">​</a></h3>
<p>Cinder is unable to directly create Glance images from volumes which are attached to virtual machines.
To create backups of such volumes regardless, a detour using volume snapshots can be used which will be described below.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>When creating snapshots of attached (in-use) volumes, the <code>force</code> parameter has to be used. These snapshots capture a state of the full volume at runtime. They will be crash-consistent but not app-consistent.</p></div></div>
<ol>
<li class="">Create a snapshot of the target volume while including the <code>force</code> parameter in the request:<!-- -->
<ul>
<li class=""><code>openstack volume snapshot create --volume $VOLUME_NAME_OR_ID $SNAPSHOT_NAME</code></li>
</ul>
</li>
<li class="">Create a new temporary volume based on the snapshot to act as backup source:<!-- -->
<ul>
<li class=""><code>openstack volume create --snapshot $SNAPSHOT_NAME $TEMP_VOLUME_NAME</code></li>
</ul>
</li>
<li class="">Wait until the volume creation is finished and the temporary volume reaches the <code>available</code> status.</li>
<li class="">Create a backup image of the temporary volume:<!-- -->
<ul>
<li class=""><code>openstack image create --volume $TEMP_VOLUME_NAME $IMAGE_NAME</code></li>
</ul>
</li>
<li class="">Wait until the image creation finishes and the target image reaches the <code>active</code> status.</li>
<li class="">Delete the temporary volume and snapshot:<!-- -->
<ul>
<li class=""><code>openstack volume delete $TEMP_VOLUME_NAME</code></li>
<li class=""><code>openstack volume snapshot delete $SNAPSHOT_NAME</code></li>
</ul>
</li>
</ol>
<p>A full backup copy of the volume now resides in the Glance storage backend.</p>
<p>If the necessity arises to store this backup outside of the IaaS infrastructure, the download procedure as described in <a href="#image-backup-using-download" class="">Image backup using download</a> may be used after the image creation.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="barbican-secrets-backup-using-download">Barbican secrets backup using download<a href="#barbican-secrets-backup-using-download" class="hash-link" aria-label="Direct link to Barbican secrets backup using download" title="Direct link to Barbican secrets backup using download" translate="no">​</a></h2>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p>Secrets downloaded from Barbican will be in plaintext, which means that the secret is unprotected once received from the API.
Before downloading secrets from Barbican make sure that a secure target environment is established for receiving and securely storing the secret&#x27;s contents.</p></div></div>
<p>Barbican secrets can be downloaded in plaintext using the corresponding API or client command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack secret get --file $TARGET_FILE_PATH --payload_content_type &quot;application/octet-stream&quot; $SECRET_ID</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>In case the secret needs to be restored into an OpenStack Barbican later on, it is recommended to also note down the following attributes shown by <code>openstack secret get $SECRET_ID</code>:</p><ul>
<li class="">Algorithm</li>
<li class="">Bit length</li>
<li class="">Secret type</li>
<li class="">Mode</li>
</ul></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="retrieving-encryption-keys-from-barbican">Retrieving encryption keys from Barbican<a href="#retrieving-encryption-keys-from-barbican" class="hash-link" aria-label="Direct link to Retrieving encryption keys from Barbican" title="Direct link to Retrieving encryption keys from Barbican" translate="no">​</a></h3>
<p>In case of encrypted volumes (i.e. using a volume type with encryption), a corresponding encryption key is stored in Barbican.
When an image is created from such a volume, the encryption key is duplicated in Barbican for the image.
In order to backup those keys, the corresponding secret must first be identified.</p>
<p>For volumes, this is possible starting with the Volume API microversion 3.64:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack volume show --os-volume-api-version 3.64 $VOLUME_NAME_OR_ID</span><br></span></code></pre></div></div>
<p>The response will contain an <code>encryption_key_id</code> field with the ID of the Barbican secret.</p>
<p>For images, the secret reference is stored in the <code>properties</code> field instead:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack image show -f value -c properties $IMAGE_NAME_OR_ID</span><br></span></code></pre></div></div>
<p>In case of images created from encrypted volumes, the resulting output will have a nested <code>cinder_encryption_key_id</code> field that contains the ID of the Barbican secret.</p>
<p>The resulting IDs can be used to retrieve the corresponding key using the <a href="#barbican-secrets-backup-using-download" class="">Barbican instructions</a> above.</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>Note that the key retrieved from the secret is not immediately usable as LUKS passphrase to the image data of the volume.
OpenStack does some processing to the key before it is passed to the LUKS encryption, which must be mimicked accordingly in order to unlock the encryption outside of OpenStack!</p><p>See the <a href="#luks-encryption-key-conversion-to-decrypt-volume-images" class="">example procedure for converting the LUKS key</a> in the appendix section.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="restore">Restore<a href="#restore" class="hash-link" aria-label="Direct link to Restore" title="Direct link to Restore" translate="no">​</a></h2>
<p>The following sections will illustrate how to restore the individual resource backups that have been documented above.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="restoring-a-backup-of-a-barbican-secret">Restoring a backup of a Barbican secret<a href="#restoring-a-backup-of-a-barbican-secret" class="hash-link" aria-label="Direct link to Restoring a backup of a Barbican secret" title="Direct link to Restoring a backup of a Barbican secret" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Note that restoring a Barbican secret by re-uploading it via the Barbican API will lead to the secret receiving a new ID.
Existing resources referencing an old secret ID cannot make use of the restored copy.</p></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack secret store --algorithm aes --bit-length 256 --mode cbc \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --secret-type symmetric --file $KEY_FILE_PATH --name $SECRET_NAME</span><br></span></code></pre></div></div>
<p>Notes:</p>
<ul>
<li class="">Attributes like algorithm, bit length, mode and secret type are not verified by Barbican. Their main purpose is to classify the secret on a metadata level. Make sure to align the attributes with the original secret.</li>
<li class=""><code>$KEY_FILE_PATH</code> is the local file path of the secret backup as created originally using the <a href="#barbican-secrets-backup-using-download" class="">instructions above</a>.</li>
<li class=""><code>$SECRET_NAME</code> is entirely optional but helps identifying the restored secret later on and to distinguish it from secrets created by OpenStack itself. It is best to not put whitespace characters in the name, otherwise it has to be surrounded by quotes.</li>
</ul>
<p>The successful registration of the restored secret can subsequently be verified using:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack secret list --name $SECRET_NAME</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="restoring-a-backup-of-an-unencrypted-image">Restoring a backup of an unencrypted image<a href="#restoring-a-backup-of-an-unencrypted-image" class="hash-link" aria-label="Direct link to Restoring a backup of an unencrypted image" title="Direct link to Restoring a backup of an unencrypted image" translate="no">​</a></h3>
<p>Unencrypted image backups can simply be restored using the regular image upload functionality and specifying the backup file:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack image create --file $IMAGE_FILE_PATH $IMAGE_NAME</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>In case the original image backup was not based on a volume originally, the image may have had a non-default disk or container format.
In this case, add the command parameters <code>--container-format</code> and <code>--disk-format</code> to the command accordingly.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="restoring-a-backup-of-an-encrypted-image">Restoring a backup of an encrypted image<a href="#restoring-a-backup-of-an-encrypted-image" class="hash-link" aria-label="Direct link to Restoring a backup of an encrypted image" title="Direct link to Restoring a backup of an encrypted image" translate="no">​</a></h3>
<p>The following section only applies to image backups that were originally created from images of encrypted volumes.</p>
<p>First, restore the corresponding secret of the image using the <a href="#restoring-a-backup-of-a-barbican-secret" class="">instructions above</a>.
The restored secret will receive a new ID in the form of a <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier" target="_blank" rel="noopener noreferrer" class="">UUID</a>.
Note down the ID of the restored secret and insert it in place of <code>$SECRET_ID</code> in the command below.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack image create --file $IMAGE_FILE_PATH \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --property cinder_encryption_key_id=$SECRET_ID \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --property cinder_encryption_key_deletion_policy=on_image_deletion \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $IMAGE_NAME</span><br></span></code></pre></div></div>
<p>The <code>cinder_encryption_key_deletion_policy</code> attribute is optional.
If not specified, the referenced secret will not be deleted on image deletion automatically.
In contrast, if set to <code>on_image_deletion</code>, the referenced secret will be deleted as soon as the image referencing it is deleted.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="restoring-a-volume-backup-from-an-image">Restoring a volume backup from an image<a href="#restoring-a-volume-backup-from-an-image" class="hash-link" aria-label="Direct link to Restoring a volume backup from an image" title="Direct link to Restoring a volume backup from an image" translate="no">​</a></h3>
<p>To restore a volume from an image backup, simply use the volume creation action and specify the image as source.</p>
<p>Depending on whether the original volume the image was created from was encrypted or not, the target volume type might need to be specified accordingly.
Whether this is the case can be identified by inspecting the image&#x27;s metadata using <code>openstack image show $IMAGE_NAME_OR_ID</code> and looking for a &quot;cinder_encryption_key_id&quot; field within &quot;properties&quot;.
If it exists, the source volume of the image was encrypted.</p>
<p>To restore the image of an unencrypted volume:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack volume create --image $IMAGE_NAME_OR_ID \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --size $VOLUME_SIZE_IN_GB $VOLUME_NAME</span><br></span></code></pre></div></div>
<p>To restore the image of an encrypted volume:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack volume create --image $IMAGE_NAME_OR_ID \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --type $ENCRYPTED_VOLUME_TYPE \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --size $VOLUME_SIZE_IN_GB $VOLUME_NAME</span><br></span></code></pre></div></div>
<p>If restoring an encrypted image, make sure to specify <code>$ENCRYPTED_VOLUME_TYPE</code> correctly and have it reference a volume type which also supports the encryption.
Otherwise the volume will be unbootable or unusable by Nova instances.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="restoring-a-volume-backup-from-the-cinder-backup-service">Restoring a volume backup from the Cinder Backup service<a href="#restoring-a-volume-backup-from-the-cinder-backup-service" class="hash-link" aria-label="Direct link to Restoring a volume backup from the Cinder Backup service" title="Direct link to Restoring a volume backup from the Cinder Backup service" translate="no">​</a></h3>
<p>The Cinder Backup service offers dedicated API actions and commands for restoring volume backups created using the service.
These backups can be restored in one of two ways:</p>
<ol>
<li class="">Letting the Cinder Backup service create a new volume based on the backup.</li>
<li class="">Overwriting an existing volume with the backup data.</li>
</ol>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>If the volume backup was originally created from a volume that used a non-default encrypted volume type, letting Cinder Backup create a new volume for backup restoration does not work and the volume type must match exactly.
In such case provision an empty volume with the correct type first and then restore the backup onto it <a href="#restoring-an-encrypted-volume-backup-cinder-backup" class="">as explained further down</a>.</p></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="restoring-to-a-new-volume-cinder-backup">Restoring to a new volume (Cinder Backup)<a href="#restoring-to-a-new-volume-cinder-backup" class="hash-link" aria-label="Direct link to Restoring to a new volume (Cinder Backup)" title="Direct link to Restoring to a new volume (Cinder Backup)" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack volume backup restore $BACKUP_NAME_OR_ID $TARGET_NAME</span><br></span></code></pre></div></div>
<p>... where <code>$TARGET_NAME</code> is the desired name of the new volume to be created.
Make sure that no volume with this name already exists.
The Cinder Backup service will create the volume with the same size as the backup indicates.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="restoring-on-an-existing-volume-cinder-backup">Restoring on an existing volume (Cinder Backup)<a href="#restoring-on-an-existing-volume-cinder-backup" class="hash-link" aria-label="Direct link to Restoring on an existing volume (Cinder Backup)" title="Direct link to Restoring on an existing volume (Cinder Backup)" translate="no">​</a></h4>
<p>As an alternative to creating a new volume as the restore target, the backup can also be restored on an existing volume:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack volume backup restore --force $BACKUP_NAME_OR_ID $VOLUME_NAME_OR_ID</span><br></span></code></pre></div></div>
<p>... which will overwrite the data on the existing volume, regardless of whether it is empty or not!</p>
<p>The volume will enter the &quot;restoring-backup&quot; state temporarily and will return to the &quot;available&quot; state again once the restore process has finished.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="restoring-an-encrypted-volume-backup-cinder-backup">Restoring an encrypted volume backup (Cinder Backup)<a href="#restoring-an-encrypted-volume-backup-cinder-backup" class="hash-link" aria-label="Direct link to Restoring an encrypted volume backup (Cinder Backup)" title="Direct link to Restoring an encrypted volume backup (Cinder Backup)" translate="no">​</a></h4>
<p>When restoring a volume backup of a volume that was using a non-default encrypted volume type, a new volume of that type needs to be created first and then the backup restored onto it.
Otherwise, the restoration will fail with the target volume ending up in the &quot;error_restoring&quot; state.
For this procedure to succeed it is necessary to know the exact volume type of the volume the backup was created from.</p>
<p>If the source volume of the backup still exists, the original volume type can be determined by inspecting the backup&#x27;s <code>volume_id</code> attribute and then using it to look up the corresponding volume and its <code>type</code> attribute.
The following client command can be used for this (fill in the value for <code>BACKUP_ID</code>):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">export BACKUP_ID=...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SOURCE_VOLUME_ID=&quot;$(openstack volume backup show $BACKUP_ID -f value -c volume_id)&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack volume show -f value -c type &quot;$SOURCE_VOLUME_ID&quot;</span><br></span></code></pre></div></div>
<p>This returns the name of the original volume type.
If the source volume does not exist anymore, rely on documentation about the backup to determine the type, if available.</p>
<p>First, create a new empty volume as the restore target and use the backup&#x27;s <code>size</code> metadata attribute to match the size of the volume to the backup:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack volume create --size $BACKUP_SIZE --type $VOLUME_TYPE $TARGET_NAME</span><br></span></code></pre></div></div>
<p>... where <code>$TARGET_NAME</code> is the desired name of the new volume.</p>
<p>Once the volume reaches &quot;available&quot; state, restore the backup onto it:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack volume backup restore --force $BACKUP_NAME_OR_ID $TARGET_NAME</span><br></span></code></pre></div></div>
<p>The volume will enter the &quot;restoring-backup&quot; state temporarily and will return to the &quot;available&quot; state again once the restore process has finished.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="appendix">Appendix<a href="#appendix" class="hash-link" aria-label="Direct link to Appendix" title="Direct link to Appendix" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="image-creation-action-for-servers-with-attached-volumes">Image creation action for servers with attached volumes<a href="#image-creation-action-for-servers-with-attached-volumes" class="hash-link" aria-label="Direct link to Image creation action for servers with attached volumes" title="Direct link to Image creation action for servers with attached volumes" translate="no">​</a></h3>
<p>When the <code>createImage</code> action of the Compute API (<code>openstack server image create</code>) is used on virtual machines that have at least one volume attached, a snapshot will be created for each attached volume individually and referenced in the resulting image&#x27;s metadata.</p>
<p>This happens regardless of whether the virtual machine has an Ephemeral Storage disk attached.
In case of an Ephemeral Storage disk, only the Ephemeral Storage is copied into the Glance image as a 1:1 copy.</p>
<p>In case of a virtual machine that has no Ephemeral Storage but only volumes, the <code>createImage</code> action leads to a Glance image that only consists of metadata (including the resulting volume snapshot references) but carries no actual binary data.</p>
<p><img decoding="async" loading="lazy" alt="Figure: createImage action flow involving Ephemeral Storage and/or volumes" src="/assets/images/user_data_backups_figure1-988dbd55659509cc1ddc9f68f2437648.png" width="1342" height="1202" class="img_ev3q"></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="luks-encryption-key-conversion-to-decrypt-volume-images">LUKS encryption key conversion to decrypt volume images<a href="#luks-encryption-key-conversion-to-decrypt-volume-images" class="hash-link" aria-label="Direct link to LUKS encryption key conversion to decrypt volume images" title="Direct link to LUKS encryption key conversion to decrypt volume images" translate="no">​</a></h3>
<p>The volume encryption keys stored in Barbican are not directly used as LUKS passphrases by OpenStack because they are in binary format.
OpenStack converts them to ASCII internally before passing them to the encryption layer.
This behavior needs to be reproduced if a decryption of a volume image is desired outside of OpenStack.</p>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p>The instructions below will expose plaintext data of encryption keys and encrypted volume images.
Make sure to only execute these steps in a secure and trusted environment.</p></div></div>
<p>First, download the image:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack image save --file image.raw $IMAGE_NAME_OR_ID</span><br></span></code></pre></div></div>
<p>Next, inspect the image metadata, determine the reference to the encryption key (<code>cinder_encryption_key_id</code> property) and download the encryption key:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack image show -f value -c properties $IMAGE_NAME_OR_ID</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># (use the value of `cinder_encryption_key_id` as `$SECRET_ID` below)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">openstack secret get --file image.key --payload_content_type &quot;application/octet-stream&quot; $SECRET_ID</span><br></span></code></pre></div></div>
<p>This will result in the following local files:</p>
<ul>
<li class=""><code>image.raw</code> = the raw encrypted image downloaded from Glance</li>
<li class=""><code>image.key</code> = the LUKS encryption key in binary format (plaintext)</li>
</ul>
<p>Since OpenStack internally uses Python&#x27;s <code>binascii.hexlify()</code> to convert the binary encryption key before passing it as a passphrase to the LUKS encryption, as a last step this conversion must be mimicked to unlock the encryption:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">python3 -c &quot;import binascii; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    f = open(&#x27;image.key&#x27;, &#x27;rb&#x27;); \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print(binascii.hexlify(f.read()).decode(&#x27;utf-8&#x27;))&quot; \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    | sudo cryptsetup luksOpen ./image.raw decrypted_image</span><br></span></code></pre></div></div>
<p>The decrypted image is now accessible at <code>/dev/mapper/decrypted_image</code>.
Note that this is a live en-/decryption operation on the <code>image.raw</code> file.
The image is not converted, the encryption is simply unlocked in-memory using LUKS and dm-crypt until the encryption is closed again.</p>
<p>The <code>/dev/mapper/decrypted_image</code> can now be handled like a raw block device (e.g. mounted as a filesystem) or snapshotted in decrypted form.</p>
<p>To close the encryption execute:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cryptsetup luksClose decrypted_image</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/SovereignCloudStack/docs/tree/main/docs/02-iaas/guides/user-guide/user-data-backups.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/iaas/guides/user-guide/security-groups/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Best Practise: How to configure and use security groups</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/iaas/guides/developer-guide/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Developer Guide</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#glossary" class="table-of-contents__link toc-highlight">Glossary</a></li><li><a href="#scope" class="table-of-contents__link toc-highlight">Scope</a><ul><li><a href="#overview-of-applicable-user-data" class="table-of-contents__link toc-highlight">Overview of applicable User Data</a></li></ul></li><li><a href="#image-backup-using-download" class="table-of-contents__link toc-highlight">Image backup using download</a></li><li><a href="#ephemeral-storage-backup-using-glance-images" class="table-of-contents__link toc-highlight">Ephemeral Storage backup using Glance images</a></li><li><a href="#volume-data-backup-using-cinder-backup-api" class="table-of-contents__link toc-highlight">Volume data backup using Cinder Backup API</a><ul><li><a href="#backup-of-detached-volumes" class="table-of-contents__link toc-highlight">Backup of detached volumes</a></li><li><a href="#backup-of-attached-volumes" class="table-of-contents__link toc-highlight">Backup of attached volumes</a></li></ul></li><li><a href="#volume-data-backup-using-glance-images" class="table-of-contents__link toc-highlight">Volume data backup using Glance images</a><ul><li><a href="#glance-image-backups-of-detached-volumes" class="table-of-contents__link toc-highlight">Glance image backups of detached volumes</a></li><li><a href="#glance-image-backups-of-attached-in-use-volumes" class="table-of-contents__link toc-highlight">Glance image backups of attached (in-use) volumes</a></li></ul></li><li><a href="#barbican-secrets-backup-using-download" class="table-of-contents__link toc-highlight">Barbican secrets backup using download</a><ul><li><a href="#retrieving-encryption-keys-from-barbican" class="table-of-contents__link toc-highlight">Retrieving encryption keys from Barbican</a></li></ul></li><li><a href="#restore" class="table-of-contents__link toc-highlight">Restore</a><ul><li><a href="#restoring-a-backup-of-a-barbican-secret" class="table-of-contents__link toc-highlight">Restoring a backup of a Barbican secret</a></li><li><a href="#restoring-a-backup-of-an-unencrypted-image" class="table-of-contents__link toc-highlight">Restoring a backup of an unencrypted image</a></li><li><a href="#restoring-a-backup-of-an-encrypted-image" class="table-of-contents__link toc-highlight">Restoring a backup of an encrypted image</a></li><li><a href="#restoring-a-volume-backup-from-an-image" class="table-of-contents__link toc-highlight">Restoring a volume backup from an image</a></li><li><a href="#restoring-a-volume-backup-from-the-cinder-backup-service" class="table-of-contents__link toc-highlight">Restoring a volume backup from the Cinder Backup service</a></li></ul></li><li><a href="#appendix" class="table-of-contents__link toc-highlight">Appendix</a><ul><li><a href="#image-creation-action-for-servers-with-attached-volumes" class="table-of-contents__link toc-highlight">Image creation action for servers with attached volumes</a></li><li><a href="#luks-encryption-key-conversion-to-decrypt-volume-images" class="table-of-contents__link toc-highlight">LUKS encryption key conversion to decrypt volume images</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Contribute</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://matrix.to/#/!TiDqlLmEUaXqTemaLc:matrix.org?via=matrix.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Matrix<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://fosstodon.org/@sovereigncloudstack" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mastodon<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/SovereignCloudStack/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Sovereign Cloud Stack, SCS and the logo are registered trademarks of the Open Source Business Alliance e.V. — Other trademarks are property of their respective owners.</div></div></div></footer></div>
</body>
</html>