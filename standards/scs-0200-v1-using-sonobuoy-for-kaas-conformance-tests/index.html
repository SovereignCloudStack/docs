<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-standards docs-version-current docs-doc-page docs-doc-id-scs-0200-v1-using-sonobuoy-for-kaas-conformance-tests" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">Using Sonobuoy for KaaS conformance tests | One platform — standardized, built and operated by many.</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.scs.community/img/scs-og-basic.png"><meta data-rh="true" name="twitter:image" content="https://docs.scs.community/img/scs-og-basic.png"><meta data-rh="true" property="og:url" content="https://docs.scs.community/standards/scs-0200-v1-using-sonobuoy-for-kaas-conformance-tests"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-standards-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-standards-current"><meta data-rh="true" property="og:title" content="Using Sonobuoy for KaaS conformance tests | One platform — standardized, built and operated by many."><meta data-rh="true" name="description" content="Motivation"><meta data-rh="true" property="og:description" content="Motivation"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://docs.scs.community/standards/scs-0200-v1-using-sonobuoy-for-kaas-conformance-tests"><link data-rh="true" rel="alternate" href="https://docs.scs.community/standards/scs-0200-v1-using-sonobuoy-for-kaas-conformance-tests" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.scs.community/standards/scs-0200-v1-using-sonobuoy-for-kaas-conformance-tests" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="One platform — standardized, built and operated by many. RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="One platform — standardized, built and operated by many. Atom Feed">








<link rel="preconnect" href="https://matomo.scs.community/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setDocumentTitle",document.domain+"/"+document.title]),_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var e="https://matomo.scs.community/";_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","2"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script><link rel="stylesheet" href="/assets/css/styles.0eddb8c7.css">
<script src="/assets/js/runtime~main.ede2d0ee.js" defer="defer"></script>
<script src="/assets/js/main.ff9c6252.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="SCS" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="SCS" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/standards">Standards</a><a class="navbar__item navbar__link" href="/docs">For Operators</a><a class="navbar__item navbar__link" href="/contributor-docs">For Contributors</a><a class="navbar__item navbar__link" href="/user-docs">For Users</a><a class="navbar__item navbar__link" href="/community">Community</a><a class="navbar__item navbar__link" href="/docs/faq">FAQ</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/SovereignCloudStack/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/standards/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/standards/certification/digisov-and-cert">Certification</a><button aria-label="Expand sidebar category &#x27;Certification&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/standards/standards/overview">Standards</a><button aria-label="Collapse sidebar category &#x27;Standards&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/standards/global/">Global</a><button aria-label="Expand sidebar category &#x27;Global&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/standards/iaas/">IaaS</a><button aria-label="Expand sidebar category &#x27;IaaS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/standards/kaas/">KaaS</a><button aria-label="Collapse sidebar category &#x27;KaaS&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/standards/kaas/scs-0200">scs-0200</a><button aria-label="Collapse sidebar category &#x27;scs-0200&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/standards/scs-0200-v1-using-sonobuoy-for-kaas-conformance-tests">V1</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/standards/kaas/scs-0210">scs-0210</a><button aria-label="Expand sidebar category &#x27;scs-0210&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/standards/kaas/scs-0211">scs-0211</a><button aria-label="Expand sidebar category &#x27;scs-0211&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/standards/kaas/scs-0212">scs-0212</a><button aria-label="Expand sidebar category &#x27;scs-0212&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/standards/kaas/scs-0213">scs-0213</a><button aria-label="Expand sidebar category &#x27;scs-0213&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/standards/kaas/scs-0214">scs-0214</a><button aria-label="Expand sidebar category &#x27;scs-0214&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/standards/kaas/scs-0215">scs-0215</a><button aria-label="Expand sidebar category &#x27;scs-0215&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/standards/kaas/scs-0216">scs-0216</a><button aria-label="Expand sidebar category &#x27;scs-0216&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/standards/kaas/scs-0217">scs-0217</a><button aria-label="Expand sidebar category &#x27;scs-0217&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/standards/kaas/scs-0218">scs-0218</a><button aria-label="Expand sidebar category &#x27;scs-0218&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/standards/kaas/scs-0219">scs-0219</a><button aria-label="Expand sidebar category &#x27;scs-0219&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/standards/iam/">IAM</a><button aria-label="Expand sidebar category &#x27;IAM&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/standards/ops/">Ops</a><button aria-label="Expand sidebar category &#x27;Ops&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/standards/standards/overview"><span itemprop="name">Standards</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/standards/kaas/"><span itemprop="name">KaaS</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/standards/kaas/scs-0200"><span itemprop="name">scs-0200</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">V1</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Using Sonobuoy for KaaS conformance tests</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="motivation">Motivation<a href="#motivation" class="hash-link" aria-label="Direct link to Motivation" title="Direct link to Motivation">​</a></h2>
<p>With the <a href="https://github.com/SovereignCloudStack/k8s-cluster-api-provider" target="_blank" rel="noopener noreferrer">k8s-cluster-api-provider</a>, the SCS provides a tool to generate
and manage k8s clusters on top of its IaaS infrastructure. As part of
the application, <a href="https://sonobuoy.io/" target="_blank" rel="noopener noreferrer">Sonobuoy</a> is used as a test suite to execute the
official <a href="https://github.com/kubernetes/kubernetes/tree/master/test/e2e" target="_blank" rel="noopener noreferrer">Kubernetes e2e tests</a>.
We expect that current and future tests derived from SCS standards
will benefit from (or even require) the testing mechanisms that Sonobuoy provides.</p>
<p>Apart from running the Kubernetes e2e tests, Sonobuoy also allows users to write
their own tests and apply them as a self-managed <a href="https://sonobuoy.io/docs/main/plugins/" target="_blank" rel="noopener noreferrer">plugin</a>.
All tests not provided by the <a href="https://sonobuoy.io/docs/main/e2eplugin/" target="_blank" rel="noopener noreferrer">e2e test plugin</a> could therefore
be written by the respective SCS teams responsible for the standards or tests and
then be made executable with Sonobuoy. Hence, Sonobuoy could provide both a pre-done
test suite and a framework to write additional conformance tests required for SCS.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="short-sonobuoy-introduction">Short Sonobuoy Introduction<a href="#short-sonobuoy-introduction" class="hash-link" aria-label="Direct link to Short Sonobuoy Introduction" title="Direct link to Short Sonobuoy Introduction">​</a></h3>
<p>The main objective of <a href="https://sonobuoy.io/docs/main/plugins/" target="_blank" rel="noopener noreferrer">Sonobuoy plugins</a> is to present test
results in a consolidated way. To do this, Sonobuoy integrates the test into a pod,
which is then applied to the K8s cluster under test. A Sonobuoy worker supervises
this pod and forwards all test results to the aggregator module. It does this by
waiting for a specific &quot;Done&quot; file to be created. Once this file is recognized,
the worker forwards the results to the aggregator, using a predefined location
for the results file within a folder, as seen in following image:
<img decoding="async" loading="lazy" src="https://sonobuoy.io/img/plugin-contract.png" alt="image search api" class="img_ev3q"></p>
<p>In order to use the existing conformance tests as a Sonobuoy plugin, a wrapper
around the individual test scripts would be required. This wrapper would need to
have the following effects:</p>
<ul>
<li>gathers all test results and provides them in the results file</li>
<li>run tests in sequence and signal the worker when it&#x27;s finished by generating a &quot;Done&quot; file</li>
</ul>
<p>Apart from providing the test results, a plugin container must also forward the
status of each test by setting a status flag in the results file.
Additionally, the tests would need to be able to run inside a pod in the K8s cluster under test.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="design-considerations">Design Considerations<a href="#design-considerations" class="hash-link" aria-label="Direct link to Design Considerations" title="Direct link to Design Considerations">​</a></h2>
<p>There are different approaches to create a Sonobuoy plugin, which are discussed
below in order to find a best practice for the SCS project. The documented approaches
show one example each in order to give a better representation to the reader.</p>
<p>Sonobuoy provides plugin examples in the <a href="https://github.com/vmware-tanzu/sonobuoy-plugins" target="_blank" rel="noopener noreferrer">plugins repository</a>,
which are referenced throughout this section.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="option-1-golang-based-approach-1-pick-a-framework-from-the-sonobuoy-plugin-examples"><em>Option 1</em> Golang based approach 1: Pick a framework from the Sonobuoy plugin examples<a href="#option-1-golang-based-approach-1-pick-a-framework-from-the-sonobuoy-plugin-examples" class="hash-link" aria-label="Direct link to option-1-golang-based-approach-1-pick-a-framework-from-the-sonobuoy-plugin-examples" title="Direct link to option-1-golang-based-approach-1-pick-a-framework-from-the-sonobuoy-plugin-examples">​</a></h3>
<p>The seemingly most interesting plugin is the <a href="https://github.com/vmware-tanzu/sonobuoy-plugins/tree/main/examples/e2e-skeleton" target="_blank" rel="noopener noreferrer">e2e-skeleton</a>, which uses
the <a href="https://github.com/kubernetes-sigs/e2e-framework" target="_blank" rel="noopener noreferrer">kubernetes-sigs/e2e-framework</a>. The <a href="https://github.com/kubernetes-sigs/e2e-framework" target="_blank" rel="noopener noreferrer">kubernetes-sigs/e2e-framework</a>
is a stand-alone project that is separate from the official <a href="https://github.com/kubernetes/kubernetes/tree/master/test/e2e" target="_blank" rel="noopener noreferrer">Kubernetes e2e tests</a>.
The framework provides proper documentation as well as helper functions that abstract
client functionalities, similar to those found in &quot;kubernetes/kubernetes/test/e2e/framework&quot; repository.</p>
<p>As mentioned in the <a href="https://github.com/kubernetes-sigs/e2e-framework/blob/main/docs/design/README.md#motivations" target="_blank" rel="noopener noreferrer">motivation</a> of the <a href="https://github.com/kubernetes-sigs/e2e-framework" target="_blank" rel="noopener noreferrer">e2e-framework</a>,
the project was created to circumvent the disadvantages of <a href="https://github.com/kubernetes/kubernetes/tree/master/test/e2e" target="_blank" rel="noopener noreferrer">Kubernetes&#x27; own e2e-tests</a>,
which are described in more detail in the <a href="https://github.com/kubernetes-sigs/e2e-framework/blob/main/docs/design/README.md#goals" target="_blank" rel="noopener noreferrer">goals</a>.</p>
<p>PROS:</p>
<ul>
<li>arguments in favor of this framework can also be found under the <a href="https://github.com/kubernetes-sigs/e2e-framework/blob/main/docs/design/README.md#goals" target="_blank" rel="noopener noreferrer">goals description</a> of the documentation</li>
<li><a href="https://github.com/kubernetes-sigs/e2e-framework" target="_blank" rel="noopener noreferrer">e2e-framework</a> is a well-defined framework, that allows the handling of resource creation and deletion</li>
<li>official framework provided by &quot;Kubernetes-sigs&quot;</li>
</ul>
<p>CONS:</p>
<ul>
<li>arguments not in favor of this framework can be derived from the <a href="https://github.com/kubernetes-sigs/e2e-framework/blob/main/docs/design/README.md#non-goals" target="_blank" rel="noopener noreferrer">Non-Goals</a> description of the documentation:<!-- -->
<ul>
<li>&quot;no responsibility for bootstrapping or the execution of the tests themselves&quot; can be ignored, as this is partly taken over by Sonobuoy</li>
<li>&quot;no mock or fake cluster components&quot; can be ignored, since the e2e tests of SCS should be used to test real clusters and their functionality</li>
<li>for this test procedure, the Sonobuoy e2e plugin should be run in addition to the SCS KaaS conformance tests</li>
</ul>
</li>
</ul>
<blockquote>
<p>proof of concept: <code>../Tests/kaas/kaas-sonobuoy-go-example-e2e-framework/</code></p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="option-2-golang-based-approach-2-reuse-the-kubernetes-own-e2e-test-infrastructure-and-framework"><em>Option 2</em> Golang based approach 2: Reuse the Kubernetes own e2e test infrastructure and framework<a href="#option-2-golang-based-approach-2-reuse-the-kubernetes-own-e2e-test-infrastructure-and-framework" class="hash-link" aria-label="Direct link to option-2-golang-based-approach-2-reuse-the-kubernetes-own-e2e-test-infrastructure-and-framework" title="Direct link to option-2-golang-based-approach-2-reuse-the-kubernetes-own-e2e-test-infrastructure-and-framework">​</a></h3>
<p>The existing Sonobuoy e2e plugin already provides a vast number of tests that could
be adapted or reused for the SCS project.</p>
<p>If these e2e tests are to be reused in a customized structure, a framework like <a href="https://onsi.github.io/ginkgo/" target="_blank" rel="noopener noreferrer">ginkgo</a>
must be used as it is used by the Kubernetes e2e test infrastructure.
This could use the implementation of the build process responsible for the Docker
image containing the e2e tests. The setup could be copied from <a href="https://github.com/kubernetes/kubernetes/tree/master/test/conformance/image" target="_blank" rel="noopener noreferrer">kubernetes/test/conformance/image</a>
and adapted to the projects requirements. The mentioned build process must use the
files of the following directories from the Kubernetes repository:</p>
<ul>
<li><a href="https://github.com/kubernetes/kubernetes/tree/master/cluster" target="_blank" rel="noopener noreferrer">kubernetes/cluster</a></li>
<li><a href="https://github.com/kubernetes/kubernetes/tree/master/test/e2e" target="_blank" rel="noopener noreferrer">kubernetes/test/e2e/framework</a></li>
<li><a href="https://github.com/kubernetes/kubernetes/tree/master/test/conformance/image/go-runner" target="_blank" rel="noopener noreferrer">kubernetes/test/conformance/image/go-runner</a></li>
<li><a href="https://github.com/kubernetes/kubernetes/tree/master/hack/conformance" target="_blank" rel="noopener noreferrer">kubernetes/hack/conformance</a></li>
<li><a href="https://github.com/kubernetes/kubernetes/tree/master/hack/make-rules" target="_blank" rel="noopener noreferrer">kubernetes/hack/make-rules</a></li>
</ul>
<p>PROS:</p>
<ul>
<li><a href="https://github.com/kubernetes/kubernetes/tree/master/test/e2e" target="_blank" rel="noopener noreferrer">Kubernetes&#x27; own e2e tests</a> already provide a vast amount of examples, which could be reused to develop specific SCS tests</li>
<li>compared to <em>option 1</em>, the <a href="https://github.com/kubernetes-sigs/e2e-framework/blob/main/docs/design/README.md#non-goals" target="_blank" rel="noopener noreferrer">non-goals</a> of the <a href="https://github.com/kubernetes-sigs/e2e-framework" target="_blank" rel="noopener noreferrer">e2e-framework</a> can be seen as the advantages of using <a href="https://github.com/kubernetes/kubernetes/tree/master/test/e2e" target="_blank" rel="noopener noreferrer">Kubernetes&#x27; own e2e-tests</a>.</li>
</ul>
<p>CONS:</p>
<ul>
<li>not easy to implement, as we would have to copy part of the Kubernetes repository and track the changes from the upstream</li>
<li>according to <a href="https://github.com/kubernetes/kubernetes/tree/master/cluster#readme" target="_blank" rel="noopener noreferrer">README.md</a>, part of it seems to be outdated and might change with a future version<!-- -->
<ul>
<li>compared to <em>option 1</em>, the <a href="https://github.com/kubernetes-sigs/e2e-framework/blob/main/docs/design/README.md#goals" target="_blank" rel="noopener noreferrer">goals</a> of the <a href="https://github.com/kubernetes-sigs/e2e-framework" target="_blank" rel="noopener noreferrer">e2e-framework</a> can be seen as the disadvantages of using <a href="https://github.com/kubernetes/kubernetes/tree/master/test/e2e" target="_blank" rel="noopener noreferrer">Kubernetes&#x27; own e2e-tests</a>.</li>
</ul>
</li>
</ul>
<blockquote>
<p>TODO: provide proof of concept: <em>kaas-sonobuoy-go-example-k8s-e2e</em></p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="option-3-write-python-scripts-for-tests"><em>Option 3</em> Write Python scripts for tests<a href="#option-3-write-python-scripts-for-tests" class="hash-link" aria-label="Direct link to option-3-write-python-scripts-for-tests" title="Direct link to option-3-write-python-scripts-for-tests">​</a></h3>
<p>Sonobuoy makes it possible to write tests in Python and execute them like other
tests in a pod on the K8s cluster. It would therefore be possible to keep on writing
conformance tests in Python.</p>
<p>This option would require a wrapper in order to make the tests scripts executable
as Sonobuoy plugins. This wrapper, as mentioned earlier, would need to capture
the collection of test results as well as the generation of the &quot;Done&quot; file after
the test execution is finished. This could be managed by executing each test script
in a sequential order.</p>
<p>The wrapper as well as the python tests and test framework could then be stored
in a container image and uploaded to a registry in order to be usable by Sonobuoy
within the k8s-cluster-api-provider.</p>
<p>This approach also leaves the decision open as to which test framework should be
used for Python, which should be decided in a secondary Decision Record.</p>
<blockquote>
<p>proof of work: <code>../Tests/kaas/k8s-default-storage-class</code></p>
</blockquote>
<p>PROS:</p>
<ul>
<li>continue using the already available Python tests<!-- -->
<ul>
<li>only a small number of tests is implemented thus far</li>
</ul>
</li>
</ul>
<p>CONS:</p>
<ul>
<li>no &quot;native&quot; support in Sonobuoy, a wrapper is needed</li>
<li>decision for a framework is still not done</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="approaches-to-providing-a-sonobuoy-plugin-image">Approaches to providing a Sonobuoy plugin image<a href="#approaches-to-providing-a-sonobuoy-plugin-image" class="hash-link" aria-label="Direct link to Approaches to providing a Sonobuoy plugin image" title="Direct link to Approaches to providing a Sonobuoy plugin image">​</a></h2>
<p>The following section showcases both ways to provide a Sonobuoy plugin image.
<em>Option 1</em> would most likely be used, if an image is published to be used by an end user.
<em>Option 2</em> is the expected way for local development and testing.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="option-1-public-container-registry"><em>Option 1</em> Public container registry<a href="#option-1-public-container-registry" class="hash-link" aria-label="Direct link to option-1-public-container-registry" title="Direct link to option-1-public-container-registry">​</a></h3>
<p>The image can be made available via a public container registry, which would require
a regular job (e.g. CI/CD) to build and publish the image.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="option-2-local-image-upload"><em>Option 2</em> Local image upload<a href="#option-2-local-image-upload" class="hash-link" aria-label="Direct link to option-2-local-image-upload" title="Direct link to option-2-local-image-upload">​</a></h3>
<p>Create the image locally on the &quot;clusterctl admin control node&quot; and then upload
it manually to the Kubernetes cluster under test.</p>
<p>Both approaches are useful in different ways. While the usage of a container registry
allows easy distribution of tests and guarantees new images through the usage of a
CI/CD job, it also makes it harder to test changes quickly, since a wait time could be
necessary to let the CI/CD job run through and access the image. This can be solved
by using the &quot;Local image upload&quot; or a combination of both approaches.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="decision">Decision<a href="#decision" class="hash-link" aria-label="Direct link to Decision" title="Direct link to Decision">​</a></h2>
<p>The KaaS conformance test MUST be provided as a test suite holding the
test cases for the Kubernetes clusters to be checked.
Furthermore, the test cases themselves MUST be wrapped by a test framework to:</p>
<ul>
<li>handle the creation and deletion of resources</li>
<li>collect and present results</li>
<li>consolidate redundant code across test cases</li>
<li>support the creation of test cases through predefined structures</li>
</ul>
<p>As with the <a href="https://github.com/SovereignCloudStack/k8s-cluster-api-provider" target="_blank" rel="noopener noreferrer">k8s-cluster-api-provider</a> the SCS provides a tooling to generate
its KaaS infrastructure. Part of the <a href="https://github.com/SovereignCloudStack/k8s-cluster-api-provider" target="_blank" rel="noopener noreferrer">k8s-cluster-api-provider</a> is the usage
of Sonobuoy as a test suite to execute the <a href="https://github.com/kubernetes/kubernetes/tree/master/test/e2e" target="_blank" rel="noopener noreferrer">Kubernetes own e2e tests</a>.
Investigating those e2e test lead to the conclusion that they are not always reusable.
The main purpose of Kubernetes own e2e tests is to test the functionality of
the Kubernetes code itself and not the resources and setup of a specific KaaS infrastructure
as it is the aim of the SCS KaaS conformance test.</p>
<p>However, considering that the SCS has an ongoing process of defining standards and
implementing test cases to check their compliance, that means in some cases future standards
might already be covered by the e2e test inside the Kubernetes repository.
Hence, before writing tests, a developer SHOULD check the Kubernetes e2e tests for
existing test cases that might cover conformance of a standard currently being worked on.</p>
<p>As described above, Sonobuoy offers the possibility to generate custom plugins
that provide self-created test cases. Therefore, future conformance tests MUST
be executable by Sonobuoy by wrapping them in a Sonobuoy plugin.
Moreover, three options for the implementation of the SCS KaaS compliance test
cases are described above so that it can be decided within this decision record which
options should be used.</p>
<p>As a first decision, &quot;<em>Option 2</em> Go Approach 2: Reuse Kubernetes&#x27; own e2e test infrastructure and framework&quot;
is the least viable, as it would mean copying almost all the files used from
the Kubernetes e2e tests. This framework is closely linked to the development of
the Kubernetes code. Therefore, changes to its structure mainly are in line with its usage
in the Kubernetes repository itself and is most likely not relevant for other parties.
Changes in the framework cloud have a greater impact on our side as they are
predictable. The development effort gained by reusing these examples could be
outweighed by the investment necessary to adapt tests to the corresponding framework changes.</p>
<p>This leaves &quot;<em>Option 1</em> Go approach 1: Pick framework from the Sonobuoy plugin examples&quot;
and &quot;<em>Option 3</em> Write Python scripts for tests&quot; as methods for implementing test cases.
It is possible to use both approaches in parallel, which would enable usage of both Python
and Go code. This could possibly generate two Sonobuoy plugins, but this isn&#x27;t a necessity.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/standards/kaas/scs-0200"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">scs-0200: Using Sonobuoy for KaaS conformance tests</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/standards/kaas/scs-0210"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">scs-0210: SCS K8S Version Policy</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a><ul><li><a href="#short-sonobuoy-introduction" class="table-of-contents__link toc-highlight">Short Sonobuoy Introduction</a></li></ul></li><li><a href="#design-considerations" class="table-of-contents__link toc-highlight">Design Considerations</a><ul><li><a href="#option-1-golang-based-approach-1-pick-a-framework-from-the-sonobuoy-plugin-examples" class="table-of-contents__link toc-highlight"><em>Option 1</em> Golang based approach 1: Pick a framework from the Sonobuoy plugin examples</a></li><li><a href="#option-2-golang-based-approach-2-reuse-the-kubernetes-own-e2e-test-infrastructure-and-framework" class="table-of-contents__link toc-highlight"><em>Option 2</em> Golang based approach 2: Reuse the Kubernetes own e2e test infrastructure and framework</a></li><li><a href="#option-3-write-python-scripts-for-tests" class="table-of-contents__link toc-highlight"><em>Option 3</em> Write Python scripts for tests</a></li></ul></li><li><a href="#approaches-to-providing-a-sonobuoy-plugin-image" class="table-of-contents__link toc-highlight">Approaches to providing a Sonobuoy plugin image</a><ul><li><a href="#option-1-public-container-registry" class="table-of-contents__link toc-highlight"><em>Option 1</em> Public container registry</a></li><li><a href="#option-2-local-image-upload" class="table-of-contents__link toc-highlight"><em>Option 2</em> Local image upload</a></li></ul></li><li><a href="#decision" class="table-of-contents__link toc-highlight">Decision</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Contribute</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://matrix.to/#/!TiDqlLmEUaXqTemaLc:matrix.org?via=matrix.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Matrix<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://fosstodon.org/@sovereigncloudstack" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mastodon<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/SovereignCloudStack/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Sovereign Cloud Stack, SCS and the logo are registered trademarks of the Open Source Business Alliance e.V. — Other trademarks are property of their respective owners.</div></div></div></footer></div>
</body>
</html>